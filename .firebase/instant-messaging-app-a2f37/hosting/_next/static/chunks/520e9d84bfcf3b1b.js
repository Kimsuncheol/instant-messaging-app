(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,82218,(e,t,r)=>{var n={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,s=l(e),a=s[0],o=s[1],u=new i((a+o)*3/4-o),h=0,c=o>0?a-4:a;for(r=0;r<c;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],u[h++]=t>>16&255,u[h++]=t>>8&255,u[h++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,u[h++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,u[h++]=t>>8&255,u[h++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],a=0,o=n-i;a<o;a+=16383)s.push(function(e,t,n){for(var i,s=[],a=t;a<n;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[i>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===i?s.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&s.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),s.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)r[a]=s[a],n[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n[45]=62,n[95]=63},72:function(e,t,r){"use strict";var n=r(675),i=r(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return h(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e){var n=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|f(n,i),l=a(s),u=l.write(n,i);return u!==s&&(l=l.slice(0,u)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(D(e,ArrayBuffer)||e&&D(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(D(e,SharedArrayBuffer)||e&&D(e.buffer,SharedArrayBuffer)))return function(e,t,r){var n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),n}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var h=e.valueOf&&e.valueOf();if(null!=h&&h!==e)return o.from(h,t,r);var p=function(e){if(o.isBuffer(e)){var t=0|d(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(p)return p;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(u(e),e<=0)?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return h(e)},o.allocUnsafeSlow=function(e){return h(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||D(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return S(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return C(e).length;default:if(i)return n?-1:S(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,r){var i,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=N[e[s]];return i}(this,t,r);case"utf8":case"utf-8":return w(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":return i=this,s=t,a=r,0===s&&a===i.length?n.fromByteArray(i):n.fromByteArray(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}(this,t,r);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function m(e,t,r,n,i){var s;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(s=r*=1)!=s&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(i)return -1;else r=e.length-1;else if(r<0)if(!i)return -1;else r=0;if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return y(e,[t],r,n,i)}throw TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var s,a=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var h=-1;for(s=r;s<o;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===l)return h*a}else -1!==h&&(s-=s-h),h=-1}else for(r+l>o&&(r=o-l),s=r;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(u(e,s+d)!==u(t,d)){c=!1;break}if(c)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),D(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:+(n<r)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,n=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(D(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?w(this,0,e):p.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,r,n,i){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var s=i-n,a=r-t,l=Math.min(s,a),u=this.slice(n,i),h=e.slice(t,r),c=0;c<l;++c)if(u[c]!==h[c]){s=u[c],a=h[c];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)};function w(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,a,o,l,u=e[i],h=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c<=r)switch(c){case 1:u<128&&(h=u);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&u)<<6|63&s)>127&&(h=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(h=l)}null===h?(h=65533,c=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=c}var d=n,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",g=0;g<f;)p+=String.fromCharCode.apply(String,d.slice(g,g+=4096));return p}function v(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function b(e,t,r,n,i,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function _(e,t,r,n,i,s){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function I(e,t,r,n,s){return t*=1,r>>>=0,s||_(e,t,r,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,r,n,23,4),r+4}function E(e,t,r,n,s){return t*=1,r>>>=0,s||_(e,t,r,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,r,n,52,8),r+8}o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,u,h,c,d=this.length-t;if((void 0===r||r>d)&&(r=d),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var f=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[r+a]=l}return a}(this,e,t,r);case"utf8":case"utf-8":return i=t,s=r,A(S(e,this.length-i),this,i,s);case"ascii":return a=t,o=r,A(x(e),this,a,o);case"latin1":case"binary":return function(e,t,r,n){return A(x(t),e,r,n)}(this,e,t,r);case"base64":return l=t,u=r,A(C(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=r,A(function(e,t){for(var r,n,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}(e,this.length-h),this,h,c);default:if(f)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUInt8=function(e,t){return e>>>=0,t||v(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||v(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||v(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||v(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;b(this,e,t,r,i,0)}var s=1,a=0;for(this[t]=255&e;++a<r&&(s*=256);)this[t+a]=e/s&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;b(this,e,t,r,i,0)}var s=r-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);b(this,e,t,r,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);b(this,e,t,r,i-1,-i)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return I(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return I(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return E(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return E(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var s=i-1;s>=0;--s)e[s+t]=this[s+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=o.isBuffer(e)?e:o.from(e,n),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%l]}return this};var T=/[^+/0-9A-Za-z-_]/g;function S(e,t){t=t||1/0;for(var r,n=e.length,i=null,s=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319||a+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function x(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function C(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(T,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function A(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function D(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var N=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},783:function(e,t){t.read=function(e,t,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,u=l>>1,h=-7,c=r?i-1:0,d=r?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=o;h>0;s=256*s+e[t+c],c+=d,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=n;h>0;a=256*a+e[t+c],c+=d,h-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),s-=u}return(f?-1:1)*a*Math.pow(2,s-n)},t.write=function(e,t,r,n,i,s){var a,o,l,u=8*s-i-1,h=(1<<u)-1,c=h>>1,d=5960464477539062e-23*(23===i),f=n?0:s-1,p=n?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=h?(o=0,a=h):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&o,f+=p,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[r+f]=255&a,f+=p,a/=256,u-=8);e[r+f-p]|=128*g}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}},a=!0;try{n[e](r,r.exports,s),a=!1}finally{a&&delete i[e]}return r.exports}s.ab="/ROOT/Desktop/instant-messaging-app/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},73978,35314,85214,81200,6714,82107,e=>{"use strict";let t,r,n;var i,s,a,o,l,u,h,c,d,f,p,g,m,y,w,v,b=e.i(56488),_=e.i(82218);let I=function(e,t){if(!e)throw E(t)},E=function(e){return Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},T=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},S=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},x={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(c=64)),n.push(r[u],r[h],r[c],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(T(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):S(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new C;let l=i<<2|s>>4;if(n.push(l),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class C extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let A=function(e){let t=T(e);return x.encodeByteArray(t,!0)},D=function(e){return A(e).replace(/\./g,"")},N=function(e){try{return x.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function k(e){return function e(t,r){if(!(r instanceof Object))return r;switch(r.constructor){case Date:return new Date(r.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return r}for(let n in r)r.hasOwnProperty(n)&&"__proto__"!==n&&(t[n]=e(t[n],r[n]));return t}(void 0,e)}function R(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g}let O=()=>{try{return R().__FIREBASE_DEFAULTS__||(()=>{if(void 0===b.default||void 0===b.default.env)return;let e=b.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&N(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},M=e=>O()?.emulatorHosts?.[e],P=e=>{let t=M(e);if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]},L=()=>O()?.config,F=e=>O()?.[`_${e}`];class V{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function B(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function U(e){return(await fetch(e,{credentials:"include"})).ok}function q(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${r}`,aud:r,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[D(JSON.stringify({alg:"none",type:"JWT"})),D(JSON.stringify(s)),""].join(".")}let j={},z=!1;function $(e,t){if("undefined"==typeof window||"undefined"==typeof document||!B(window.location.host)||j[e]===t||j[e]||z)return;function r(e){return`__firebase__banner__${e}`}j[e]=t;let n="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(j))j[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(n),t=!1,e||((e=document.createElement("div")).setAttribute("id",n),t=!0),{created:t,element:e}),a=r("text"),o=document.getElementById(a)||document.createElement("span"),l=r("learnmore"),u=document.getElementById(l)||document.createElement("a"),h=r("preprendIcon"),c=document.getElementById(h)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",u.setAttribute("id",l),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline";let r=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;z=!0,(e=document.getElementById(n))&&e.remove()},e);c.setAttribute("width","24"),c.setAttribute("id",h),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",t.append(c,o,u,r),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function G(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function K(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(G())}function Q(){let t=O()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function H(){return"undefined"!=typeof window||W()}function W(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function J(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function X(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function Y(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Z(){let e=G();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function ee(){return false}function et(){return!Q()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function er(){return!Q()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function en(){try{return"object"==typeof indexedDB}catch(e){return!1}}function ei(){return new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}})}class es extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,es.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ea.prototype.create)}}class ea{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var r,n;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(r=a,n=i,r.replace(eo,(e,t)=>{let r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new es(s,l,i)}}let eo=/\{\$([^}]+)}/g;function el(e){return JSON.parse(e)}function eu(e){return JSON.stringify(e)}let eh=function(e){let t={},r={},n={},i="";try{let s=e.split(".");t=el(N(s[0])||""),r=el(N(s[1])||""),i=s[2],n=r.d||{},delete r.d}catch(e){}return{header:t,claims:r,data:n,signature:i}},ec=function(e){let t=eh(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},ed=function(e){let t=eh(e).claims;return"object"==typeof t&&!0===t.admin};function ef(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function ep(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function eg(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function em(e,t,r){let n={};for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=t.call(r,e[i],i,e));return n}function ey(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if(ew(r)&&ew(s)){if(!ey(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function ew(e){return null!==e&&"object"==typeof e}function ev(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function eb(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function e_(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}class eI{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let r,n;t||(t=0);let i=this.W_;if("string"==typeof e)for(let r=0;r<16;r++)i[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let r=0;r<16;r++)i[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=i[e-3]^i[e-8]^i[e-14]^i[e-16];i[e]=(t<<1|t>>>31)&0xffffffff}let s=this.chain_[0],a=this.chain_[1],o=this.chain_[2],l=this.chain_[3],u=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(r=l^a&(o^l),n=0x5a827999):(r=a^o^l,n=0x6ed9eba1):e<60?(r=a&o|l&(a|o),n=0x8f1bbcdc):(r=a^o^l,n=0xca62c1d6);let t=(s<<5|s>>>27)+r+u+n+i[e]|0;u=l,l=o,o=(a<<30|a>>>2)&0xffffffff,a=s,s=t}this.chain_[0]=this.chain_[0]+s|0,this.chain_[1]=this.chain_[1]+a|0,this.chain_[2]=this.chain_[2]+o|0,this.chain_[3]=this.chain_[3]+l|0,this.chain_[4]=this.chain_[4]+u|0}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let r=t-this.blockSize,n=0,i=this.buf_,s=this.inbuf_;for(;n<t;){if(0===s)for(;n<=r;)this.compress_(e,n),n+=this.blockSize;if("string"==typeof e){for(;n<t;)if(i[s]=e.charCodeAt(n),++s,++n,s===this.blockSize){this.compress_(i),s=0;break}}else for(;n<t;)if(i[s]=e[n],++s,++n,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let r=0;for(let t=0;t<5;t++)for(let n=24;n>=0;n-=8)e[r]=this.chain_[t]>>n&255,++r;return e}}function eE(e,t){let r=new eT(e,t);return r.subscribe.bind(r)}class eT{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:r}:e).next&&(n.next=eS),void 0===n.error&&(n.error=eS),void 0===n.complete&&(n.complete=eS);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function eS(){}function ex(e,t){return`${e} failed: ${t} argument `}let eC=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);if(i>=55296&&i<=56319){let t=i-55296;I(++n<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(n)-56320)}i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:(i<65536?t[r++]=i>>12|224:(t[r++]=i>>18|240,t[r++]=i>>12&63|128),t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},eA=function(e){let t=0;for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);n<128?t++:n<2048?t+=2:n>=55296&&n<=56319?(t+=4,r++):t+=3}return t};function eD(e){return e&&e._delegate?e._delegate:e}e.s(["Deferred",()=>V,"ErrorFactory",()=>ea,"FirebaseError",()=>es,"Sha1",()=>eI,"assert",()=>I,"assertionError",()=>E,"base64",()=>x,"base64Decode",()=>N,"base64Encode",()=>A,"base64urlEncodeWithoutPadding",()=>D,"contains",()=>ef,"createMockUserToken",()=>q,"createSubscribe",()=>eE,"deepCopy",()=>k,"deepEqual",()=>ey,"errorPrefix",()=>ex,"extractQuerystring",()=>e_,"getDefaultAppConfig",()=>L,"getDefaultEmulatorHost",()=>M,"getDefaultEmulatorHostnameAndPort",()=>P,"getExperimentalSetting",()=>F,"getGlobal",()=>R,"getModularInstance",()=>eD,"getUA",()=>G,"isAdmin",()=>ed,"isBrowser",()=>H,"isBrowserExtension",()=>X,"isCloudWorkstation",()=>B,"isCloudflareWorker",()=>J,"isEmpty",()=>eg,"isIE",()=>Z,"isIndexedDBAvailable",()=>en,"isMobileCordova",()=>K,"isNodeSdk",()=>ee,"isReactNative",()=>Y,"isSafari",()=>et,"isSafariOrWebkit",()=>er,"isValidFormat",()=>ec,"isWebWorker",()=>W,"jsonEval",()=>el,"map",()=>em,"pingServer",()=>U,"querystring",()=>ev,"querystringDecode",()=>eb,"safeGet",()=>ep,"stringLength",()=>eA,"stringToByteArray",()=>eC,"stringify",()=>eu,"updateEmulatorBanner",()=>$,"validateIndexedDBOpenable",()=>ei],35314);class eN{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let ek="[DEFAULT]";class eR{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new V;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ek})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=ek){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ek){return this.instances.has(e)}getOptions(e=ek){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(r)??new Set;n.add(e),this.onInitCallbacks.set(r,n);let i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var r;let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===ek?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=ek){return this.component?this.component.multipleInstances?e:ek:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class eO{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eR(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}e.s(["Component",()=>eN,"ComponentContainer",()=>eO,"Provider",()=>eR],85214);let eM=[];(i=s||(s={}))[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT";let eP={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},eL=s.INFO,eF={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},eV=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=eF[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eB{constructor(e){this.name=e,this._logLevel=eL,this._logHandler=eV,this._userLogHandler=null,eM.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in s))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?eP[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...e),this._logHandler(this,s.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...e),this._logHandler(this,s.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,s.INFO,...e),this._logHandler(this,s.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,s.WARN,...e),this._logHandler(this,s.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...e),this._logHandler(this,s.ERROR,...e)}}function eU(e){eM.forEach(t=>{t.setLogLevel(e)})}function eq(e,t){for(let r of eM){let n=null;t&&t.level&&(n=eP[t.level]),null===e?r.userLogHandler=null:r.userLogHandler=(t,r,...i)=>{let a=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");r>=(n??t.logLevel)&&e({level:s[r].toLowerCase(),message:a,args:i,type:t.name})}}}e.s(["LogLevel",()=>s,"Logger",()=>eB,"setLogLevel",()=>eU,"setUserLogHandler",()=>eq],81200);let ej=new WeakMap,ez=new WeakMap,e$=new WeakMap,eG=new WeakMap,eK=new WeakMap,eQ={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return ez.get(e);if("objectStoreNames"===t)return e.objectStoreNames||e$.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return eH(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eH(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(eH(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&ej.set(t,e)}).catch(()=>{}),eK.set(t,e),t}if(eG.has(e))return eG.get(e);let n=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(eW(this),t),eH(ej.get(this))}:function(...t){return eH(e.apply(eW(this),t))}:function(t,...r){let n=e.call(eW(this),t,...r);return e$.set(n,t.sort?t.sort():[t]),eH(n)};return e instanceof IDBTransaction&&function(e){if(ez.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});ez.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,eQ):e}(e);return n!==e&&(eG.set(e,n),eK.set(n,e)),n}let eW=e=>eK.get(e),eJ=["get","getKey","getAll","getAllKeys","count"],eX=["put","add","delete","clear"],eY=new Map;function eZ(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eY.get(t))return eY.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=eX.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||eJ.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return eY.set(t,s),s}eQ={...n=eQ,get:(e,t,r)=>eZ(e,t)||n.get(e,t,r),has:(e,t)=>!!eZ(e,t)||n.has(e,t)};class e0{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let e1="@firebase/app",e2="0.14.6",e6=new eB("@firebase/app"),e3="[DEFAULT]",e5={[e1]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},e4=new Map,e8=new Map,e7=new Map;function e9(e,t){try{e.container.addComponent(t)}catch(r){e6.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function te(e,t){e.container.addOrOverwriteComponent(t)}function tt(e){let t=e.name;if(e7.has(t))return e6.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(e7.set(t,e),e4.values()))e9(r,e);for(let t of e8.values())e9(t,e);return!0}function tr(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function tn(e,t,r=e3){tr(e,t).clearInstance(r)}function ti(e){return void 0!==e.options}function ts(e){return!ti(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function ta(e){return null!=e&&void 0!==e.settings}function to(){e7.clear()}let tl=new ea("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class tu{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new eN("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw tl.create("app-deleted",{appName:this._name})}}function th(e,t){let r=N(e.split(".")[1]);null===r?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(r).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class tc extends tu{constructor(e,t,r,n){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:r,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,n):super(e.options,s,n),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&th(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&th(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,tw(e1,e2,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){ty(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw tl.create("server-app-deleted")}}let td="12.6.0";function tf(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n={name:e3,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw tl.create("bad-app-name",{appName:String(i)});if(r||(r=L()),!r)throw tl.create("no-options");let s=e4.get(i);if(s)if(ey(r,s.options)&&ey(n,s.config))return s;else throw tl.create("duplicate-app",{appName:i});let a=new eO(i);for(let e of e7.values())a.addComponent(e);let o=new tu(r,n,a);return e4.set(i,o),o}function tp(e,t={}){let r;if(H()&&!W())throw tl.create("invalid-server-app-environment");let n=t||{};if(e&&(ti(e)?r=e.options:ts(e)?n=e:r=e),void 0===n.automaticDataCollectionEnabled&&(n.automaticDataCollectionEnabled=!0),r||(r=L()),!r)throw tl.create("no-options");let i={...n,...r};if(void 0!==i.releaseOnDeref&&delete i.releaseOnDeref,void 0!==n.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw tl.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(i)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),a=e8.get(s);if(a)return a.incRefCount(n.releaseOnDeref),a;let o=new eO(s);for(let e of e7.values())o.addComponent(e);let l=new tc(r,n,s,o);return e8.set(s,l),l}function tg(e=e3){let t=e4.get(e);if(!t&&e===e3&&L())return tf();if(!t)throw tl.create("no-app",{appName:e});return t}function tm(){return Array.from(e4.values())}async function ty(e){let t=!1,r=e.name;e4.has(r)?(t=!0,e4.delete(r)):e8.has(r)&&0>=e.decRefCount()&&(e8.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function tw(e,t,r){let n=e5[e]??e;r&&(n+=`-${r}`);let i=n.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${n}" with version "${t}":`];i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),e6.warn(e.join(" "));return}tt(new eN(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}function tv(e,t){if(null!==e&&"function"!=typeof e)throw tl.create("invalid-log-argument");eq(e,t)}function tb(e){eU(e)}let t_="firebase-heartbeat-store",tI=null;function tE(){return tI||(tI=(function(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,1),o=eH(a);return n&&a.addEventListener("upgradeneeded",e=>{n(eH(a.result),e.oldVersion,e.newVersion,eH(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(t_)}catch(e){console.warn(e)}}}).catch(e=>{throw tl.create("idb-open",{originalErrorMessage:e.message})})),tI}async function tT(e){try{let t=(await tE()).transaction(t_),r=await t.objectStore(t_).get(tx(e));return await t.done,r}catch(e){if(e instanceof es)e6.warn(e.message);else{let t=tl.create("idb-get",{originalErrorMessage:e?.message});e6.warn(t.message)}}}async function tS(e,t){try{let r=(await tE()).transaction(t_,"readwrite"),n=r.objectStore(t_);await n.put(t,tx(e)),await r.done}catch(e){if(e instanceof es)e6.warn(e.message);else{let t=tl.create("idb-set",{originalErrorMessage:e?.message});e6.warn(t.message)}}}function tx(e){return`${e.name}!${e.options.appId}`}class tC{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tD(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=tA();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){e6.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=tA(),{heartbeatsToSend:t,unsentEntries:r}=function(e,t=1024){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),tN(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),tN(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),n=D(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return e6.warn(e),""}}}function tA(){return new Date().toISOString().substring(0,10)}class tD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!en()&&ei().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tT(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tS(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tS(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function tN(e){return D(JSON.stringify({version:2,heartbeats:e})).length}tt(new eN("platform-logger",e=>new e0(e),"PRIVATE")),tt(new eN("heartbeat",e=>new tC(e),"PRIVATE")),tw(e1,e2,""),tw(e1,e2,"esm2020"),tw("fire-js",""),e.s(["SDK_VERSION",()=>td,"_DEFAULT_ENTRY_NAME",()=>e3,"_addComponent",()=>e9,"_addOrOverwriteComponent",()=>te,"_apps",()=>e4,"_clearComponents",()=>to,"_components",()=>e7,"_getProvider",()=>tr,"_isFirebaseApp",()=>ti,"_isFirebaseServerApp",()=>ta,"_isFirebaseServerAppSettings",()=>ts,"_registerComponent",()=>tt,"_removeServiceInstance",()=>tn,"_serverApps",()=>e8,"deleteApp",()=>ty,"getApp",()=>tg,"getApps",()=>tm,"initializeApp",()=>tf,"initializeServerApp",()=>tp,"onLog",()=>tv,"registerVersion",()=>tw,"setLogLevel",()=>tb],6714);var tk="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,tR={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function r(){}function n(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^r&(i^s))+n[0]+0xd76aa478|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;let r=[],n=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let r=t-this.blockSize,i=this.C,s=this.h,a=0;for(;a<t;){if(0==s)for(;a<=r;)n(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){n(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var s,l={};function u(e){var t;return -128<=e&&e<128?(t=function(e){return new i([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(l,e)?l[e]:l[e]=t(e)):new i([0|e],e<0?-1:0)}function h(e){if(isNaN(e)||!isFinite(e))return c;if(e<0)return m(h(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new i(t,0)}var c=u(0),d=u(1),f=u(0x1000000);function p(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function g(e){return -1==e.h}function m(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new i(r,~e.h).add(d)}function y(e,t){return e.add(m(t))}function w(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function v(e,t){this.g=e,this.h=t}function b(e,t){if(p(t))throw Error("division by zero");if(p(e))return new v(c,c);if(g(e))return t=b(m(e),t),new v(m(t.g),m(t.h));if(g(t))return t=b(e,m(t)),new v(m(t.g),t.h);if(e.g.length>30){if(g(e)||g(t))throw Error("slowDivide_ only works with positive integers.");for(var r=d,n=t;0>=n.l(e);)r=_(r),n=_(n);var i=I(r,1),s=I(n,1);for(n=I(n,2),r=I(r,2);!p(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=I(n,1),r=I(r,1)}return t=y(e,i.j(t)),new v(i,t)}for(i=c;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=h(r)).j(t);g(a)||a.l(e)>0;)r-=n,a=(s=h(r)).j(t);p(s)&&(s=d),i=i.add(s),e=y(e,a)}return new v(i,e)}function _(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new i(r,e.h)}function I(e,t){let r=t>>5;t%=32;let n=e.g.length-r,s=[];for(let i=0;i<n;i++)s[i]=t>0?e.i(i+r)>>>t|e.i(i+r+1)<<32-t:e.i(i+r);return new i(s,e.h)}(s=i.prototype).m=function(){if(g(this))return-m(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:0x100000000+n)*t,t*=0x100000000}return e},s.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(g(this))return"-"+m(this).toString(e);let t=h(Math.pow(e,6));var r=this;let n="";for(;;){let i=b(r,t).g,s=(((r=y(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(p(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},s.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return g(e=y(this,e))?-1:+!p(e)},s.abs=function(){return g(this)?m(this):this},s.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],n=0;for(let i=0;i<=t;i++){let t=n+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);n=s>>>16,t&=65535,s&=65535,r[i]=s<<16|t}return new i(r,-0x80000000&r[r.length-1]?-1:0)},s.j=function(e){if(p(this)||p(e))return c;if(g(this))return g(e)?m(this).j(m(e)):m(m(this).j(e));if(g(e))return m(this.j(m(e)));if(0>this.l(f)&&0>e.l(f))return h(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(let t=0;t<e.g.length;t++){let i=this.i(n)>>>16,s=65535&this.i(n),a=e.i(t)>>>16,o=65535&e.i(t);r[2*n+2*t]+=s*o,w(r,2*n+2*t),r[2*n+2*t+1]+=i*o,w(r,2*n+2*t+1),r[2*n+2*t+1]+=s*a,w(r,2*n+2*t+1),r[2*n+2*t+2]+=i*a,w(r,2*n+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new i(r,0)},s.B=function(e){return b(this,e).h},s.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new i(r,this.h&e.h)},s.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new i(r,this.h|e.h)},s.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new i(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,o=tR.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=h,i.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if((r=r||10)<2||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return m(e(t.substring(1),r));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let n=h(Math.pow(r,8)),i=c;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+s),r);s<8?(s=h(Math.pow(r,s)),i=i.j(s).add(h(a))):i=(i=i.j(n)).add(h(a))}return i},a=tR.Integer=i}).apply(void 0!==tk?tk:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var tO="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,tM={};(function(){var e,t,r=Object.defineProperty,n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof tO&&tO];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function i(e,t){if(t)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in i))break e;i=i[a]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&r(i,e,{configurable:!0,writable:!0,value:t})}}i("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(e){return e||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push([t,e[t]]);return r}});var s=s||{},a=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function m(e,t,r){return e.call.apply(e.bind,arguments)}function y(e,t,r){return(y=m).apply(null,arguments)}function w(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function v(e,t){function r(){}r.prototype=t.prototype,e.Z=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Ob=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}}var b="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function _(e){let t=e.length;if(t>0){let r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function I(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];var r=typeof n;if("array"==(r="object"!=r?r:n?Array.isArray(n)?"array":r:"null")||"object"==r&&"number"==typeof n.length){r=e.length||0;let t=n.length||0;e.length=r+t;for(let i=0;i<t;i++)e[r+i]=n[i]}else e.push(n)}}var E=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new T,e=>e.reset());class T{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let S,x=!1,C=new class{constructor(){this.h=this.g=null}add(e,t){let r=E.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},A=()=>{let e=Promise.resolve(void 0);S=()=>{e.then(D)}};function D(){let e;for(var t;e=null,C.g&&(e=C.g,C.g=C.g.next,C.g||(C.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}E.j(t),E.h<100&&(E.h++,t.next=E.g,E.g=t)}x=!1}function N(){this.u=this.u,this.C=this.C}function k(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}N.prototype.u=!1,N.prototype.dispose=function(){this.u||(this.u=!0,this.N())},N.prototype[Symbol.dispose]=function(){this.dispose()},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},k.prototype.h=function(){this.defaultPrevented=!0};var R=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function O(e){return/^[\s\xa0]*$/.test(e)}function M(e,t){k.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}v(M,k),M.prototype.init=function(e,t){let r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement)),this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&M.Z.h.call(this)},M.prototype.h=function(){M.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var P="closure_listenable_"+(1e6*Math.random()|0),L=0;function F(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++L,this.da=this.fa=!1}function V(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function B(e,t,r){for(let n in e)t.call(r,e[n],n,e)}function U(e){let t={};for(let r in e)t[r]=e[r];return t}let q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function j(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t])e[r]=n[r];for(let t=0;t<q.length;t++)r=q[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}function z(e){this.src=e,this.g={},this.h=0}function $(e,t){let r=t.type;if(r in e.g){var n,i=e.g[r],s=Array.prototype.indexOf.call(i,t,void 0);(n=s>=0)&&Array.prototype.splice.call(i,s,1),n&&(V(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function G(e,t,r,n){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!r==s.capture&&s.ha==n)return i}return -1}z.prototype.add=function(e,t,r,n,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let a=G(e,t,n,i);return a>-1?(t=e[a],r||(t.fa=!1)):((t=new F(t,this.src,s,!!n,i)).fa=r,e.push(t)),t};var K="closure_lm_"+(1e6*Math.random()|0),Q={};function H(e,t,r,n,i,s){if(!t)throw Error("Invalid event type");let a=o(i)?!!i.capture:!!i,l=Y(e);if(l||(e[K]=l=new z(e)),(r=l.add(t,r,n,a,s)).proxy)return r;if(n=function e(t){return X.call(e.src,e.listener,t)},r.proxy=n,n.src=e,n.listener=r,e.addEventListener)R||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(J(t.toString()),n);else if(e.addListener&&e.removeListener)e.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return r}function W(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[P])$(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(J(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=Y(t))?($(r,e),0==r.h&&(r.src=null,t[K]=null)):V(e)}}}function J(e){return e in Q?Q[e]:Q[e]="on"+e}function X(e,t){if(e.da)e=!0;else{t=new M(t,this);let r=e.listener,n=e.ha||e.src;e.fa&&W(e),e=r.call(n,t)}return e}function Y(e){return(e=e[K])instanceof z?e:null}var Z="__closure_events_fn_"+(1e9*Math.random()>>>0);function ee(e){return"function"==typeof e?e:(e[Z]||(e[Z]=function(t){return e.handleEvent(t)}),e[Z])}function et(){N.call(this),this.i=new z(this),this.M=this,this.G=null}function er(e,t){let r,n;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new k(t,e);else if(t instanceof k)t.target=t.target||e;else{var a=t;j(t=new k(s,e),a)}if(a=!0,i)for(n=i.length-1;n>=0;n--)a=en(r=t.g=i[n],s,!0,t)&&a;if(a=en(r=t.g=e,s,!0,t)&&a,a=en(r,s,!1,t)&&a,i)for(n=0;n<i.length;n++)a=en(r=t.g=i[n],s,!1,t)&&a}function en(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let a=t[s];if(a&&!a.da&&a.capture==r){let t=a.listener,r=a.ha||a.src;a.fa&&$(e.i,a),i=!1!==t.call(r,n)&&i}}return i&&!n.defaultPrevented}v(et,N),et.prototype[P]=!0,et.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,i,s){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);else(i=o(i)?!!i.capture:!!i,n=ee(n),t&&t[P])?(t=t.i,(a=String(r).toString())in t.g&&(n=G(r=t.g[a],n,i,s))>-1&&(V(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[a],t.h--))):t&&(t=Y(t))&&(r=t.g[r.toString()],t=-1,r&&(t=G(r,n,i,s)),(n=t>-1?r[t]:null)&&W(n))}(this,e,t,r,n)},et.prototype.N=function(){if(et.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let r=e.g[t];for(let e=0;e<r.length;e++)V(r[e]);delete e.g[t],e.h--}}this.G=null},et.prototype.J=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},et.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class ei extends N{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=y(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:a.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function es(e){N.call(this),this.h=e,this.g={}}v(es,N);var ea=[];function eo(e){B(e.g,function(e,t){this.g.hasOwnProperty(t)&&W(e)},e),e.g={}}es.prototype.N=function(){es.Z.N.call(this),eo(this)},es.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var el=a.JSON.stringify,eu=a.JSON.parse,eh=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function ec(){}function ed(){}var ef={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ep(){k.call(this,"d")}function eg(){k.call(this,"c")}v(ep,k),v(eg,k);var em={},ey=null;function ew(){return ey=ey||new et}function ev(e){k.call(this,em.Ia,e)}function eb(e){let t=ew();er(t,new ev(t))}function e_(e,t){k.call(this,em.STAT_EVENT,e),this.stat=t}function eI(e){let t=ew();er(t,new e_(t,e))}function eE(e,t){k.call(this,em.Ja,e),this.size=t}function eT(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function eS(){this.g=!0}function ex(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var r=s[e];if(!(r.length<2)){var n=r[1];if(Array.isArray(n)&&!(n.length<1)){var i=n[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<n.length;e++)n[e]=""}}}}return el(s)}catch(e){return t}}(e,r)+(n?" "+n:"")})}em.Ia="serverreachability",v(ev,k),em.STAT_EVENT="statevent",v(e_,k),em.Ja="timingevent",v(eE,k),eS.prototype.ua=function(){this.g=!1},eS.prototype.info=function(){};var eC={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eA={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function eD(){}function eN(e){return encodeURIComponent(String(e))}function ek(e,t,r,n){this.j=e,this.i=t,this.l=r,this.S=n||1,this.V=new es(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eR}function eR(){this.i=null,this.g="",this.h=!1}v(eD,ec),eD.prototype.g=function(){return new XMLHttpRequest},e=new eD;var eO={},eM={};function eP(e,t,r){e.M=1,e.A=e5(e0(t)),e.u=r,e.R=!0,eL(e,null)}function eL(e,t){e.F=Date.now(),eV(e),e.B=e0(e.A);var r,n,i,s,a,l,u=e.B,h=e.S;Array.isArray(h)||(h=[String(h)]),tu(u.i,"t",h),e.C=0,u=e.j.L,e.h=new eR,e.g=tX(e.j,u?t:null,!e.u),e.P>0&&(e.O=new ei(y(e.Y,e,e.g),e.P)),t=e.V,u=e.g,h=e.ba;var c="readystatechange";Array.isArray(c)||(c&&(ea[0]=c.toString()),c=ea);for(let e=0;e<c.length;e++){let r=function e(t,r,n,i,s){if(i&&i.once)return function e(t,r,n,i,s){if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=ee(n),t&&t[P]?t.K(r,n,o(i)?!!i.capture:!!i,s):H(t,r,n,!0,i,s)}(t,r,n,i,s);if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=ee(n),t&&t[P]?t.J(r,n,o(i)?!!i.capture:!!i,s):H(t,r,n,!1,i,s)}(u,c[e],h||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}t=e.J?U(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),eb(),r=e.i,n=e.v,i=e.B,s=e.l,a=e.S,l=e.u,r.info(function(){if(r.g)if(l){var e="",t=l.split("&");for(let r=0;r<t.length;r++){var o=t[r].split("=");if(o.length>1){let t=o[0];o=o[1];let r=t.split("_");e=r.length>=2&&"type"==r[1]?e+(t+"=")+o+"&":e+(t+"=redacted&")}}}else e=null;else e=l;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+n+"\n"+i+"\n"+e})}function eF(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eV(e){e.T=Date.now()+e.H,eB(e,e.H)}function eB(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eT(y(e.aa,e),t)}function eU(e){e.D&&(a.clearTimeout(e.D),e.D=null)}function eq(e){0==e.j.I||e.K||tK(e.j,e)}function ej(e){eU(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eo(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function ez(e,t){try{var r=e.j;if(0!=r.I&&(r.g==e||eH(r.h,e))){if(!e.L&&eH(r.h,e)&&3==r.I){try{var n=r.Ba.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.v){if(r.g)if(r.g.F+3e3<e.F)tG(r),tP(r);else break e;tj(r),eI(18)}}else r.xa=i[1],0<r.xa-r.K&&i[2]<37500&&r.F&&0==r.A&&!r.C&&(r.C=eT(y(r.Va,r),6e3));1>=eQ(r.h)&&r.ta&&(r.ta=void 0)}else tH(r,11)}else if((e.L||r.g==e)&&tG(r),!O(t))for(i=r.Ba.g.parse(t),t=0;t<i.length;t++){let o=i[t],l=o[0];if(!(l<=r.K))if(r.K=l,o=o[1],2==r.I)if("c"==o[0]){r.M=o[1],r.ba=o[2];let t=o[3];null!=t&&(r.ka=t,r.j.info("VER="+r.ka));let i=o[4];null!=i&&(r.za=i,r.j.info("SVER="+r.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(r.O=n=1.5*l,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=n.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eW(s,s.h),s.h=null))}if(n.G){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.wa=e,e3(n.J,n.G,e))}}if(r.I=3,r.l&&r.l.ra(),r.aa&&(r.T=Date.now()-e.F,r.j.info("Handshake RTT: "+r.T+"ms")),(n=r).na=tJ(n,n.L?n.ba:null,n.W),e.L){eJ(n.h,e);var a=n.O;a&&(e.H=a),e.D&&(eU(e),eV(e)),n.g=e}else tq(n);r.i.length>0&&tF(r)}else"stop"!=o[0]&&"close"!=o[0]||tH(r,7);else 3==r.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tH(r,7):tR(r):"noop"!=o[0]&&r.l&&r.l.qa(o),r.A=0)}}eb(4)}catch(e){}}ek.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tA(e)?t.j():this.Y(e)},ek.prototype.Y=function(e){try{if(e==this.g)e:{let f=tA(this.g),p=this.g.ya(),g=this.g.ca();if(!(f<3)&&(3!=f||this.g&&(this.h.h||this.g.la()||tD(this.g)))){this.K||4!=f||7==p||(8==p||g<=0?eb(3):eb(2)),eU(this);var t=this.g.ca();this.X=t;var r=function(e){if(!eF(e))return e.g.la();let t=tD(e.g);if(""===t)return"";let r="",n=t.length,i=4==tA(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return ej(e),eq(e),"";e.h.i=new a.TextDecoder}for(let s=0;s<n;s++)e.h.h=!0,r+=e.h.i.decode(t[s],{stream:!(i&&s==n-1)});return t.length=0,e.h.g+=r,e.C=0,e.h.g}(this);if(this.o=200==t,n=this.i,i=this.v,s=this.B,o=this.l,l=this.S,n.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+l+"]: "+i+"\n"+s+"\n"+f+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var n,i,s,o,l,u,h=this.g;if((u=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!O(u)){var c=u;break t}}c=null}if(e=c)ex(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ez(this,e);else{this.o=!1,this.m=3,eI(12),ej(this),eq(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<r.length;)if((t=function(e,t){var r=e.C,n=t.indexOf("\n",r);return -1==n?eM:isNaN(r=Number(t.substring(r,n)))?eO:(n+=1)+r>t.length?eM:(t=t.slice(n,n+r),e.C=n+r,t)}(this,r))==eM){4==f&&(this.m=4,eI(14),e=!1),ex(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eO){this.m=4,eI(15),ex(this.i,this.l,r,"[Invalid Chunk]"),e=!1;break}else ex(this.i,this.l,t,null),ez(this,t);if(eF(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=f||0!=r.length||this.h.h||(this.m=1,eI(16),e=!1),this.o=this.o&&e,e){if(r.length>0&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.aa&&!d.P&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+r.length),tz(d),d.P=!0,eI(11))}}else ex(this.i,this.l,r,"[Invalid Chunked Response]"),ej(this),eq(this)}else ex(this.i,this.l,r,null),ez(this,r);4==f&&ej(this),this.o&&!this.K&&(4==f?tK(this.j,this):(this.o=!1,eV(this)))}else(function(e){let t={};e=(e.g&&tA(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(O(e[n]))continue;var r=function(e){var t=1;e=e.split(":");let r=[];for(;t>0&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}(e[n]);let i=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();let s=t[i]||[];t[i]=s,s.push(r)}var n=function(e){return e.join(", ")};for(let e in t)n.call(void 0,t[e],e,t)})(this.g),400==t&&r.indexOf("Unknown SID")>0?(this.m=3,eI(12)):(this.m=0,eI(13)),ej(this),eq(this)}}}catch(e){}finally{}},ek.prototype.cancel=function(){this.K=!0,ej(this)},ek.prototype.aa=function(){var e,t;this.D=null;let r=Date.now();r-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(eb(),eI(17)),ej(this),this.m=2,eq(this)):eB(this,this.T-r)};var e$=class{constructor(e,t){this.g=e,this.map=t}};function eG(e){this.l=e||10,e=a.PerformanceNavigationTiming?(e=a.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eK(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eQ(e){return e.h?1:e.g?e.g.size:0}function eH(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eW(e,t){e.g?e.g.add(t):e.h=t}function eJ(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eX(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let r of e.g.values())t=t.concat(r.G);return t}return _(e.i)}eG.prototype.cancel=function(){if(this.i=eX(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var eY=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eZ(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof eZ?(this.l=e.l,e1(this,e.j),this.o=e.o,this.g=e.g,e2(this,e.u),this.h=e.h,e6(this,th(e.i)),this.m=e.m):e&&(t=String(e).match(eY))?(this.l=!1,e1(this,t[1]||"",!0),this.o=e4(t[2]||""),this.g=e4(t[3]||"",!0),e2(this,t[4]),this.h=e4(t[5]||"",!0),e6(this,t[6]||"",!0),this.m=e4(t[7]||"")):(this.l=!1,this.i=new ti(null,this.l))}function e0(e){return new eZ(e)}function e1(e,t,r){e.j=r?e4(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e2(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e6(e,t,r){var n,i;t instanceof ti?(e.i=t,n=e.i,(i=e.l)&&!n.j&&(ts(n),n.i=null,n.g.forEach(function(e,t){let r=t.toLowerCase();t!=r&&(ta(this,t),tu(this,r,e))},n)),n.j=i):(r||(t=e8(t,tr)),e.i=new ti(t,e.l))}function e3(e,t,r){e.i.set(t,r)}function e5(e){return e3(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e4(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e8(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,e7),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function e7(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}eZ.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e8(t,e9,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e8(t,e9,!0),"@"),e.push(eN(r).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.u)&&e.push(":",String(r))),(r=this.h)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(e8(r,"/"==r.charAt(0)?tt:te,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",e8(r,tn)),e.join("")},eZ.prototype.resolve=function(e){let t=e0(this),r=!!e.j;r?e1(t,e.j):r=!!e.o,r?t.o=e.o:r=!!e.g,r?t.g=e.g:r=null!=e.u;var n=e.h;if(r)e2(t,e.u);else if(r=!!e.h){if("/"!=n.charAt(0))if(this.g&&!this.h)n="/"+n;else{var i=t.h.lastIndexOf("/");-1!=i&&(n=t.h.slice(0,i+1)+n)}if(".."==(i=n)||"."==i)n="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){n=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let r=i[t++];"."==r?n&&t==i.length&&e.push(""):".."==r?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),n&&t==i.length&&e.push("")):(e.push(r),n=!0)}n=e.join("/")}else n=i}return r?t.h=n:r=""!==e.i.toString(),r?e6(t,th(e.i)):r=!!e.m,r&&(t.m=e.m),t};var e9=/[#\/\?@]/g,te=/[#\?:]/g,tt=/[#\?]/g,tr=/[#\?@]/g,tn=/#/g;function ti(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ts(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let r=0;r<e.length;r++){let n=e[r].indexOf("="),i,s=null;n>=0?(i=e[r].substring(0,n),s=e[r].substring(n+1)):i=e[r],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function ta(e,t){ts(e),t=tc(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function to(e,t){return ts(e),t=tc(e,t),e.g.has(t)}function tl(e,t){ts(e);let r=[];if("string"==typeof t)to(e,t)&&(r=r.concat(e.g.get(tc(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)r=r.concat(e[t]);return r}function tu(e,t,r){ta(e,t),r.length>0&&(e.i=null,e.g.set(tc(e,t),_(r)),e.h+=r.length)}function th(e){let t=new ti;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tc(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function td(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(e){}}function tf(){this.g=new eh}function tp(e){this.i=e.Sb||null,this.h=e.ab||!1}function tg(e,t){et.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tm(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function ty(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tw(e)}function tw(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tv(e){let t="";return B(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function tb(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=tv(r),"string"==typeof e?null!=r&&eN(r):e3(e,t,r))}function t_(e){et.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ti.prototype).add=function(e,t){ts(this),this.i=null,e=tc(this,e);let r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},t.forEach=function(e,t){ts(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},t.set=function(e,t){return ts(this),this.i=null,to(this,e=tc(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=tl(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let n=0;n<t.length;n++){var r=t[n];let i=eN(r);r=tl(this,r);for(let t=0;t<r.length;t++){let n=i;""!==r[t]&&(n+="="+eN(r[t])),e.push(n)}}return this.i=e.join("&")},v(tp,ec),tp.prototype.g=function(){return new tg(this.i,this.h)},v(tg,et),(t=tg.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tw(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||a).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,ty(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tw(this)),this.g&&(this.readyState=3,tw(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tm(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ty(this):tw(this),3==this.readyState&&tm(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,ty(this))},t.Na=function(e){this.g&&(this.response=e,ty(this))},t.ga=function(){this.g&&ty(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var r=t.next();!r.done;)e.push((r=r.value)[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(tg.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),v(t_,et);var tI=/^https?$/i,tE=["POST","PUT"];function tT(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tS(e),tC(e)}function tS(e){e.A||(e.A=!0,er(e,"complete"),er(e,"error"))}function tx(e){if(e.h&&void 0!==s){if(e.v&&4==tA(e))setTimeout(e.Ca.bind(e),0);else if(er(e,"readystatechange"),4==tA(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,r,n=!0;break;default:n=!1}if(!(t=n)){if(r=0===s){let t=String(e.D).match(eY)[1]||null;!t&&a.self&&a.self.location&&(t=a.self.location.protocol.slice(0,-1)),r=!tI.test(t?t.toLowerCase():"")}t=r}if(t)er(e,"complete"),er(e,"success");else{e.o=6;try{var i=tA(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tS(e)}}finally{tC(e)}}}}function tC(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let r=e.g;e.g=null,t||er(e,"ready");try{r.onreadystatechange=null}catch(e){}}}function tA(e){return e.g?e.g.readyState:0}function tD(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tN(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function tk(e){this.za=0,this.i=[],this.j=new eS,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tN("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tN("baseRetryDelayMs",5e3,e),this.Za=tN("retryDelaySeedMs",1e4,e),this.Ta=tN("forwardChannelMaxRetries",2,e),this.va=tN("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eG(e&&e.concurrentRequestLimit),this.Ba=new tf,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tR(e){if(tL(e),3==e.I){var t=e.V++,r=e0(e.J);if(e3(r,"SID",e.M),e3(r,"RID",t),e3(r,"TYPE","terminate"),tB(e,r),(t=new ek(e,e.j,t)).M=2,t.A=e5(e0(r)),r=!1,a.navigator&&a.navigator.sendBeacon)try{r=a.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!r&&a.Image&&((new Image).src=t.A,r=!0),r||(t.g=tX(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eV(t)}tW(e)}function tP(e){e.g&&(tz(e),e.g.cancel(),e.g=null)}function tL(e){tP(e),e.v&&(a.clearTimeout(e.v),e.v=null),tG(e),e.h.cancel(),e.m&&("number"==typeof e.m&&a.clearTimeout(e.m),e.m=null)}function tF(e){if(!eK(e.h)&&!e.m){e.m=!0;var t=e.Ea;S||A(),x||(S(),x=!0),C.add(t,e),e.D=0}}function tV(e,t){var r;r=t?t.l:e.V++;let n=e0(e.J);e3(n,"SID",e.M),e3(n,"RID",r),e3(n,"AID",e.K),tB(e,n),e.u&&e.o&&tb(n,e.u,e.o),r=new ek(e,e.j,r,e.D+1),null===e.u&&(r.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tU(e,r,1e3),r.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eW(e.h,r),eP(r,n,t)}function tB(e,t){e.H&&B(e.H,function(e,r){e3(t,r,e)}),e.l&&B({},function(e,r){e3(t,r,e)})}function tU(e,t,r){r=Math.min(e.i.length,r);let n=e.l?y(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+r];-1==t?r>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let u=0;u<r;u++){var s=i[u].g;let r=i[u].map;if((s-=t)<0)t=Math.max(0,i[u].g-100),l=!1;else try{s="req"+s+"_";try{var a=r instanceof Map?r:Object.entries(r);for(let[t,r]of a){let n=r;o(r)&&(n=el(r)),e.push(s+t+"="+encodeURIComponent(n))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){n&&n(r)}}if(l){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,r),a}function tq(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;S||A(),x||(S(),x=!0),C.add(t,e),e.A=0}}function tj(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eT(y(e.Da,e),tQ(e,e.A)),e.A++,!0)}function tz(e){null!=e.B&&(a.clearTimeout(e.B),e.B=null)}function t$(e){e.g=new ek(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e0(e.na);e3(t,"RID","rpc"),e3(t,"SID",e.M),e3(t,"AID",e.K),e3(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e3(t,"TO",e.ia),e3(t,"TYPE","xmlhttp"),tB(e,t),e.u&&e.o&&tb(t,e.u,e.o),e.O&&(e.g.H=e.O);var r=e.g;e=e.ba,r.M=1,r.A=e5(e0(t)),r.u=null,r.R=!0,eL(r,e)}function tG(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function tK(e,t){var r,n=null;if(e.g==t){tG(e),tz(e),e.g=null;var i=2}else{if(!eH(e.h,t))return;n=t.G,eJ(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;er(i=ew(),new eE(i,n)),tF(e)}else tq(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(r=t,!(eQ(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=r.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eT(y(e.Ea,e,r),tQ(e,e.D)),e.D++,!0)))||2==i&&tj(e)))switch(n&&n.length>0&&((t=e.h).i=t.i.concat(n)),s){case 1:tH(e,5);break;case 4:tH(e,10);break;case 3:tH(e,6);break;default:tH(e,2)}}}function tQ(e,t){let r=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(r*=2),r*t}function tH(e,t){if(e.j.info("Error code "+t),2==t){let t,s,o;var r,n=y(e.bb,e),i=e.Ua;let l=!i;i=new eZ(i||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||e1(i,"https"),e5(i),l?function(e,t){let r=new eS;if(a.Image){let n=new Image;n.onload=w(td,r,"TestLoadImage: loaded",!0,t,n),n.onerror=w(td,r,"TestLoadImage: error",!1,t,n),n.onabort=w(td,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=w(td,r,"TestLoadImage: timeout",!1,t,n),a.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(i.toString(),n):(r=i.toString(),t=new eS,s=new AbortController,o=setTimeout(()=>{s.abort(),td(t,"TestPingServer: timeout",!1,n)},1e4),fetch(r,{signal:s.signal}).then(e=>{clearTimeout(o),e.ok?td(t,"TestPingServer: ok",!0,n):td(t,"TestPingServer: server error",!1,n)}).catch(()=>{clearTimeout(o),td(t,"TestPingServer: error",!1,n)}))}else eI(2);e.I=0,e.l&&e.l.pa(t),tW(e),tL(e)}function tW(e){if(e.I=0,e.ja=[],e.l){let t=eX(e.h);(0!=t.length||0!=e.i.length)&&(I(e.ja,t),I(e.ja,e.i),e.h.i.length=0,_(e.i),e.i.length=0),e.l.oa()}}function tJ(e,t,r){var n=r instanceof eZ?e0(r):new eZ(r);if(""!=n.g)t&&(n.g=t+"."+n.g),e2(n,n.u);else{var i=a.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new eZ(null);n&&e1(e,n),t&&(e.g=t),i&&e2(e,i),r&&(e.h=r),n=e}return r=e.G,t=e.wa,r&&t&&e3(n,r,t),e3(n,"VER",e.ka),tB(e,n),n}function tX(e,t,r){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new t_(e.Aa&&!e.ma?new tp({ab:r}):e.ma)).Fa(e.L),t}function tY(){}function tZ(){}function t0(e,t){et.call(this),this.g=new tk(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!O(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!O(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t6(this)}function t1(e){ep.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t2(){eg.call(this),this.status=1}function t6(e){this.g=e}(t=t_.prototype).Fa=function(e){this.H=e},t.ea=function(t,r,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);r=r?r.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=b(y(this.Ca,this));try{this.B=!0,this.g.open(r,String(t),!0),this.B=!1}catch(e){tT(this,e);return}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())n.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,o]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=a.FormData&&t instanceof a.FormData,!(Array.prototype.indexOf.call(tE,r,void 0)>=0)||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(e,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tT(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,er(this,"complete"),er(this,"abort"),tC(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tC(this,!0)),t_.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tx(this):this.Xa())},t.Xa=function(){tx(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tA(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eu(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tk.prototype).ka=8,t.I=1,t.connect=function(e,t,r,n){eI(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.J=tJ(this,null,this.W),tF(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new ek(this,this.j,e),s=this.o;if(this.U&&(s?j(s=U(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,r=0;r<this.i.length;r++){t:{var n=this.i[r];if("__data__"in n.map&&"string"==typeof(n=n.map.__data__)){n=n.length;break t}n=void 0}if(void 0===n)break;if((t+=n)>4096){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tU(this,i,t),e3(r=e0(this.J),"RID",e),e3(r,"CVER",22),this.G&&e3(r,"X-HTTP-Session-Id",this.G),tB(this,r),s&&(this.R?t="headers="+eN(tv(s))+"&"+t:this.u&&tb(r,this.u,s)),eW(this.h,i),this.Ra&&e3(r,"TYPE","init"),this.S?(e3(r,"$req",t),e3(r,"SID","null"),i.U=!0,eP(i,r,null)):eP(i,r,t),this.I=2}}else 3==this.I&&(e?tV(this,e):0==this.i.length||eK(this.h)||tV(this))},t.Da=function(){if(this.v=null,t$(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eT(y(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,eI(10),tP(this),t$(this))},t.Va=function(){null!=this.C&&(this.C=null,tP(this),tj(this),eI(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),eI(2)):(this.j.info("Failed to ping google.com"),eI(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tY.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tZ.prototype.g=function(e,t){return new t0(e,t)},v(t0,et),t0.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},t0.prototype.close=function(){tR(this.g)},t0.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.v&&((r={}).__data__=el(e),e=r);t.i.push(new e$(t.Ya++,e)),3==t.I&&tF(t)},t0.prototype.N=function(){this.g.l=null,delete this.j,tR(this.g),delete this.g,t0.Z.N.call(this)},v(t1,ep),v(t2,eg),v(t6,tY),t6.prototype.ra=function(){er(this.g,"a")},t6.prototype.qa=function(e){er(this.g,new t1(e))},t6.prototype.pa=function(e){er(this.g,new t2)},t6.prototype.oa=function(){er(this.g,"b")},tZ.prototype.createWebChannel=tZ.prototype.g,t0.prototype.send=t0.prototype.o,t0.prototype.open=t0.prototype.m,t0.prototype.close=t0.prototype.close,g=tM.createWebChannelTransport=function(){return new tZ},p=tM.getStatEventTarget=function(){return ew()},f=tM.Event=em,d=tM.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},eC.NO_ERROR=0,eC.TIMEOUT=8,eC.HTTP_ERROR=6,c=tM.ErrorCode=eC,eA.COMPLETE="complete",h=tM.EventType=eA,ed.EventType=ef,ef.OPEN="a",ef.CLOSE="b",ef.ERROR="c",ef.MESSAGE="d",et.prototype.listen=et.prototype.J,u=tM.WebChannel=ed,tM.FetchXmlHttpFactory=tp,t_.prototype.listenOnce=t_.prototype.K,t_.prototype.getLastError=t_.prototype.Ha,t_.prototype.getLastErrorCode=t_.prototype.ya,t_.prototype.getStatus=t_.prototype.ca,t_.prototype.getResponseJson=t_.prototype.La,t_.prototype.getResponseText=t_.prototype.la,t_.prototype.send=t_.prototype.ea,t_.prototype.setWithCredentials=t_.prototype.Fa,l=tM.XhrIo=t_}).apply(void 0!==tO?tO:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});let tP="@firebase/firestore",tL="4.9.3";class tF{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}tF.UNAUTHENTICATED=new tF(null),tF.GOOGLE_CREDENTIALS=new tF("google-credentials-uid"),tF.FIRST_PARTY=new tF("first-party-uid"),tF.MOCK_USER=new tF("mock-user");let tV="12.7.0",tB=new eB("@firebase/firestore");function tU(){return tB.logLevel}function tq(e){tB.setLogLevel(e)}function tj(e,...t){if(tB.logLevel<=s.DEBUG){let r=t.map(tG);tB.debug(`Firestore (${tV}): ${e}`,...r)}}function tz(e,...t){if(tB.logLevel<=s.ERROR){let r=t.map(tG);tB.error(`Firestore (${tV}): ${e}`,...r)}}function t$(e,...t){if(tB.logLevel<=s.WARN){let r=t.map(tG);tB.warn(`Firestore (${tV}): ${e}`,...r)}}function tG(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function tK(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,tQ(e,n,r)}function tQ(e,t,r){let n=`FIRESTORE (${tV}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw tz(n),Error(n)}function tH(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||tQ(t,i,n)}function tW(e,t){e||tK(57014,t)}let tJ={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class tX extends es{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class tY{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class tZ{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class t0{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(tF.UNAUTHENTICATED))}shutdown(){}}class t1{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class t2{constructor(e){this.t=e,this.currentUser=tF.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){tH(void 0===this.o,42304);let r=this.i,n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve(),i=new tY;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new tY,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{tj("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(tj("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new tY)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(tj("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(tH("string"==typeof t.accessToken,31837,{l:t}),new tZ(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return tH(null===e||"string"==typeof e,2055,{h:e}),new tF(e)}}class t6{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=tF.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class t3{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new t6(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(tF.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class t5{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class t4{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ta(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){tH(void 0===this.o,3512);let r=e=>{null!=e.error&&tj("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.m;return this.m=e.token,tj("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{tj("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?n(e):tj("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new t5(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(tH("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new t5(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class t8{getToken(){return Promise.resolve(new t5(""))}invalidateToken(){}start(e,t){}shutdown(){}}class t7{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let r=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let e=0;e<40;e++)r[e]=Math.floor(256*Math.random());return r}(0);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function t9(e,t){return e<t?-1:+(e>t)}function re(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),i=t.charAt(n);if(r!==i)return rt(r)===rt(i)?t9(r,i):rt(r)?1:-1}return t9(e.length,t.length)}function rt(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function rr(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}let rn="__name__";class ri{constructor(e,t,r){void 0===t?t=0:t>e.length&&tK(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&tK(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===ri.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof ri?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=ri.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return t9(e.length,t.length)}static compareSegments(e,t){let r=ri.isNumericId(e),n=ri.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?ri.extractNumericId(e).compare(ri.extractNumericId(t)):re(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return a.fromString(e.substring(4,e.length-2))}}class rs extends ri{construct(e,t,r){return new rs(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new tX(tJ.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new rs(t)}static emptyPath(){return new rs([])}}let ra=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ro extends ri{construct(e,t,r){return new ro(e,t,r)}static isValidIdentifier(e){return ra.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ro.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===rn}static keyField(){return new ro([rn])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new tX(tJ.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new tX(tJ.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new tX(tJ.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new tX(tJ.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ro(t)}static emptyPath(){return new ro([])}}class rl{constructor(e){this.path=e}static fromPath(e){return new rl(rs.fromString(e))}static fromName(e){return new rl(rs.fromString(e).popFirst(5))}static empty(){return new rl(rs.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===rs.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return rs.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new rl(new rs(e.slice()))}}function ru(e,t,r){if(!r)throw new tX(tJ.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function rh(e,t,r,n){if(!0===t&&!0===n)throw new tX(tJ.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)}function rc(e){if(!rl.isDocumentKey(e))throw new tX(tJ.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function rd(e){if(rl.isDocumentKey(e))throw new tX(tJ.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function rf(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function rp(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let r=(t=e).constructor?t.constructor.name:null;return r?`a custom ${r} object`:"an object"}}return"function"==typeof e?"a function":tK(12329,{type:typeof e})}function rg(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new tX(tJ.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=rp(e);throw new tX(tJ.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function rm(e,t){if(t<=0)throw new tX(tJ.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function ry(e,t){let r={typeString:e};return t&&(r.value=t),r}function rw(e,t){let r;if(!rf(e))throw new tX(tJ.INVALID_ARGUMENT,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new tX(tJ.INVALID_ARGUMENT,r);return!0}class rv{static now(){return rv.fromMillis(Date.now())}static fromDate(e){return rv.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*1e6);return new rv(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new tX(tJ.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new tX(tJ.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?t9(this.nanoseconds,e.nanoseconds):t9(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:rv._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(rw(e,rv._jsonSchema))return new rv(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}rv._jsonSchemaVersion="firestore/timestamp/1.0",rv._jsonSchema={type:ry("string",rv._jsonSchemaVersion),seconds:ry("number"),nanoseconds:ry("number")};class rb{static fromTimestamp(e){return new rb(e)}static min(){return new rb(new rv(0,0))}static max(){return new rb(new rv(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class r_{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function rI(e){return e.fields.find(e=>2===e.kind)}function rE(e){return e.fields.filter(e=>2!==e.kind)}function rT(e,t){let r=t9(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=function(e,t){let r=ro.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:t9(e.kind,t.kind)}(e.fields[n],t.fields[n])))return r;return t9(e.fields.length,t.fields.length)}r_.UNKNOWN_ID=-1;class rS{constructor(e,t){this.fieldPath=e,this.kind=t}}class rx{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new rx(0,rD.min())}}function rC(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new rD(rb.fromTimestamp(1e9===n?new rv(r+1,0):new rv(r,n)),rl.empty(),t)}function rA(e){return new rD(e.readTime,e.key,-1)}class rD{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new rD(rb.min(),rl.empty(),-1)}static max(){return new rD(rb.max(),rl.empty(),-1)}}function rN(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=rl.comparator(e.documentKey,t.documentKey))?r:t9(e.largestBatchId,t.largestBatchId)}let rk="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class rR{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function rO(e){if(e.code!==tJ.FAILED_PRECONDITION||e.message!==rk)throw e;tj("LocalStore","Unexpectedly lost primary lease")}class rM{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&tK(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new rM((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof rM?t:rM.resolve(t)}catch(e){return rM.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):rM.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):rM.reject(t)}static resolve(e){return new rM((t,r)=>{t(e)})}static reject(e){return new rM((t,r)=>{r(e)})}static waitFor(e){return new rM((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=rM.resolve(!1);for(let r of e)t=t.next(e=>e?rM.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new rM((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new rM((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let rP="SimpleDb";class rL{static open(e,t,r,n){try{return new rL(t,e.transaction(n,r))}catch(e){throw new rU(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new tY,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new rU(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let r=rG(t.target.error);this.S.reject(new rU(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(tj(rP,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new rj(this.transaction.objectStore(e))}}class rF{static delete(e){return tj(rP,"Removing database:",e),rz(R().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!en())return!1;if(rF.F())return!0;let e=G(),t=rF.M(e),r=rV(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<r&&r<4.5)}static F(){return void 0!==b.default&&"YES"===b.default.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,12.2===rF.M(G())&&tz("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(tj(rP,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new rU(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new tX(tJ.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new tX(tJ.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new rU(e,n))},n.onupgradeneeded=e=>{tj(rP,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.N.k(t,n.transaction,e.oldVersion,this.version).next(()=>{tj(rP,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=e=>this.q(e)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.L(e);let t=rL.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),rM.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(tj(rP,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function rV(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class rB{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return rz(this.U.delete())}}class rU extends tX{constructor(e,t){super(tJ.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function rq(e){return"IndexedDbTransactionError"===e.name}class rj{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(tj(rP,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(tj(rP,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),rz(r)}add(e){return tj(rP,"ADD",this.store.name,e,e),rz(this.store.add(e))}get(e){return rz(this.store.get(e)).next(t=>(void 0===t&&(t=null),tj(rP,"GET",this.store.name,e,t),t))}delete(e){return tj(rP,"DELETE",this.store.name,e),rz(this.store.delete(e))}count(){return tj(rP,"COUNT",this.store.name),rz(this.store.count())}J(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new rM((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.H(e,(e,r)=>{t.push(r)}).next(()=>t)}}Y(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new rM((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}Z(e,t){tj(rP,"DELETE ALL",this.store.name);let r=this.options(e,t);r.X=!1;let n=this.cursor(r);return this.H(n,(e,t,r)=>r.delete())}ee(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.H(n,t)}te(e){let t=this.cursor({});return new rM((r,n)=>{t.onerror=e=>{n(rG(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}H(e,t){let r=[];return new rM((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new rB(i),a=t(i.primaryKey,i.value,s);if(a instanceof rM){let e=a.catch(e=>(s.done(),rM.reject(e)));r.push(e)}s.isDone?n():null===s.G?i.continue():i.continue(s.G)}}).next(()=>rM.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function rz(e){return new rM((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(rG(e.target.error))}})}let r$=!1;function rG(e){let t=rF.M(G());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new tX("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return r$||(r$=!0,setTimeout(()=>{throw e},0)),e}}return e}let rK="IndexBackfiller";class rQ{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){tj(rK,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.ne.ie();tj(rK,`Documents written: ${e}`)}catch(e){rq(e)?tj(rK,"Ignoring IndexedDB error during index backfill: ",e):await rO(e)}await this.re(6e4)})}}class rH{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){let r=new Set,n=t,i=!0;return rM.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!r.has(t))return tj(rK,`Processing collection: ${t}`),this.oe(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this._e(n,r)).next(r=>(tj(rK,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}_e(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=rA(t);rN(n,r)>0&&(r=n)}),new rD(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class rW{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}function rJ(e){return null==e}function rX(e){return 0===e&&1/e==-1/0}function rY(e){return"number"==typeof e&&Number.isInteger(e)&&!rX(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function rZ(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+="\x01\x10";break;case"\x01":r+="\x01\x11";break;default:r+=n}}return r}(e.get(r),t);return t+"\x01\x01"}rW.ce=-1;function r0(e){let t=e.length;if(tH(t>=2,64408,{path:e}),2===t)return tH("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),rs.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>r)&&tK(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:tK(61167,{path:e})}s=t+2}return new rs(n)}let r1="remoteDocuments",r2="owner",r6="owner",r3="mutationQueues",r5="mutations",r4="batchId",r8="userMutationsIndex",r7=["userId","batchId"],r9={},ne="documentMutations",nt="remoteDocumentsV14",nr=["prefixPath","collectionGroup","readTime","documentId"],nn="documentKeyIndex",ni=["prefixPath","collectionGroup","documentId"],ns="collectionGroupIndex",na=["collectionGroup","readTime","prefixPath","documentId"],no="remoteDocumentGlobal",nl="remoteDocumentGlobalKey",nu="targets",nh="queryTargetsIndex",nc=["canonicalId","targetId"],nd="targetDocuments",nf=["targetId","path"],np="documentTargetsIndex",ng=["path","targetId"],nm="targetGlobalKey",ny="targetGlobal",nw="collectionParents",nv=["collectionId","parent"],nb="clientMetadata",n_="bundles",nI="namedQueries",nE="indexConfiguration",nT="collectionGroupIndex",nS="indexState",nx=["indexId","uid"],nC="sequenceNumberIndex",nA=["uid","sequenceNumber"],nD="indexEntries",nN=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],nk="documentKeyIndex",nR=["indexId","uid","orderedDocumentKey"],nO="documentOverlays",nM=["userId","collectionPath","documentId"],nP="collectionPathOverlayIndex",nL=["userId","collectionPath","largestBatchId"],nF="collectionGroupOverlayIndex",nV=["userId","collectionGroup","largestBatchId"],nB="globals",nU=[r3,r5,ne,r1,nu,r2,ny,nd,nb,no,nw,n_,nI],nq=[...nU,nO],nj=[r3,r5,ne,nt,nu,r2,ny,nd,nb,no,nw,n_,nI,nO],nz=[...nj,nE,nS,nD],n$=[...nz,nB];class nG extends rR{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function nK(e,t){return rF.O(e.le,t)}function nQ(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function nH(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function nW(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}function nJ(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class nX{constructor(e,t){this.comparator=e,this.root=t||nZ.EMPTY}insert(e,t){return new nX(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,nZ.BLACK,null,null))}remove(e){return new nX(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nZ.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new nY(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new nY(this.root,e,this.comparator,!1)}getReverseIterator(){return new nY(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new nY(this.root,e,this.comparator,!0)}}class nY{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class nZ{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:nZ.RED,this.left=null!=n?n:nZ.EMPTY,this.right=null!=i?i:nZ.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new nZ(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return nZ.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return nZ.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,nZ.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,nZ.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw tK(43730,{key:this.key,value:this.value});if(this.right.isRed())throw tK(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw tK(27949);return e+ +!this.isRed()}}nZ.EMPTY=null,nZ.RED=!0,nZ.BLACK=!1,nZ.EMPTY=new class{constructor(){this.size=0}get key(){throw tK(57766)}get value(){throw tK(16141)}get color(){throw tK(16727)}get left(){throw tK(29726)}get right(){throw tK(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new nZ(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class n0{constructor(e){this.comparator=e,this.data=new nX(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new n1(this.data.getIterator())}getIteratorFrom(e){return new n1(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof n0)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n0(this.comparator);return t.data=e,t}}class n1{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function n2(e){return e.hasNext()?e.getNext():void 0}class n6{constructor(e){this.fields=e,e.sort(ro.comparator)}static empty(){return new n6([])}unionWith(e){let t=new n0(ro.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new n6(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return rr(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class n3 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function n5(){return"undefined"!=typeof atob}class n4{constructor(e){this.binaryString=e}static fromBase64String(e){return new n4(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new n3("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new n4(function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return t9(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}n4.EMPTY_BYTE_STRING=new n4("");let n8=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function n7(e){if(tH(!!e,39018),"string"==typeof e){let t=0,r=n8.exec(e);if(tH(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:n9(e.seconds),nanos:n9(e.nanos)}}function n9(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ie(e){return"string"==typeof e?n4.fromBase64String(e):n4.fromUint8Array(e)}let it="server_timestamp",ir="__type__",ii="__previous_value__",is="__local_write_time__";function ia(e){return(e?.mapValue?.fields||{})[ir]?.stringValue===it}function io(e){let t=e.mapValue.fields[ii];return ia(t)?io(t):t}function il(e){let t=n7(e.mapValue.fields[is].timestampValue);return new rv(t.seconds,t.nanos)}class iu{constructor(e,t,r,n,i,s,a,o,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u}}let ih="(default)";class ic{constructor(e,t){this.projectId=e,this.database=t||ih}static empty(){return new ic("","")}get isDefaultDatabase(){return this.database===ih}isEqual(e){return e instanceof ic&&e.projectId===this.projectId&&e.database===this.database}}let id="__type__",ip="__max__",ig={mapValue:{fields:{__type__:{stringValue:ip}}}},im="__vector__",iy="value",iw={nullValue:"NULL_VALUE"};function iv(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ia(e)?4:iM(e)?0x1fffffffffffff:iR(e)?10:11:tK(28295,{value:e})}function ib(e,t){if(e===t)return!0;let r=iv(e);if(r!==iv(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return il(e).isEqual(il(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=n7(e.timestampValue),i=n7(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return ie(e.bytesValue).isEqual(ie(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return n9(e.geoPointValue.latitude)===n9(t.geoPointValue.latitude)&&n9(e.geoPointValue.longitude)===n9(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return n9(e.integerValue)===n9(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=n9(e.doubleValue),n=n9(t.doubleValue);return r===n?rX(r)===rX(n):isNaN(r)&&isNaN(n)}return!1;case 9:return rr(e.arrayValue.values||[],t.arrayValue.values||[],ib);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(nQ(s)!==nQ(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!ib(s[e],a[e])))return!1;return!0;default:return tK(52216,{left:e})}}function i_(e,t){return void 0!==(e.values||[]).find(e=>ib(e,t))}function iI(e,t){var r,n,i,s,a,o;if(e===t)return 0;let l=iv(e),u=iv(t);if(l!==u)return t9(l,u);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return t9(e.booleanValue,t.booleanValue);case 2:let h,c;return h=n9(e.integerValue||e.doubleValue),h<(c=n9(t.integerValue||t.doubleValue))?-1:h>c?1:h===c?0:isNaN(h)?isNaN(c)?0:-1:1;case 3:return iE(e.timestampValue,t.timestampValue);case 4:return iE(il(e),il(t));case 5:return re(e.stringValue,t.stringValue);case 6:let d,f;return r=e.bytesValue,n=t.bytesValue,d=ie(r),f=ie(n),d.compareTo(f);case 7:return function(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=t9(r[e],n[e]);if(0!==t)return t}return t9(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:let p;return i=e.geoPointValue,s=t.geoPointValue,0!==(p=t9(n9(i.latitude),n9(s.latitude)))?p:t9(n9(i.longitude),n9(s.longitude));case 9:return iT(e.arrayValue,t.arrayValue);case 10:let g,m,y,w,v;return a=e.mapValue,o=t.mapValue,g=a.fields||{},m=o.fields||{},y=g[iy]?.arrayValue,w=m[iy]?.arrayValue,0!==(v=t9(y?.values?.length||0,w?.values?.length||0))?v:iT(y,w);case 11:return function(e,t){if(e===ig.mapValue&&t===ig.mapValue)return 0;if(e===ig.mapValue)return 1;if(t===ig.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=re(n[e],s[e]);if(0!==t)return t;let a=iI(r[n[e]],i[s[e]]);if(0!==a)return a}return t9(n.length,s.length)}(e.mapValue,t.mapValue);default:throw tK(23264,{he:l})}}function iE(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return t9(e,t);let r=n7(e),n=n7(t),i=t9(r.seconds,n.seconds);return 0!==i?i:t9(r.nanos,n.nanos)}function iT(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=iI(r[e],n[e]);if(t)return t}return t9(r.length,n.length)}function iS(e){var t,r;let n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(n=n7(e.timestampValue),`time(${n.seconds},${n.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?ie(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,rl.fromName(t).toString()):"geoPointValue"in e?(r=e.geoPointValue,`geo(${r.latitude},${r.longitude})`):"arrayValue"in e?function(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=iS(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${iS(e.fields[i])}`;return r+"}"}(e.mapValue):tK(61005,{value:e})}function ix(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function iC(e){return!!e&&"integerValue"in e}function iA(e){return!!e&&"arrayValue"in e}function iD(e){return!!e&&"nullValue"in e}function iN(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ik(e){return!!e&&"mapValue"in e}function iR(e){return(e?.mapValue?.fields||{})[id]?.stringValue===im}function iO(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return nH(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=iO(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=iO(e.arrayValue.values[r]);return t}return{...e}}function iM(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===ip}let iP={mapValue:{fields:{[id]:{stringValue:im},[iy]:{arrayValue:{}}}}};function iL(e,t){let r=iI(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function iF(e,t){let r=iI(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class iV{constructor(e){this.value=e}static empty(){return new iV({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!ik(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=iO(t)}setAll(e){let t=ro.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=iO(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());ik(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ib(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];ik(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(nH(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new iV(iO(this.value))}}class iB{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new iB(e,0,rb.min(),rb.min(),rb.min(),iV.empty(),0)}static newFoundDocument(e,t,r,n){return new iB(e,1,t,rb.min(),r,n,0)}static newNoDocument(e,t){return new iB(e,2,t,rb.min(),rb.min(),iV.empty(),0)}static newUnknownDocument(e,t){return new iB(e,3,t,rb.min(),rb.min(),iV.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(rb.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=iV.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=iV.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=rb.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof iB&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new iB(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class iU{constructor(e,t){this.position=e,this.inclusive=t}}function iq(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?rl.comparator(rl.fromName(a.referenceValue),r.key):iI(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function ij(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!ib(e.position[r],t.position[r]))return!1;return!0}class iz{constructor(e,t="asc"){this.field=e,this.dir=t}}class i${}class iG extends i${constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new iY(e,t,r):"array-contains"===t?new i2(e,r):"in"===t?new i6(e,r):"not-in"===t?new i3(e,r):"array-contains-any"===t?new i5(e,r):new iG(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new iZ(e,r):new i0(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(iI(t,this.value)):null!==t&&iv(this.value)===iv(t)&&this.matchesComparison(iI(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return tK(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class iK extends i${constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new iK(e,t)}matches(e){return iQ(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function iQ(e){return"and"===e.op}function iH(e){return"or"===e.op}function iW(e){return iJ(e)&&iQ(e)}function iJ(e){for(let t of e.filters)if(t instanceof iK)return!1;return!0}function iX(e,t){let r=e.filters.concat(t);return iK.create(r,e.op)}class iY extends iG{constructor(e,t,r){super(e,t,r),this.key=rl.fromName(r.referenceValue)}matches(e){let t=rl.comparator(e.key,this.key);return this.matchesComparison(t)}}class iZ extends iG{constructor(e,t){super(e,"in",t),this.keys=i1("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class i0 extends iG{constructor(e,t){super(e,"not-in",t),this.keys=i1("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function i1(e,t){return(t.arrayValue?.values||[]).map(e=>rl.fromName(e.referenceValue))}class i2 extends iG{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return iA(t)&&i_(t.arrayValue,this.value)}}class i6 extends iG{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&i_(this.value.arrayValue,t)}}class i3 extends iG{constructor(e,t){super(e,"not-in",t)}matches(e){if(i_(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!i_(this.value.arrayValue,t)}}class i5 extends iG{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!iA(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>i_(this.value.arrayValue,e))}}class i4{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function i8(e,t=null,r=[],n=[],i=null,s=null,a=null){return new i4(e,t,r,n,i,s,a)}function i7(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof iG)return t.field.canonicalString()+t.op.toString()+iS(t.value);if(iW(t))return t.filters.map(t=>e(t)).join(",");{let r=t.filters.map(t=>e(t)).join(",");return`${t.op}(${r})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),rJ(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>iS(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>iS(e)).join(",")),e.Te=t}return e.Te}function i9(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var r,n;if(r=e.orderBy[i],n=t.orderBy[i],!(r.dir===n.dir&&r.field.isEqual(n.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!function e(t,r){return t instanceof iG?r instanceof iG&&t.op===r.op&&t.field.isEqual(r.field)&&ib(t.value,r.value):t instanceof iK?r instanceof iK&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((t,n,i)=>t&&e(n,r.filters[i]),!0):void tK(19439)}(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ij(e.startAt,t.startAt)&&ij(e.endAt,t.endAt)}function se(e){return rl.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function st(e,t){return e.filters.filter(e=>e instanceof iG&&e.field.isEqual(t))}function sr(e,t,r){let n=iw,i=!0;for(let r of st(e,t)){let e=iw,t=!0;switch(r.op){case"<":case"<=":var s;e="nullValue"in(s=r.value)?iw:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?ix(ic.empty(),rl.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?iR(s)?iP:{mapValue:{}}:tK(35942,{value:s});break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=iw}0>iL({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>iL({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function sn(e,t,r){let n=ig,i=!0;for(let r of st(e,t)){let e=ig,t=!0;switch(r.op){case">=":case">":var s;e="nullValue"in(s=r.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?ix(ic.empty(),rl.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?iP:"mapValue"in s?iR(s)?{mapValue:{}}:ig:tK(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=ig}iF({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];iF({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}class si{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function ss(e){return new si(e)}function sa(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function so(e){return null!==e.collectionGroup}function sl(e){if(null===e.Ie){let t;e.Ie=[];let r=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),r.add(t.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new n0(ro.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{r.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new iz(t,n))}),r.has(ro.keyField().canonicalString())||e.Ie.push(new iz(ro.keyField(),n))}return e.Ie}function su(e){return e.Ee||(e.Ee=sc(e,sl(e))),e.Ee}function sh(e){return e.de||(e.de=sc(e,e.explicitOrderBy)),e.de}function sc(e,t){if("F"===e.limitType)return i8(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new iz(e.field,t)});let r=e.endAt?new iU(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new iU(e.startAt.position,e.startAt.inclusive):null;return i8(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function sd(e,t){let r=e.filters.concat([t]);return new si(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function sf(e,t,r){return new si(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function sp(e,t){return i9(su(e),su(t))&&e.limitType===t.limitType}function sg(e){return`${i7(su(e))}|lt:${e.limitType}`}function sm(e){var t;let r;return`Query(target=${r=(t=su(e)).path.canonicalString(),null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof iG?`${t.field.canonicalString()} ${t.op} ${iS(t.value)}`:t instanceof iK?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),rJ(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(e=>iS(e)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(e=>iS(e)).join(",")),`Target(${r})`}; limitType=${e.limitType})`}function sy(e,t){var r,n,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):rl.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let r of sl(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&(r=e,n=t,(!r.startAt||(i=r.startAt,o=iq(i,sl(r),n),i.inclusive?!!(o<=0):!!(o<0)))&&(!r.endAt||(s=r.endAt,l=iq(s,sl(r),n),s.inclusive?!!(l>=0):!!(l>0))))}function sw(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function sv(e){return(t,r)=>{let n=!1;for(let i of sl(e)){let e=function(e,t,r){var n;let i,s,a=e.field.isKeyField()?rl.comparator(t.key,r.key):(n=e.field,i=t.data.field(n),s=r.data.field(n),null!==i&&null!==s?iI(i,s):tK(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return tK(19790,{direction:e.dir})}}(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}class sb{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){nH(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return nJ(this.inner)}size(){return this.innerSize}}let s_=new nX(rl.comparator),sI=new nX(rl.comparator);function sE(...e){let t=sI;for(let r of e)t=t.insert(r.key,r);return t}function sT(e){let t=sI;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function sS(){return new sb(e=>e.toString(),(e,t)=>e.isEqual(t))}let sx=new nX(rl.comparator),sC=new n0(rl.comparator);function sA(...e){let t=sC;for(let r of e)t=t.add(r);return t}let sD=new n0(t9);function sN(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:rX(t)?"-0":t}}function sk(e){return{integerValue:""+e}}function sR(e,t){return rY(t)?sk(t):sN(e,t)}class sO{constructor(){this._=void 0}}function sM(e,t){return e instanceof sU?iC(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class sP extends sO{}class sL extends sO{constructor(e){super(),this.elements=e}}function sF(e,t){let r=sj(t);for(let t of e.elements)r.some(e=>ib(e,t))||r.push(t);return{arrayValue:{values:r}}}class sV extends sO{constructor(e){super(),this.elements=e}}function sB(e,t){let r=sj(t);for(let t of e.elements)r=r.filter(e=>!ib(e,t));return{arrayValue:{values:r}}}class sU extends sO{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function sq(e){return n9(e.integerValue||e.doubleValue)}function sj(e){return iA(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class sz{constructor(e,t){this.field=e,this.transform=t}}class s${constructor(e,t){this.version=e,this.transformResults=t}}class sG{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new sG}static exists(e){return new sG(void 0,e)}static updateTime(e){return new sG(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function sK(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class sQ{}function sH(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new s2(e.key,sG.none()):new sX(e.key,e.data,sG.none());{let r=e.data,n=iV.empty(),i=new n0(ro.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new sY(e.key,n,new n6(i.toArray()),sG.none())}}function sW(e,t,r,n){return e instanceof sX?function(e,t,r,n){if(!sK(e.precondition,t))return r;let i=e.value.clone(),s=s1(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,r,n):e instanceof sY?function(e,t,r,n){if(!sK(e.precondition,t))return r;let i=s1(e.fieldTransforms,n,t),s=t.data;return(s.setAll(sZ(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):sK(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}function sJ(e,t){var r,n;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||!(!r||!n)&&rr(r,n,(e,t)=>{var r,n;return e.field.isEqual(t.field)&&(r=e.transform,n=t.transform,r instanceof sL&&n instanceof sL||r instanceof sV&&n instanceof sV?rr(r.elements,n.elements,ib):r instanceof sU&&n instanceof sU?ib(r.Ae,n.Ae):r instanceof sP&&n instanceof sP)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class sX extends sQ{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class sY extends sQ{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function sZ(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function s0(e,t,r){let n=new Map;tH(e.length===r.length,32656,{Re:r.length,Ve:e.length});for(let s=0;s<r.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);n.set(a.field,(i=r[s],o instanceof sL?sF(o,l):o instanceof sV?sB(o,l):i))}return n}function s1(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,function(e,t,r){var n;let i,s,a;return e instanceof sP?(n=t,i={fields:{[ir]:{stringValue:it},[is]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}},n&&ia(n)&&(n=io(n)),n&&(i.fields[ii]=n),{mapValue:i}):e instanceof sL?sF(e,t):e instanceof sV?sB(e,t):(a=sq(s=sM(e,t))+sq(e.Ae),iC(s)&&iC(e.Ae)?sk(a):sN(e.serializer,a))}(e,s,t))}return n}class s2 extends sQ{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class s6 extends sQ{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class s3{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&function(e,t,r){let n,i;e instanceof sX?(n=e.value.clone(),i=s0(e.fieldTransforms,t,r.transformResults),n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()):e instanceof sY?function(e,t,r){if(!sK(e.precondition,t))return t.convertToUnknownDocument(r.version);let n=s0(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(sZ(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}(e,t,r):t.convertToNoDocument(r.version).setHasCommittedMutations()}(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=sW(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=sW(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=sS();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=sH(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(rb.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),sA())}isEqual(e){return this.batchId===e.batchId&&rr(this.mutations,e.mutations,(e,t)=>sJ(e,t))&&rr(this.baseMutations,e.baseMutations,(e,t)=>sJ(e,t))}}class s5{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){tH(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let n=sx,i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new s5(e,t,r,n)}}class s4{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class s8{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class s7{constructor(e,t){this.count=e,this.unchangedNames=t}}function s9(e){switch(e){case tJ.OK:return tK(64938);case tJ.CANCELLED:case tJ.UNKNOWN:case tJ.DEADLINE_EXCEEDED:case tJ.RESOURCE_EXHAUSTED:case tJ.INTERNAL:case tJ.UNAVAILABLE:case tJ.UNAUTHENTICATED:return!1;case tJ.INVALID_ARGUMENT:case tJ.NOT_FOUND:case tJ.ALREADY_EXISTS:case tJ.PERMISSION_DENIED:case tJ.FAILED_PRECONDITION:case tJ.ABORTED:case tJ.OUT_OF_RANGE:case tJ.UNIMPLEMENTED:case tJ.DATA_LOSS:return!0;default:return tK(15467,{code:e})}}function ae(e){if(void 0===e)return tz("GRPC error has no .code"),tJ.UNKNOWN;switch(e){case m.OK:return tJ.OK;case m.CANCELLED:return tJ.CANCELLED;case m.UNKNOWN:return tJ.UNKNOWN;case m.DEADLINE_EXCEEDED:return tJ.DEADLINE_EXCEEDED;case m.RESOURCE_EXHAUSTED:return tJ.RESOURCE_EXHAUSTED;case m.INTERNAL:return tJ.INTERNAL;case m.UNAVAILABLE:return tJ.UNAVAILABLE;case m.UNAUTHENTICATED:return tJ.UNAUTHENTICATED;case m.INVALID_ARGUMENT:return tJ.INVALID_ARGUMENT;case m.NOT_FOUND:return tJ.NOT_FOUND;case m.ALREADY_EXISTS:return tJ.ALREADY_EXISTS;case m.PERMISSION_DENIED:return tJ.PERMISSION_DENIED;case m.FAILED_PRECONDITION:return tJ.FAILED_PRECONDITION;case m.ABORTED:return tJ.ABORTED;case m.OUT_OF_RANGE:return tJ.OUT_OF_RANGE;case m.UNIMPLEMENTED:return tJ.UNIMPLEMENTED;case m.DATA_LOSS:return tJ.DATA_LOSS;default:return tK(39323,{code:e})}}(y=m||(m={}))[y.OK=0]="OK",y[y.CANCELLED=1]="CANCELLED",y[y.UNKNOWN=2]="UNKNOWN",y[y.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",y[y.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",y[y.NOT_FOUND=5]="NOT_FOUND",y[y.ALREADY_EXISTS=6]="ALREADY_EXISTS",y[y.PERMISSION_DENIED=7]="PERMISSION_DENIED",y[y.UNAUTHENTICATED=16]="UNAUTHENTICATED",y[y.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",y[y.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",y[y.ABORTED=10]="ABORTED",y[y.OUT_OF_RANGE=11]="OUT_OF_RANGE",y[y.UNIMPLEMENTED=12]="UNIMPLEMENTED",y[y.INTERNAL=13]="INTERNAL",y[y.UNAVAILABLE=14]="UNAVAILABLE",y[y.DATA_LOSS=15]="DATA_LOSS";let at=null;function ar(){return new TextEncoder}let an=new a([0xffffffff,0xffffffff],0);function ai(e){let t=ar().encode(e),r=new o;return r.update(t),new Uint8Array(r.digest())}function as(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new a([r,n],0),new a([i,s],0)]}class aa{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ao(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new ao(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new ao(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=a.fromNumber(this.ge)}ye(e,t,r){let n=e.add(t.multiply(a.fromNumber(r)));return 1===n.compare(an)&&(n=new a([n.getBits(0),n.getBits(1)],0)),n.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,r]=as(ai(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);if(!this.we(n))return!1}return!0}static create(e,t,r){let n=new aa(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return r.forEach(e=>n.insert(e)),n}insert(e){if(0===this.ge)return;let[t,r]=as(ai(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);this.Se(n)}}Se(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class ao extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class al{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,au.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new al(rb.min(),n,new nX(t9),s_,sA())}}class au{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new au(r,t,sA(),sA(),sA())}}class ah{constructor(e,t,r,n){this.be=e,this.removedTargetIds=t,this.key=r,this.De=n}}class ac{constructor(e,t){this.targetId=e,this.Ce=t}}class ad{constructor(e,t,r=n4.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class af{constructor(){this.ve=0,this.Fe=am(),this.Me=n4.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=sA(),t=sA(),r=sA();return this.Fe.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:tK(38017,{changeType:i})}}),new au(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=am()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,tH(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class ap{constructor(e){this.Ge=e,this.ze=new Map,this.je=s_,this.Je=ag(),this.He=ag(),this.Ye=new nX(t9)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:tK(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,r)=>{this.rt(r)&&t(r)})}st(e){let t=e.targetId,r=e.Ce.count,n=this.ot(t);if(n){let a=n.target;if(se(a))if(0===r){let e=new rl(a.path);this.et(t,e,iB.newNoDocument(e,rb.min()))}else tH(1===r,20013,{expectedCount:r});else{let n=this._t(t);if(n!==r){var i,s;let r,a,o=this.ut(e),l=o?this.ct(o,e,n):1;0!==l&&(this.it(t),this.Ye=this.Ye.insert(t,2===l?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),at?.lt((i=e.Ce,s=this.Ge.ht(),r={localCacheCount:n,existenceFilterCount:i.count,databaseId:s.database,projectId:s.projectId},(a=i.unchangedNames)&&(r.bloomFilter={applied:0===l,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>o?.mightContain(e)??!1}),r))}}}}ut(e){let t,r,n=e.Ce.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=ie(i).toUint8Array()}catch(e){if(e instanceof n3)return t$("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new aa(t,s,a)}catch(e){return t$(e instanceof ao?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.ge?null:r}ct(e,t,r){return 2*(t.Ce.count!==r-this.Pt(e,t.targetId))}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;e.mightContain(s)||(this.et(t,r,null),n++)}),n}Tt(e){let t=new Map;this.ze.forEach((r,n)=>{let i=this.ot(n);if(i){if(r.current&&se(i.target)){let t=new rl(i.target.path);this.It(t).has(n)||this.Et(n,t)||this.et(n,t,iB.newNoDocument(t,e))}r.Be&&(t.set(n,r.ke()),r.qe())}});let r=sA();this.He.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.je.forEach((t,r)=>r.setReadTime(e));let n=new al(e,t,this.Ye,this.je,r);return this.je=s_,this.Je=ag(),this.He=ag(),this.Ye=new nX(t9),n}Xe(e,t){if(!this.rt(e))return;let r=2*!!this.Et(e,t.key);this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let n=this.nt(e);this.Et(e,t)?n.Qe(t,1):n.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new af,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new n0(t9),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new n0(t9),this.Je=this.Je.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||tj("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new af),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ag(){return new nX(rl.comparator)}function am(){return new nX(rl.comparator)}let ay={asc:"ASCENDING",desc:"DESCENDING"},aw={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},av={and:"AND",or:"OR"};class ab{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function a_(e,t){return e.useProto3Json||rJ(t)?t:{value:t}}function aI(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function aE(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function aT(e){let t;return tH(!!e,49232),rb.fromTimestamp(new rv((t=n7(e)).seconds,t.nanos))}function aS(e,t){return ax(e,t).canonicalString()}function ax(e,t){let r=new rs(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function aC(e){let t=rs.fromString(e);return tH(a$(t),10190,{key:t.toString()}),t}function aA(e,t){return aS(e.databaseId,t.path)}function aD(e,t){let r=aC(t);if(r.get(1)!==e.databaseId.projectId)throw new tX(tJ.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new tX(tJ.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new rl(aO(r))}function aN(e,t){return aS(e.databaseId,t)}function ak(e){let t=aC(e);return 4===t.length?rs.emptyPath():aO(t)}function aR(e){return new rs(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function aO(e){return tH(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function aM(e,t,r){return{name:aA(e,t),fields:r.value.mapValue.fields}}function aP(e,t,r){let n=aD(e,t.name),i=aT(t.updateTime),s=t.createTime?aT(t.createTime):rb.min(),a=new iV({mapValue:{fields:t.fields}}),o=iB.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function aL(e,t){var r,n;let i;if(t instanceof sX)i={update:aM(e,t.key,t.value)};else if(t instanceof s2)i={delete:aA(e,t.key)};else if(t instanceof sY){let r;i={update:aM(e,t.key,t.data),updateMask:(n=t.fieldMask,r=[],n.fields.forEach(e=>r.push(e.canonicalString())),{fieldPaths:r})}}else{if(!(t instanceof s6))return tK(16599,{Vt:t.type});i={verify:aA(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let r=t.transform;if(r instanceof sP)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof sL)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof sV)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof sU)return{fieldPath:t.field.canonicalString(),increment:r.Ae};throw tK(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:aI(e,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:tK(27497)),i}function aF(e,t){var r;let n=t.currentDocument?void 0!==(r=t.currentDocument).updateTime?sG.updateTime(aT(r.updateTime)):void 0!==r.exists?sG.exists(r.exists):sG.none():sG.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let r;return r=null,"setToServerValue"in t?(tH("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new sP):"appendMissingElements"in t?r=new sL(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new sV(t.removeAllFromArray.values||[]):"increment"in t?r=new sU(e,t.increment):tK(16584,{proto:t}),new sz(ro.fromServerFormat(t.fieldPath),r)}):[];if(t.update){t.update.name;let r=aD(e,t.update.name),s=new iV({mapValue:{fields:t.update.fields}});return t.updateMask?new sY(r,s,new n6((t.updateMask.fieldPaths||[]).map(e=>ro.fromServerFormat(e))),n,i):new sX(r,s,n,i)}return t.delete?new s2(aD(e,t.delete),n):t.verify?new s6(aD(e,t.verify),n):tK(1463,{proto:t})}function aV(e,t){return{documents:[aN(e,t.path)]}}function aB(e,t){var r,n;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=aN(e,i);let o=function(e){if(0!==e.length)return function e(t){var r;let n;return t instanceof iG?function(e){if("=="===e.op){if(iN(e.value))return{unaryFilter:{field:aj(e.field),op:"IS_NAN"}};if(iD(e.value))return{unaryFilter:{field:aj(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(iN(e.value))return{unaryFilter:{field:aj(e.field),op:"IS_NOT_NAN"}};if(iD(e.value))return{unaryFilter:{field:aj(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:aj(e.field),op:aw[e.op],value:e.value}}}(t):t instanceof iK?1===(n=(r=t).getFilters().map(t=>e(t))).length?n[0]:{compositeFilter:{op:av[r.op],filters:n}}:tK(54877,{filter:t})}(iK.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:aj(e.field),direction:ay[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=a_(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(r=t.startAt).inclusive,values:r.position}),t.endAt&&(s.structuredQuery.endAt={before:!(n=t.endAt).inclusive,values:n.position}),{ft:s,parent:i}}function aU(e,t,r,n){let{ft:i,parent:s}=aB(e,t),a={},o=[],l=0;return r.forEach(e=>{let t=n?e.alias:"aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:aj(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:aj(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},gt:a,parent:s}}function aq(e){var t,r,n;let i,s,a,o,l=ak(e.parent),u=e.structuredQuery,h=u.from?u.from.length:0,c=null;if(h>0){tH(1===h,65062);let e=u.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];u.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=az(e.unaryFilter.field);return iG.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=az(e.unaryFilter.field);return iG.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=az(e.unaryFilter.field);return iG.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=az(e.unaryFilter.field);return iG.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return tK(61313);default:return tK(60726)}}(t):void 0!==t.fieldFilter?iG.create(az(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return tK(58110);default:return tK(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?iK.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return tK(1026)}}(t.compositeFilter.op)):tK(30097,{filter:t})}(u.where))instanceof iK&&iW(i)?i.getFilters():[i]);let f=[];u.orderBy&&(f=u.orderBy.map(e=>new iz(az(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let p=null;u.limit&&(p=rJ(s="object"==typeof(t=u.limit)?t.value:t)?null:s);let g=null;u.startAt&&(a=!!(r=u.startAt).before,g=new iU(r.values||[],a));let m=null;return u.endAt&&(o=!(n=u.endAt).before,m=new iU(n.values||[],o)),new si(l,c,f,d,p,"F",g,m)}function aj(e){return{fieldPath:e.canonicalString()}}function az(e){return ro.fromServerFormat(e.fieldPath)}function a$(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class aG{constructor(e,t,r,n,i=rb.min(),s=rb.min(),a=n4.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new aG(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new aG(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new aG(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new aG(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class aK{constructor(e){this.yt=e}}function aQ(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:aH(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;n.document={name:aA(i=e.yt,t.key),fields:t.data.value.mapValue.fields,updateTime:aI(i,t.version.toTimestamp()),createTime:aI(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:aW(t.version)};else{if(!t.isUnknownDocument())return tK(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:aW(t.version)}}return n}function aH(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function aW(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function aJ(e){let t=new rv(e.seconds,e.nanoseconds);return rb.fromTimestamp(t)}function aX(e,t){let r=(t.baseMutations||[]).map(t=>aF(e.yt,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>aF(e.yt,t)),i=rv.fromMillis(t.localWriteTimeMs);return new s3(t.batchId,i,r,n)}function aY(e){var t;let r,n=aJ(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?aJ(e.lastLimboFreeSnapshotVersion):rb.min();return new aG(void 0!==e.query.documents?(tH(1===(r=(t=e.query).documents.length),1966,{count:r}),su(ss(ak(t.documents[0])))):su(aq(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,i,n4.fromBase64String(e.resumeToken))}function aZ(e,t){let r,n=aW(t.snapshotVersion),i=aW(t.lastLimboFreeSnapshotVersion);r=se(t.target)?aV(e.yt,t.target):aB(e.yt,t.target).ft;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:i7(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function a0(e){let t=aq({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?sf(t,t.limit,"L"):t}function a1(e,t){return new s4(t.largestBatchId,aF(e.yt,t.overlayMutation))}function a2(e,t){let r=t.path.lastSegment();return[e,rZ(t.path.popLast()),r]}function a6(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:aW(n.readTime),documentKey:rZ(n.documentKey.path),largestBatchId:n.largestBatchId}}class a3{getBundleMetadata(e,t){return nK(e,n_).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:aJ(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return nK(e,n_).put({bundleId:t.id,createTime:aW(aT(t.createTime)),version:t.version})}getNamedQuery(e,t){return nK(e,nI).get(t).next(e=>{if(e)return{name:e.name,query:a0(e.bundledQuery),readTime:aJ(e.readTime)}})}saveNamedQuery(e,t){return nK(e,nI).put({name:t.name,readTime:aW(aT(t.readTime)),bundledQuery:t.bundledQuery})}}class a5{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){return new a5(e,t.uid||"")}getOverlay(e,t){return nK(e,nO).get(a2(this.userId,t)).next(e=>e?a1(this.serializer,e):null)}getOverlays(e,t){let r=sS();return rM.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new s4(t,i);n.push(this.St(e,s))}),rM.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(rZ(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(nK(e,nO).Z(nP,n))}),rM.waitFor(i)}getOverlaysForCollection(e,t,r){let n=sS(),i=rZ(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,1/0],!0);return nK(e,nO).J(nP,s).next(e=>{for(let t of e){let e=a1(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,s=sS(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,1/0],!0);return nK(e,nO).ee({index:nF,range:a},(e,t,r)=>{let a=a1(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}St(e,t){return nK(e,nO).put(function(e,t,r){let[n,i,s]=a2(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:aL(e.yt,r.mutation)}}(this.serializer,this.userId,t))}}class a4{bt(e){return nK(e,nB)}getSessionToken(e){return this.bt(e).get("sessionToken").next(e=>{let t=e?.value;return t?n4.fromUint8Array(t):n4.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class a8{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(n9(e.integerValue));else if("doubleValue"in e){let r=n9(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),rX(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),"string"==typeof r&&(r=n7(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(ie(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?iM(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):iR(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):tK(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let r=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(r)))this.Ot(e,t),this.Ct(r[e],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let n=r[iy].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(n9(n)),this.Ot(iy,t),this.Ct(r[iy],t)}Qt(e,t){let r=e.values||[];for(let e of(this.Ft(t,50),r))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),rl.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}function a7(e){return Math.ceil((64-function(e){let t=0;for(let r=0;r<8;++r){let n=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e))/8)}a8.Kt=new a8;class a9{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{let e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Jt(e);else if(e<2048)this.Jt(960|e>>>6),this.Jt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e);else{let e=t.codePointAt(0);this.Jt(240|e>>>18),this.Jt(128|63&e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e)}}this.Ht()}Xt(e){let t=this.en(e),r=a7(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}nn(e){let t=this.en(e),r=a7(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}rn(){this.sn(255),this.sn(255)}_n(){this.an(255),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t,r=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),n=!!(128&r[0]);r[0]^=n?255:128;for(let e=1;e<r.length;++e)r[e]^=255*!!n;return r}Gt(e){let t=255&e;0===t?(this.sn(0),this.sn(255)):255===t?(this.sn(255),this.sn(0)):this.sn(t)}Jt(e){let t=255&e;0===t?(this.an(0),this.an(255)):255===t?(this.an(255),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class oe{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class ot{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class or{constructor(){this.cn=new a9,this.ln=new oe(this.cn),this.hn=new ot(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return 0===e?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}class on{constructor(e,t,r,n){this.Tn=e,this.In=t,this.En=r,this.dn=n}An(){let e=this.dn.length,t=0===e||255===this.dn[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new on(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:oa(this.En),directionalValue:oa(this.dn),orderedDocumentKey:oa(t),documentKey:r.path.toArray()}}Vn(e,t,r){let n=this.Rn(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function oi(e,t){let r=e.Tn-t.Tn;return 0!==r||0!==(r=os(e.En,t.En))||0!==(r=os(e.dn,t.dn))?r:rl.comparator(e.In,t.In)}function os(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function oa(e){return er()?function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(e):e}function oo(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e)}class ol{constructor(e){for(const t of(this.mn=new n0((e,t)=>ro.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[],e.filters))t.isInequality()?this.mn=this.mn.add(t):this.gn.push(t)}get pn(){return this.mn.size>1}yn(e){if(tH(e.collectionGroup===this.collectionId,49279),this.pn)return!1;let t=rI(e);if(void 0!==t&&!this.wn(t))return!1;let r=rE(e),n=new Set,i=0,s=0;for(;i<r.length&&this.wn(r[i]);++i)n=n.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){let e=this.mn.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.Sn(e,t)||!this.bn(this.fn[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.fn.length||!this.bn(this.fn[s++],e))return!1}return!0}Dn(){if(this.pn)return null;let e=new n0(ro.comparator),t=[];for(let r of this.gn)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new rS(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new rS(r.field,0))}for(let r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new rS(r.field,+("asc"!==r.dir))));return new r_(r_.UNKNOWN_ID,this.collectionId,t,rx.empty())}wn(e){for(let t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function ou(e){return e instanceof iG}function oh(e){return e instanceof iK&&iW(e)}function oc(e){return ou(e)||oh(e)||function(e){if(e instanceof iK&&iH(e)){for(let t of e.getFilters())if(!ou(t)&&!oh(t))return!1;return!0}return!1}(e)}function od(e,t){return tH(e instanceof iG||e instanceof iK,38388),tH(t instanceof iG||t instanceof iK,25473),op(e instanceof iG?t instanceof iG?iK.create([e,t],"and"):of(e,t):t instanceof iG?of(t,e):function(e,t){if(tH(e.filters.length>0&&t.filters.length>0,48005),iQ(e)&&iQ(t))return iX(e,t.getFilters());let r=iH(e)?e:t,n=iH(e)?t:e,i=r.filters.map(e=>od(e,n));return iK.create(i,"or")}(e,t))}function of(e,t){if(iQ(t))return iX(t,e.getFilters());{let r=t.filters.map(t=>od(e,t));return iK.create(r,"or")}}function op(e){if(tH(e instanceof iG||e instanceof iK,11850),e instanceof iG)return e;let t=e.getFilters();if(1===t.length)return op(t[0]);if(iJ(e))return e;let r=t.map(e=>op(e)),n=[];return r.forEach(t=>{t instanceof iG?n.push(t):t instanceof iK&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length?n[0]:iK.create(n,e.op)}class og{constructor(){this.Cn=new om}addToCollectionParentIndex(e,t){return this.Cn.add(t),rM.resolve()}getCollectionParents(e,t){return rM.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return rM.resolve()}deleteFieldIndex(e,t){return rM.resolve()}deleteAllFieldIndexes(e){return rM.resolve()}createTargetIndexes(e,t){return rM.resolve()}getDocumentsMatchingTarget(e,t){return rM.resolve(null)}getIndexType(e,t){return rM.resolve(0)}getFieldIndexes(e,t){return rM.resolve([])}getNextCollectionGroupToUpdate(e){return rM.resolve(null)}getMinOffset(e,t){return rM.resolve(rD.min())}getMinOffsetFromCollectionGroup(e,t){return rM.resolve(rD.min())}updateCollectionGroup(e,t,r){return rM.resolve()}updateIndexEntries(e,t){return rM.resolve()}}class om{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new n0(rs.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new n0(rs.comparator)).toArray()}}let oy="IndexedDbIndexManager",ow=new Uint8Array(0);class ov{constructor(e,t){this.databaseId=t,this.vn=new om,this.Fn=new sb(e=>i7(e),(e,t)=>i9(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});let i={collectionId:r,parent:rZ(n)};return nK(e,nw).put(i)}return rM.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return nK(e,nw).J(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(r0(n.parent))}return r})}addFieldIndex(e,t){let r=nK(e,nE),n={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete n.indexId;let i=r.add(n);if(t.indexState){let r=nK(e,nS);return i.next(e=>{r.put(a6(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let r=nK(e,nE),n=nK(e,nS),i=nK(e,nD);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=nK(e,nE),r=nK(e,nD),n=nK(e,nS);return t.Z().next(()=>r.Z()).next(()=>n.Z())}createTargetIndexes(e,t){return rM.forEach(this.Mn(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new ol(t).Dn();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=nK(e,nD),n=!0,i=new Map;return rM.forEach(this.Mn(t),t=>this.xn(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(n){let e=sA(),n=[];return rM.forEach(i,(i,s)=>{tj(oy,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${i7(t)}`);let a=function(e,t){let r=rI(t);if(void 0===r)return null;for(let t of st(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let r=new Map;for(let n of rE(t))for(let t of st(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}(s,i),l=function(e,t){let r=[],n=!0;for(let i of rE(t)){let t=0===i.kind?sr(e,i.fieldPath,e.startAt):sn(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new iU(r,n)}(s,i),u=function(e,t){let r=[],n=!0;for(let i of rE(t)){let t=0===i.kind?sn(e,i.fieldPath,e.endAt):sr(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new iU(r,n)}(s,i),h=this.On(i,s,l),c=this.On(i,s,u),d=this.Nn(i,s,o),f=this.Bn(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return rM.forEach(f,i=>r.Y(i,t.limit).next(t=>{t.forEach(t=>{let r=rl.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}return rM.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(tH(t instanceof iG||t instanceof iK,34018),t instanceof iG)return t;if(1===t.filters.length)return e(t.filters[0]);let r=t.filters.map(t=>e(t)),n=iK.create(r,t.op);return oc(n=op(n))?n:(tH(n instanceof iK,64498),tH(iQ(n),40251),tH(n.filters.length>1,57927),n.filters.reduce((e,t)=>od(e,t)))}(function e(t){if(tH(t instanceof iG||t instanceof iK,20012),t instanceof iG){if(t instanceof i6){let e=t.value.arrayValue?.values?.map(e=>iG.create(t.field,"==",e))||[];return iK.create(e,"or")}return t}let r=t.filters.map(t=>e(t));return iK.create(r,t.op)}(e));return tH(oc(t),7391),ou(t)||oh(t)?[t]:t.getFilters()})(iK.create(e.filters,"and")).map(t=>i8(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t)),t}Bn(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.Ln(t[h/l]):ow,c=this.kn(e,o,r[h%l],n),d=this.qn(e,o,i[h%l],s),f=a.map(t=>this.kn(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}kn(e,t,r,n){let i=new on(e,rl.empty(),t,r);return n?i:i.An()}qn(e,t,r,n){let i=new on(e,rl.empty(),t,r);return n?i.An():i}xn(e,t){let r=new ol(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.yn(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.Mn(t);return rM.forEach(n,t=>this.xn(e,t).next(e=>{e?0!==r&&e.fields.length<function(e){let t=new n0(ro.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}(t)&&(r=1):r=0})).next(()=>null!==t.limit&&n.length>1&&2===r?1:r)}Qn(e,t){let r=new or;for(let n of rE(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.Pn(n.kind);a8.Kt.Dt(e,i)}return r.un()}Ln(e){let t=new or;return a8.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){let r,n=new or;return a8.Kt.Dt(ix(this.databaseId,t),n.Pn(0===(r=rE(e)).length?0:r[r.length-1].kind)),n.un()}Nn(e,t,r){if(null===r)return[];let n=[];n.push(new or);let i=0;for(let s of rE(e)){let e=r[i++];for(let r of n)if(this.Un(t,s.fieldPath)&&iA(e))n=this.Kn(n,s,e);else{let t=r.Pn(s.kind);a8.Kt.Dt(e,t)}}return this.Wn(n)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Kn(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new or;n.seed(r.un()),a8.Kt.Dt(e,n.Pn(t.kind)),i.push(n)}return i}Un(e,t){return!!e.filters.find(e=>e instanceof iG&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=nK(e,nE),n=nK(e,nS);return(t?r.J(nT,IDBKeyRange.bound(t,t)):r.J()).next(e=>{let t=[];return rM.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{let n,i;t.push((n=r?new rx(r.sequenceNumber,new rD(aJ(r.readTime),new rl(r0(r.documentKey)),r.largestBatchId)):rx.empty(),i=e.fields.map(([e,t])=>new rS(ro.fromServerFormat(e),t)),new r_(e.indexId,e.collectionGroup,i,n)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:t9(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=nK(e,nE),i=nK(e,nS);return this.Gn(e).next(e=>n.J(nT,IDBKeyRange.bound(t,t)).next(t=>rM.forEach(t,t=>i.put(a6(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return rM.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?rM.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),rM.forEach(i,r=>this.zn(e,t,r).next(t=>{let i=this.jn(n,r);return t.isEqual(i)?rM.resolve():this.Jn(e,n,r,t,i)}))))})}Hn(e,t,r,n){return nK(e,nD).put(n.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,n){return nK(e,nD).delete(n.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,t,r){let n=nK(e,nD),i=new n0(oi);return n.ee({index:nk,range:IDBKeyRange.only([r.indexId,this.uid,oa(this.$n(r,t))])},(e,n)=>{i=i.add(new on(r.indexId,t,oo(n.arrayValue),oo(n.directionalValue)))}).next(()=>i)}jn(e,t){let r=new n0(oi),n=this.Qn(t,e);if(null==n)return r;let i=rI(t);if(null!=i){let s=e.data.field(i.fieldPath);if(iA(s))for(let i of s.arrayValue.values||[])r=r.add(new on(t.indexId,e.key,this.Ln(i),n))}else r=r.add(new on(t.indexId,e.key,ow,n));return r}Jn(e,t,r,n,i){tj(oy,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=n2(s),l=n2(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=n2(a)):t?(i(o),o=n2(s)):(o=n2(s),l=n2(a))}}(n,i,oi,n=>{s.push(this.Hn(e,t,r,n))},n=>{s.push(this.Yn(e,t,r,n))}),rM.waitFor(s)}Gn(e){let t=1;return nK(e,nS).ee({index:nC,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>oi(e,t)).filter((e,t,r)=>!t||0!==oi(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=oi(i,e),s=oi(i,t);if(0===r)n[0]=e.An();else if(r>0&&s<0)n.push(i),n.push(i.An());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.Zn(n[e],n[e+1]))return[];let t=n[e].Vn(this.uid,ow,rl.empty()),r=n[e+1].Vn(this.uid,ow,rl.empty());i.push(IDBKeyRange.bound(t,r))}return i}Zn(e,t){return oi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(ob)}getMinOffset(e,t){return rM.mapArray(this.Mn(t),t=>this.xn(e,t).next(e=>e||tK(44426))).next(ob)}}function ob(e){tH(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>rN(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new rD(t.readTime,t.documentKey,r)}let o_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class oI{static withCacheSize(e){return new oI(e,oI.DEFAULT_COLLECTION_PERCENTILE,oI.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function oE(e,t,r){let n=e.store(r5),i=e.store(ne),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.ee({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{tH(1===o,47070,{batchId:r.batchId})}));let u=[];for(let e of r.mutations){var h,c;let n=(h=e.key.path,c=r.batchId,[t,rZ(h),c]);s.push(i.delete(n)),u.push(e.key)}return rM.waitFor(s).next(()=>u)}function oT(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw tK(14731);t=e.noDocument}return JSON.stringify(t).length}oI.DEFAULT_COLLECTION_PERCENTILE=10,oI.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,oI.DEFAULT=new oI(0x2800000,oI.DEFAULT_COLLECTION_PERCENTILE,oI.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),oI.DISABLED=new oI(-1,0,0);class oS{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.Xn={}}static wt(e,t,r,n){return tH(""!==e.uid,64387),new oS(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return oC(e).ee({index:r8,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=nK(e,ne),s=oC(e);return s.add({}).next(a=>{var o,l,u,h;let c,d;tH("number"==typeof a,49019);let f=new s3(a,t,r,n),p=(o=this.serializer,l=this.userId,c=f.baseMutations.map(e=>aL(o.yt,e)),d=f.mutations.map(e=>aL(o.yt,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),g=[],m=new n0((e,t)=>t9(e.canonicalString(),t.canonicalString()));for(let e of n){let t=(u=this.userId,h=e.key.path,[u,rZ(h),a]);m=m.add(e.key.path.popLast()),g.push(s.put(p)),g.push(i.put(t,r9))}return m.forEach(t=>{g.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Xn[a]=f.keys()}),rM.waitFor(g).next(()=>f)})}lookupMutationBatch(e,t){return oC(e).get(t).next(e=>e?(tH(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),aX(this.serializer,e)):null)}er(e,t){return this.Xn[t]?rM.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let r=e.keys();return this.Xn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return oC(e).ee({index:r8,range:n},(e,t,n)=>{t.userId===this.userId&&(tH(t.batchId>=r,47524,{tr:r}),i=aX(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),r=-1;return oC(e).ee({index:r8,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return oC(e).J(r8,t).next(e=>e.map(e=>aX(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=[this.userId,rZ(t.path)],n=IDBKeyRange.lowerBound(r),i=[];return nK(e,ne).ee({range:n},(r,n,s)=>{let[a,o,l]=r,u=r0(o);if(a===this.userId&&t.path.isEqual(u))return oC(e).get(l).next(e=>{if(!e)throw tK(61480,{nr:r,batchId:l});tH(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(aX(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new n0(t9),n=[];return t.forEach(t=>{let i=[this.userId,rZ(t.path)],s=IDBKeyRange.lowerBound(i),a=nK(e,ne).ee({range:s},(e,n,i)=>{let[s,a,o]=e,l=r0(a);s===this.userId&&t.path.isEqual(l)?r=r.add(o):i.done()});n.push(a)}),rM.waitFor(n).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=[this.userId,rZ(r)],s=IDBKeyRange.lowerBound(i),a=new n0(t9);return nK(e,ne).ee({range:s},(e,t,i)=>{let[s,o,l]=e,u=r0(o);s===this.userId&&r.isPrefixOf(u)?u.length===n&&(a=a.add(l)):i.done()}).next(()=>this.rr(e,a))}rr(e,t){let r=[],n=[];return t.forEach(t=>{n.push(oC(e).get(t).next(e=>{if(null===e)throw tK(35274,{batchId:t});tH(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(aX(this.serializer,e))}))}),rM.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return oE(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),rM.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return rM.resolve();let r=IDBKeyRange.lowerBound([this.userId]),n=[];return nK(e,ne).ee({range:r},(e,t,r)=>{if(e[0]===this.userId){let t=r0(e[1]);n.push(t)}else r.done()}).next(()=>{tH(0===n.length,56720,{sr:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return ox(e,this.userId,t)}_r(e){return nK(e,r3).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function ox(e,t,r){let n=[t,rZ(r.path)],i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return nK(e,ne).ee({range:s,X:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function oC(e){return nK(e,r5)}class oA{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new oA(0)}static cr(){return new oA(-1)}}class oD{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{let r=new oA(t.highestTargetId);return t.highestTargetId=r.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(e=>rb.fromTimestamp(new rv(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.lr(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.hr(e,n)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(t,r),this.hr(e,r))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>nK(e,nu).delete(t.targetId)).next(()=>this.lr(e)).next(t=>(tH(t.targetCount>0,8065),t.targetCount-=1,this.hr(e,t)))}removeTargets(e,t,r){let n=0,i=[];return nK(e,nu).ee((s,a)=>{let o=aY(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>rM.waitFor(i)).next(()=>n)}forEachTarget(e,t){return nK(e,nu).ee((e,r)=>{t(aY(r))})}lr(e){return nK(e,ny).get(nm).next(e=>(tH(null!==e,2888),e))}hr(e,t){return nK(e,ny).put(nm,t)}Pr(e,t){return nK(e,nu).put(aZ(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(e=>e.targetCount)}getTargetData(e,t){let r=i7(t),n=IDBKeyRange.bound([r,-1/0],[r,1/0]),i=null;return nK(e,nu).ee({range:n,index:nh},(e,r,n)=>{let s=aY(r);i9(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=oN(e);return t.forEach(t=>{let s=rZ(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),rM.waitFor(n)}removeMatchingKeys(e,t,r){let n=oN(e);return rM.forEach(t,t=>{let i=rZ(t.path);return rM.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=oN(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=oN(e),i=sA();return n.ee({range:r,X:!0},(e,t,r)=>{let n=new rl(r0(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=rZ(t.path),n=IDBKeyRange.bound([r],[r+"\0"],!1,!0),i=0;return oN(e).ee({index:np,X:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}At(e,t){return nK(e,nu).get(t).next(e=>e?aY(e):null)}}function oN(e){return nK(e,nd)}let ok="LruGarbageCollector";function oR([e,t],[r,n]){let i=t9(e,r);return 0===i?t9(t,n):i}class oO{constructor(e){this.Ir=e,this.buffer=new n0(oR),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>oR(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class oM{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){tj(ok,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){rq(e)?tj(ok,"Ignoring IndexedDB error during garbage collection: ",e):await rO(e)}await this.Vr(3e5)})}}class oP{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return rM.resolve(rW.ce);let r=new oO(t);return this.mr.forEachTarget(e,e=>r.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>r.Ar(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(tj("LruGarbageCollector","Garbage collection skipped; disabled"),rM.resolve(o_)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(tj("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),o_):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,n,i,a,o,l,u,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(tj("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,a=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,o=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(u=Date.now(),tU()<=s.DEBUG&&tj("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-h}ms
	Determined least recently used ${n} in `+(o-a)+"ms\n"+`	Removed ${i} targets in `+(l-o)+"ms\n"+`	Removed ${e} documents in `+(u-l)+"ms\n"+`Total Duration: ${u-h}ms`),rM.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}class oL{constructor(e,t){this.db=e,this.garbageCollector=new oP(this,t)}gr(e){let t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(e,r)=>t(r))}addReference(e,t,r){return oF(e,r)}removeReference(e,t,r){return oF(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return oF(e,t)}br(e,t){let r;return r=!1,nK(e,r3).te(n=>ox(e,n,t).next(e=>(e&&(r=!0),rM.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.Sr(e,(s,a)=>{if(a<=t){let t=this.br(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,rb.min()),oN(e).delete([0,rZ(s.path)])))});n.push(t)}}).next(()=>rM.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return oF(e,t)}Sr(e,t){let r=oN(e),n,i=rW.ce;return r.ee({index:np},([e,r],{path:s,sequenceNumber:a})=>{0===e?(i!==rW.ce&&t(new rl(r0(n)),i),i=a,n=s):i=rW.ce}).next(()=>{i!==rW.ce&&t(new rl(r0(n)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function oF(e,t){var r;return oN(e).put((r=e.currentSequenceNumber,{targetId:0,path:rZ(t.path),sequenceNumber:r}))}class oV{constructor(){this.changes=new sb(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,iB.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?rM.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class oB{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return nK(e,nt).put(r)}removeEntry(e,t,r){let n;return nK(e,nt).delete([(n=t.path.toArray()).slice(0,n.length-2),n[n.length-2],aH(r),n[n.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Dr(e,r)))}getEntry(e,t){let r=iB.newInvalidDocument(t);return nK(e,nt).ee({index:nn,range:IDBKeyRange.only(oq(t))},(e,n)=>{r=this.Cr(t,n)}).next(()=>r)}vr(e,t){let r={size:0,document:iB.newInvalidDocument(t)};return nK(e,nt).ee({index:nn,range:IDBKeyRange.only(oq(t))},(e,n)=>{r={document:this.Cr(t,n),size:oT(n)}}).next(()=>r)}getEntries(e,t){let r=s_;return this.Fr(e,t,(e,t)=>{let n=this.Cr(e,t);r=r.insert(e,n)}).next(()=>r)}Mr(e,t){let r=s_,n=new nX(rl.comparator);return this.Fr(e,t,(e,t)=>{let i=this.Cr(e,t);r=r.insert(e,i),n=n.insert(e,oT(t))}).next(()=>({documents:r,Or:n}))}Fr(e,t,r){if(t.isEmpty())return rM.resolve();let n=new n0(oz);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(oq(n.first()),oq(n.last())),s=n.getIterator(),a=s.getNext();return nK(e,nt).ee({index:nn,range:i},(e,t,n)=>{let i=rl.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>oz(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.j(oq(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),aH(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return nK(e,nt).J(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let r=s_;for(let i of e){let e=this.Cr(rl.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(sy(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=s_,s=oj(t,r),a=oj(t,rD.max());return nK(e,nt).ee({index:ns,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.Cr(rl.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new oU(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return nK(e,no).get(nl).next(e=>(tH(!!e,20021),e))}Dr(e,t){return nK(e,no).put(nl,t)}Cr(e,t){if(t){let e=function(e,t){var r;let n,i;if(t.document)n=aP(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=rl.fromSegments(t.noDocument.path),r=aJ(t.noDocument.readTime);n=iB.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return tK(56709);{let e=rl.fromSegments(t.unknownDocument.path),r=aJ(t.unknownDocument.version);n=iB.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime((i=new rv((r=t.readTime)[0],r[1]),rb.fromTimestamp(i))),n}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(rb.min())))return e}return iB.newInvalidDocument(e)}}class oU extends oV{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new sb(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new n0((e,t)=>t9(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=aQ(this.Nr.serializer,s);n=n.add(i.path.popLast());let l=oT(o);r+=l-a.size,t.push(this.Nr.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=aQ(this.Nr.serializer,s.convertToNoDocument(rb.min()));t.push(this.Nr.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.Nr.updateMetadata(e,r)),rM.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(e=>(this.Br.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:e,Or:t})=>(t.forEach((t,r)=>{this.Br.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function oq(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function oj(e,t){let r=t.documentKey.path.toArray();return[e,aH(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function oz(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=t9(r[e],n[e]))return i;return(i=t9(r.length,n.length))||(i=t9(r[r.length-2],n[n.length-2]))||t9(r[r.length-1],n[n.length-1])}class o${constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class oG{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&sW(r.mutation,e,n6.empty(),rv.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,sA()).next(()=>t))}getLocalViewOfDocuments(e,t,r=sA()){let n=sS();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=sE();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=sS();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,sA()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=s_,s=sS(),a=sS();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof sY)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),sW(a.mutation,t,a.mutation.getFieldMask(),rv.now())):s.set(t.key,n6.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new o$(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=sS(),n=new nX((e,t)=>e-t),i=sA();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||n6.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||sA()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,u=sS();l.forEach(e=>{if(!i.has(e)){let n=sH(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return rM.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return rl.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):so(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):rM.resolve(sS()),a=-1,o=i;return s.next(t=>rM.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t)?rM.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,sA())).next(e=>({batchId:a,changes:sT(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new rl(t)).next(e=>{let t=sE();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=sE();return this.indexManager.getCollectionParents(e,i).next(a=>rM.forEach(a,a=>{let o=new si(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,iB.newInvalidDocument(n)))});let r=sE();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&sW(s.mutation,n,n6.empty(),rv.now()),sy(t,n)&&(r=r.insert(e,n))}),r})}}class oK{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return rM.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:t.id,version:t.version,createTime:aT(t.createTime)}),rM.resolve()}getNamedQuery(e,t){return rM.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,{name:t.name,query:a0(t.bundledQuery),readTime:aT(t.readTime)}),rM.resolve()}}class oQ{constructor(){this.overlays=new nX(rl.comparator),this.qr=new Map}getOverlay(e,t){return rM.resolve(this.overlays.get(t))}getOverlays(e,t){let r=sS();return rM.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.St(e,t,n)}),rM.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.qr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(r)),rM.resolve()}getOverlaysForCollection(e,t,r){let n=sS(),i=t.length+1,s=new rl(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return rM.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new nX((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=sS(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=sS(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return rM.resolve(a)}St(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.qr.get(n.largestBatchId).delete(r.key);this.qr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new s4(t,r));let i=this.qr.get(t);void 0===i&&(i=sA(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}class oH{constructor(){this.sessionToken=n4.EMPTY_BYTE_STRING}getSessionToken(e){return rM.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,rM.resolve()}}class oW{constructor(){this.Qr=new n0(oJ.$r),this.Ur=new n0(oJ.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let r=new oJ(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new oJ(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){let t=new rl(new rs([])),r=new oJ(t,e),n=new oJ(t,e+1),i=[];return this.Ur.forEachInRange([r,n],e=>{this.Gr(e),i.push(e.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new rl(new rs([])),r=new oJ(t,e),n=new oJ(t,e+1),i=sA();return this.Ur.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new oJ(e,0),r=this.Qr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class oJ{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return rl.comparator(e.key,t.key)||t9(e.Yr,t.Yr)}static Kr(e,t){return t9(e.Yr,t.Yr)||rl.comparator(e.key,t.key)}}class oX{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new n0(oJ.$r)}checkEmpty(e){return rM.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new s3(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.Zr=this.Zr.add(new oJ(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return rM.resolve(s)}lookupMutationBatch(e,t){return rM.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let r=this.ei(t+1),n=r<0?0:r;return rM.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return rM.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return rM.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new oJ(t,0),n=new oJ(t,1/0),i=[];return this.Zr.forEachInRange([r,n],e=>{let t=this.Xr(e.Yr);i.push(t)}),rM.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new n0(t9);return t.forEach(e=>{let t=new oJ(e,0),n=new oJ(e,1/0);this.Zr.forEachInRange([t,n],e=>{r=r.add(e.Yr)})}),rM.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;rl.isDocumentKey(i)||(i=i.child(""));let s=new oJ(new rl(i),0),a=new n0(t9);return this.Zr.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.Yr)),!0)},s),rM.resolve(this.ti(a))}ti(e){let t=[];return e.forEach(e=>{let r=this.Xr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){tH(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Zr;return rM.forEach(t.mutations,n=>{let i=new oJ(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){let r=new oJ(t,0),n=this.Zr.firstAfterOrEqual(r);return rM.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,rM.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class oY{constructor(e){this.ri=e,this.docs=new nX(rl.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return rM.resolve(r?r.document.mutableCopy():iB.newInvalidDocument(t))}getEntries(e,t){let r=s_;return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():iB.newInvalidDocument(e))}),rM.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=s_,s=t.path,a=new rl(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=rN(rA(a),r)||(n.has(a.key)||sy(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return rM.resolve(i)}getAllFromCollectionGroup(e,t,r,n){tK(9500)}ii(e,t){return rM.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new oZ(this)}getSize(e){return rM.resolve(this.size)}}class oZ extends oV{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Nr.addEntry(e,n)):this.Nr.removeEntry(r)}),rM.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class o0{constructor(e){this.persistence=e,this.si=new sb(e=>i7(e),i9),this.lastRemoteSnapshotVersion=rb.min(),this.highestTargetId=0,this.oi=0,this._i=new oW,this.targetCount=0,this.ai=oA.ur()}forEachTarget(e,t){return this.si.forEach((e,r)=>t(r)),rM.resolve()}getLastRemoteSnapshotVersion(e){return rM.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return rM.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),rM.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),rM.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new oA(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,rM.resolve()}updateTargetData(e,t){return this.Pr(t),rM.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,rM.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.si.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.si.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),rM.waitFor(i).next(()=>n)}getTargetCount(e){return rM.resolve(this.targetCount)}getTargetData(e,t){let r=this.si.get(t)||null;return rM.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),rM.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),rM.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),rM.resolve()}getMatchingKeysForTargetId(e,t){let r=this._i.Hr(t);return rM.resolve(r)}containsKey(e,t){return rM.resolve(this._i.containsKey(t))}}class o1{constructor(e,t){this.ui={},this.overlays={},this.ci=new rW(0),this.li=!1,this.li=!0,this.hi=new oH,this.referenceDelegate=e(this),this.Pi=new o0(this),this.indexManager=new og,this.remoteDocumentCache=new oY(e=>this.referenceDelegate.Ti(e)),this.serializer=new aK(t),this.Ii=new oK(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new oQ,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new oX(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){tj("MemoryPersistence","Starting transaction:",e);let n=new o2(this.ci.next());return this.referenceDelegate.Ei(),r(n).next(e=>this.referenceDelegate.di(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ai(e,t){return rM.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class o2 extends rR{constructor(e){super(),this.currentSequenceNumber=e}}class o6{constructor(e){this.persistence=e,this.Ri=new oW,this.Vi=null}static mi(e){return new o6(e)}get fi(){if(this.Vi)return this.Vi;throw tK(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),rM.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),rM.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),rM.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return rM.forEach(this.fi,r=>{let n=rl.fromPath(r);return this.gi(e,n).next(e=>{e||t.removeEntry(n,rb.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return rM.or([()=>rM.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class o3{constructor(e,t){this.persistence=e,this.pi=new sb(e=>rZ(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new oP(this,t)}static mi(e,t){return new o3(e,t)}Ei(){}di(e){return rM.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return rM.forEach(this.pi,(r,n)=>this.br(e,r,n).next(e=>e?rM.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.ii(e,n=>this.br(e,n,t).next(e=>{e||(r++,i.removeEntry(n,rb.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),rM.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),rM.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),rM.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),rM.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(iv(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let r=io(t);return r?16+e(r):16;case 5:return 2*t.stringValue.length;case 6:return ie(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,r)=>t+e(r),0);case 10:case 11:var n;let i;return n=t.mapValue,i=0,nH(n.fields,(t,r)=>{i+=t.length+e(r)}),i;default:throw tK(13486,{value:t})}}(e.data.value)),t}br(e,t,r){return rM.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.pi.get(t);return rM.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class o5{constructor(e){this.serializer=e}k(e,t,r,n){let i=new rL("createOrUpgrade",t);r<1&&n>=1&&(e.createObjectStore(r2),e.createObjectStore(r3,{keyPath:"userId"}),e.createObjectStore(r5,{keyPath:r4,autoIncrement:!0}).createIndex(r8,r7,{unique:!0}),e.createObjectStore(ne),o4(e),e.createObjectStore(r1));let s=rM.resolve();return r<3&&n>=3&&(0!==r&&(e.deleteObjectStore(nd),e.deleteObjectStore(nu),e.deleteObjectStore(ny),o4(e)),s=s.next(()=>{let e,t;return e=i.store(ny),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:rb.min().toTimestamp(),targetCount:0},e.put(nm,t)})),r<4&&n>=4&&(0!==r&&(s=s.next(()=>i.store(r5).J().next(t=>{e.deleteObjectStore(r5),e.createObjectStore(r5,{keyPath:r4,autoIncrement:!0}).createIndex(r8,r7,{unique:!0});let r=i.store(r5),n=t.map(e=>r.put(e));return rM.waitFor(n)}))),s=s.next(()=>{e.createObjectStore(nb,{keyPath:"clientId"})})),r<5&&n>=5&&(s=s.next(()=>this.yi(i))),r<6&&n>=6&&(s=s.next(()=>(e.createObjectStore(no),this.wi(i)))),r<7&&n>=7&&(s=s.next(()=>this.Si(i))),r<8&&n>=8&&(s=s.next(()=>this.bi(e,i))),r<9&&n>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),r<10&&n>=10&&(s=s.next(()=>this.Di(i))),r<11&&n>=11&&(s=s.next(()=>{e.createObjectStore(n_,{keyPath:"bundleId"}),e.createObjectStore(nI,{keyPath:"name"})})),r<12&&n>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore(nO,{keyPath:nM})).createIndex(nP,nL,{unique:!1}),t.createIndex(nF,nV,{unique:!1})})),r<13&&n>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore(nt,{keyPath:nr})).createIndex(nn,ni),t.createIndex(ns,na)}).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(r1))),r<14&&n>=14&&(s=s.next(()=>this.Fi(e,i))),r<15&&n>=15&&(s=s.next(()=>{e.createObjectStore(nE,{keyPath:"indexId",autoIncrement:!0}).createIndex(nT,"collectionGroup",{unique:!1}),e.createObjectStore(nS,{keyPath:nx}).createIndex(nC,nA,{unique:!1}),e.createObjectStore(nD,{keyPath:nN}).createIndex(nk,nR,{unique:!1})})),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(nS).clear()}).next(()=>{t.objectStore(nD).clear()})),r<17&&n>=17&&(s=s.next(()=>{e.createObjectStore(nB,{keyPath:"name"})})),r<18&&n>=18&&er()&&(s=s.next(()=>{t.objectStore(nS).clear()}).next(()=>{t.objectStore(nD).clear()})),s}wi(e){let t=0;return e.store(r1).ee((e,r)=>{t+=oT(r)}).next(()=>{let r={byteSize:t};return e.store(no).put(nl,r)})}yi(e){let t=e.store(r3),r=e.store(r5);return t.J().next(t=>rM.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.J(r8,n).next(r=>rM.forEach(r,r=>{tH(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=aX(this.serializer,r);return oE(e,t.userId,n).next(()=>{})}))}))}Si(e){let t=e.store(nd),r=e.store(r1);return e.store(ny).get(nm).next(e=>{let n=[];return r.ee((r,i)=>{let s=new rs(r),a=[0,rZ(s)];n.push(t.get(a).next(r=>r?rM.resolve():t.put({targetId:0,path:rZ(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>rM.waitFor(n))})}bi(e,t){e.createObjectStore(nw,{keyPath:nv});let r=t.store(nw),n=new om,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:rZ(n)})}};return t.store(r1).ee({X:!0},(e,t)=>i(new rs(e).popLast())).next(()=>t.store(ne).ee({X:!0},([e,t,r],n)=>i(r0(t).popLast())))}Di(e){let t=e.store(nu);return t.ee((e,r)=>{let n=aY(r),i=aZ(this.serializer,n);return t.put(i)})}Ci(e,t){let r=t.store(r1),n=[];return r.ee((e,r)=>{let i=t.store(nt),s=(r.document?new rl(rs.fromString(r.document.name).popFirst(5)):r.noDocument?rl.fromSegments(r.noDocument.path):r.unknownDocument?rl.fromSegments(r.unknownDocument.path):tK(36783)).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>rM.waitFor(n))}Fi(e,t){let r=t.store(r5),n=new oB(this.serializer),i=new o1(o6.mi,this.serializer.yt);return r.J().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??sA();aX(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),rM.forEach(r,(e,r)=>{let s=new tF(r),a=a5.wt(this.serializer,s),o=i.getIndexManager(s);return new oG(n,oS.wt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new nG(t,rW.ce),e).next()})})}}function o4(e){e.createObjectStore(nd,{keyPath:nf}).createIndex(np,ng,{unique:!0}),e.createObjectStore(nu,{keyPath:"targetId"}).createIndex(nh,nc,{unique:!0}),e.createObjectStore(ny)}let o8="IndexedDbPersistence",o7="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",o9="main";class le{constructor(e,t,r,n,i,s,a,o,l,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=i,this.window=s,this.document=a,this.xi=l,this.Oi=u,this.Ni=h,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=-1/0,this.Qi=e=>Promise.resolve(),!le.v())throw new tX(tJ.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new oL(this,n),this.$i=t+o9,this.serializer=new aK(o),this.Ui=new rF(this.$i,this.Ni,new o5(this.serializer)),this.hi=new a4,this.Pi=new oD(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new oB(this.serializer),this.Ii=new a3,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,!1===u&&tz(o8,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new tX(tJ.FAILED_PRECONDITION,o7);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new rW(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>nK(e,nb).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(e=>{e||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(rq(e))return tj(o8,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return tj(o8,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return nK(e,r2).get(r6).next(e=>rM.resolve(this.es(e)))}ts(e){return nK(e,nb).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,18e5)){this.qi=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=nK(e,nb);return t.J().next(e=>{let r=this.ss(e,18e5),n=e.filter(e=>-1===r.indexOf(e));return rM.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Ki)for(let t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?rM.resolve(!0):nK(e,r2).get(r6).next(t=>{if(null!==t&&this.rs(t.leaseTimestampMs,5e3)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new tX(tJ.FAILED_PRECONDITION,o7);return!1}}return!(!this.networkEnabled||!this.inForeground)||nK(e,nb).J().next(e=>void 0===this.ss(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&tj(o8,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[r2,nb],e=>{let t=new nG(e,rW.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(e=>this.rs(e.updateTimeMs,t)&&!this.us(e.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>nK(e,nb).J().next(e=>this.ss(e,18e5).map(e=>e.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return oS.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new ov(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return a5.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,r){var n;let i;tj(o8,"Starting transaction:",e);let s=18===(n=this.Ni)||17===n?n$:16===n||15===n?nz:14===n||13===n?nj:12===n?nq:11===n?nU:void tK(60245);return this.Ui.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,n=>(i=new nG(n,this.ci?this.ci.next():rW.ce),"readwrite-primary"===t?this.Hi(i).next(e=>!!e||this.Yi(i)).next(t=>{if(!t)throw tz(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new tX(tJ.FAILED_PRECONDITION,rk);return r(i)}).next(e=>this.Xi(i).next(()=>e)):this.Is(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Is(e){return nK(e,r2).get(r6).next(e=>{if(null!==e&&this.rs(e.leaseTimestampMs,5e3)&&!this.us(e.ownerId)&&!this.es(e)&&!(this.Oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new tX(tJ.FAILED_PRECONDITION,o7)})}Xi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return nK(e,r2).put(r6,t)}static v(){return rF.v()}Zi(e){let t=nK(e,r2);return t.get(r6).next(e=>this.es(e)?(tj(o8,"Releasing primary lease."),t.delete(r6)):rM.resolve())}rs(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(tz(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground="visible"===this.document.visibilityState)}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){"function"==typeof this.window?.addEventListener&&(this.Bi=()=>{this.cs();let e=/(?:Version|Mobile)\/1[456]/;et()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{let t=null!==this.Ki?.getItem(this._s(e));return tj(o8,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return tz(o8,"Failed to get zombied client id.",e),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){tz("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch(e){}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function lt(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}class lr{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=n}static As(e,t){let r=sA(),n=sA();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new lr(e,t.fromCache,r,n)}}class ln{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class li{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=et()?8:rV(G())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.ys(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ws(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new ln;return this.Ss(e,t,r).next(n=>{if(i.result=n,this.Vs)return this.bs(e,t,r,n.size)})}).next(()=>i.result)}bs(e,t,r,n){return r.documentReadCount<this.fs?(tU()<=s.DEBUG&&tj("QueryEngine","SDK will not create cache indexes for query:",sm(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),rM.resolve()):(tU()<=s.DEBUG&&tj("QueryEngine","Query:",sm(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.gs*n?(tU()<=s.DEBUG&&tj("QueryEngine","The SDK decides to create cache indexes for query:",sm(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,su(t))):rM.resolve())}ys(e,t){if(sa(t))return rM.resolve(null);let r=su(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=su(t=sf(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=sA(...n);return this.ps.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.Ds(t,n);return this.Cs(t,s,i,r.readTime)?this.ys(e,sf(t,null,"F")):this.vs(e,s,t,r)}))})))}ws(e,t,r,n){return sa(t)||n.isEqual(rb.min())?rM.resolve(null):this.ps.getDocuments(e,r).next(i=>{let a=this.Ds(t,i);return this.Cs(t,a,r,n)?rM.resolve(null):(tU()<=s.DEBUG&&tj("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),sm(t)),this.vs(e,a,t,rC(n,-1)).next(e=>e))})}Ds(e,t){let r=new n0(sv(e));return t.forEach((t,n)=>{sy(e,n)&&(r=r.add(n))}),r}Cs(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}Ss(e,t,r){return tU()<=s.DEBUG&&tj("QueryEngine","Using full collection scan to execute query:",sm(t)),this.ps.getDocumentsMatchingQuery(e,t,rD.min(),r)}vs(e,t,r,n){return this.ps.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let ls="LocalStore";class la{constructor(e,t,r,n){this.persistence=e,this.Fs=t,this.serializer=n,this.Ms=new nX(t9),this.xs=new sb(e=>i7(e),i9),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new oG(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}async function lo(e,t){return await e.persistence.runTransaction("Handle user change","readonly",r=>{let n;return e.mutationQueue.getAllMutationBatches(r).next(i=>(n=i,e.Bs(t),e.mutationQueue.getAllMutationBatches(r))).next(t=>{let i=[],s=[],a=sA();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(r,a).next(e=>({Ls:e,removedBatchIds:i,addedBatchIds:s}))})})}function ll(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function lu(e,t,r){let n=sA(),i=sA();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=s_;return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(rb.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):tj(ls,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{ks:n,qs:i}})}function lh(e,t){return e.persistence.runTransaction("Allocate target","readwrite",r=>{let n;return e.Pi.getTargetData(r,t).next(i=>i?(n=i,rM.resolve(n)):e.Pi.allocateTargetId(r).next(i=>(n=new aG(t,i,"TargetPurposeListen",r.currentSequenceNumber),e.Pi.addTargetData(r,n).next(()=>n))))}).then(r=>{let n=e.Ms.get(r.targetId);return(null===n||r.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(r.targetId,r),e.xs.set(t,r.targetId)),r})}async function lc(e,t,r){let n=e.Ms.get(t);try{r||await e.persistence.runTransaction("Release target",r?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,n))}catch(e){if(!rq(e))throw e;tj(ls,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ms=e.Ms.remove(t),e.xs.delete(n.target)}function ld(e,t,r){let n=rb.min(),i=sA();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=su(t),void 0!==(o=e.xs.get(a))?rM.resolve(e.Ms.get(o)):e.Pi.getTargetData(s,a)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,e.Pi.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Fs.getDocumentsMatchingQuery(s,t,r?n:rb.min(),r?i:sA())).next(r=>(lg(e,sw(t),r),{documents:r,Qs:i}))})}function lf(e,t){let r=e.Pi,n=e.Ms.get(t);return n?Promise.resolve(n.target):e.persistence.runTransaction("Get target data","readonly",e=>r.At(e,t).next(e=>e?e.target:null))}function lp(e,t){let r=e.Os.get(t)||rb.min();return e.persistence.runTransaction("Get new document changes","readonly",n=>e.Ns.getAllFromCollectionGroup(n,t,rC(r,-1),Number.MAX_SAFE_INTEGER)).then(r=>(lg(e,t,r),r))}function lg(e,t,r){let n=e.Os.get(t)||rb.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.Os.set(t,n)}async function lm(e,t,r,n){let i=sA(),s=s_;for(let e of r){let r=t.$s(e.metadata.name);e.document&&(i=i.add(r));let n=t.Us(e);n.setReadTime(t.Ks(e.metadata.readTime)),s=s.insert(r,n)}let a=e.Ns.newChangeBuffer({trackRemovals:!0}),o=await lh(e,su(ss(rs.fromString(`__bundle__/docs/${n}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>lu(t,a,s).next(e=>(a.apply(t),e)).next(r=>e.Pi.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.Pi.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,r.ks,r.qs)).next(()=>r.ks)))}async function ly(e,t,r=sA()){let n=await lh(e,su(a0(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=aT(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return e.Ii.saveNamedQuery(i,t);let a=n.withResumeToken(n4.EMPTY_BYTE_STRING,s);return e.Ms=e.Ms.insert(a.targetId,a),e.Pi.updateTargetData(i,a).next(()=>e.Pi.removeMatchingKeysForTargetId(i,n.targetId)).next(()=>e.Pi.addMatchingKeys(i,r,n.targetId)).next(()=>e.Ii.saveNamedQuery(i,t))})}let lw="firestore_clients";function lv(e,t){return`${lw}_${e}_${t}`}let lb="firestore_mutations";function l_(e,t,r){let n=`${lb}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let lI="firestore_targets";function lE(e,t){return`${lI}_${e}_${t}`}let lT="SharedClientState";class lS{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static Ws(e,t,r){let n=JSON.parse(r),i,s="object"==typeof n&&-1!==["pending","acknowledged","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new tX(n.error.code,n.error.message)),s?new lS(e,t,n.state,i):(tz(lT,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Gs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class lx{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ws(e,t){let r=JSON.parse(t),n,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new tX(r.error.code,r.error.message)),i?new lx(e,r.state,n):(tz(lT,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class lC{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=sD;for(let e=0;n&&e<r.activeTargetIds.length;++e)n=rY(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new lC(e,i):(tz(lT,`Failed to parse client data for instance '${e}': ${t}`),null)}}class lA{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new lA(t.clientId,t.onlineState):(tz(lT,`Failed to parse online state: ${e}`),null)}}class lD{constructor(){this.activeTargetIds=sD}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class lN{constructor(e,t,r,n,i){var s,a,o;this.window=e,this.Mi=t,this.persistenceKey=r,this.Js=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new nX(t9),this.started=!1,this.Xs=[];const l=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=lv(this.persistenceKey,this.Js),this.no=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.Zs=this.Zs.insert(this.Js,new lD),this.ro=RegExp(`^${lw}_${l}_([^_]*)$`),this.io=RegExp(`^${lb}_${l}_(\\d+)(?:_(.*))?$`),this.so=RegExp(`^${lI}_${l}_(\\d+)$`),this.oo=(a=this.persistenceKey,`firestore_online_state_${a}`),this._o=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.Ts())){if(e===this.Js)continue;let t=this.getItem(lv(this.persistenceKey,e));if(t){let r=lC.Ws(e,t);r&&(this.Zs=this.Zs.insert(r.clientId,r))}}this.ao();let e=this.storage.getItem(this.oo);if(e){let t=this.uo(e);t&&this.co(t)}for(let e of this.Xs)this.Ys(e);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,r){this.ho(e,t,r),this.Po(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(lE(this.persistenceKey,e));if(t){let n=lx.Ws(e,t);n&&(r=n.state)}}return t&&this.To.zs(e),this.ao(),r}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(lE(this.persistenceKey,e))}updateQueryState(e,t,r){this.Io(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.Po(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return tj(lT,"READ",e,t),t}setItem(e,t){tj(lT,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){tj(lT,"REMOVE",e),this.storage.removeItem(e)}Ys(e){if(e.storageArea===this.storage){if(tj(lT,"EVENT",e.key,e.newValue),e.key===this.eo)return void tz("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.ro.test(e.key)){if(null==e.newValue){let t=this.Ro(e.key);return this.Vo(t,null)}{let t=this.mo(e.key,e.newValue);if(t)return this.Vo(t.clientId,t)}}else if(this.io.test(e.key)){if(null!==e.newValue){let t=this.fo(e.key,e.newValue);if(t)return this.po(t)}}else if(this.so.test(e.key)){if(null!==e.newValue){let t=this.yo(e.key,e.newValue);if(t)return this.wo(t)}}else if(e.key===this.oo){if(null!==e.newValue){let t=this.uo(e.newValue);if(t)return this.co(t)}}else if(e.key===this.no){let t=function(e){let t=rW.ce;if(null!=e)try{let r=JSON.parse(e);tH("number"==typeof r,30636,{So:e}),t=r}catch(e){tz(lT,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==rW.ce&&this.sequenceNumberHandler(t)}else if(e.key===this._o){let t=this.bo(e.newValue);await Promise.all(t.map(e=>this.syncEngine.Do(e)))}}}else this.Xs.push(e)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,r){let n=new lS(this.currentUser,e,t,r),i=l_(this.persistenceKey,this.currentUser,e);this.setItem(i,n.Gs())}Po(e){let t=l_(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){let t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,r){let n=lE(this.persistenceKey,e),i=new lx(e,t,r);this.setItem(n,i.Gs())}Ao(e){let t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){let t=this.ro.exec(e);return t?t[1]:null}mo(e,t){let r=this.Ro(e);return lC.Ws(r,t)}fo(e,t){let r=this.io.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return lS.Ws(new tF(i),n,t)}yo(e,t){let r=Number(this.so.exec(e)[1]);return lx.Ws(r,t)}uo(e){return lA.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);tj(lT,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){let r=t?this.Zs.insert(e,t):this.Zs.remove(e),n=this.lo(this.Zs),i=this.lo(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Fo(s,a).then(()=>{this.Zs=r})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=sD;return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class lk{constructor(){this.Mo=new lD,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new lD,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class lR{Oo(e){}shutdown(){}}let lO="ConnectivityMonitor";class lM{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){for(let e of(tj(lO,"Network connectivity changed: AVAILABLE"),this.qo))e(0)}ko(){for(let e of(tj(lO,"Network connectivity changed: UNAVAILABLE"),this.qo))e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let lP=null;function lL(){return null===lP?lP=0x10000000+Math.round(0x80000000*Math.random()):lP++,"0x"+lP.toString(16)}let lF="RestConnection",lV={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class lB{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${n}`,this.Wo=this.databaseId.database===ih?`project_id=${r}`:`project_id=${r}&database_id=${n}`}Go(e,t,r,n,i){let s=lL(),a=this.zo(e,t.toUriEncodedString());tj(lF,`Sending RPC '${e}' ${s}:`,a,r);let o={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(o,n,i);let{host:l}=new URL(a),u=B(l);return this.Jo(e,a,o,r,u).then(t=>(tj(lF,`Received RPC '${e}' ${s}: `,t),t),t=>{throw t$(lF,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",r),t})}Ho(e,t,r,n,i,s){return this.Go(e,t,r,n,i)}jo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+tV,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}zo(e,t){let r=lV[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class lU{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}let lq="WebChannelConnection";class lj extends lB{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,n,i){let s=lL();return new Promise((i,a)=>{let o=new l;o.setWithCredentials(!0),o.listenOnce(h.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case c.NO_ERROR:let t=o.getResponseJson();tj(lq,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case c.TIMEOUT:tj(lq,`RPC '${e}' ${s} timed out`),a(new tX(tJ.DEADLINE_EXCEEDED,"Request time out"));break;case c.HTTP_ERROR:let r=o.getStatus();if(tj(lq,`RPC '${e}' ${s} failed with status:`,r,"response text:",o.getResponseText()),r>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,r=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(tJ).indexOf(e)>=0?e:tJ.UNKNOWN);a(new tX(r,t.message))}else a(new tX(tJ.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new tX(tJ.UNAVAILABLE,"Connection failed."));break;default:tK(9055,{l_:e,streamId:s,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{tj(lq,`RPC '${e}' ${s} completed.`)}});let u=JSON.stringify(n);tj(lq,`RPC '${e}' ${s} sending request:`,n),o.send(t,"POST",u,r,15)})}T_(e,t,r){let n=lL(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=g(),a=p(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.jo(o.initMessageHeaders,t,r),o.encodeInitMessageHeaders=!0;let h=i.join("");tj(lq,`Creating RPC '${e}' stream ${n}: ${h}`,o);let c=s.createWebChannel(h,o);this.I_(c);let y=!1,w=!1,v=new lU({Yo:t=>{w?tj(lq,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(y||(tj(lq,`Opening RPC '${e}' stream ${n} transport.`),c.open(),y=!0),tj(lq,`RPC '${e}' stream ${n} sending:`,t),c.send(t))},Zo:()=>c.close()}),b=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};return b(c,u.EventType.OPEN,()=>{w||(tj(lq,`RPC '${e}' stream ${n} transport opened.`),v.o_())}),b(c,u.EventType.CLOSE,()=>{w||(w=!0,tj(lq,`RPC '${e}' stream ${n} transport closed`),v.a_(),this.E_(c))}),b(c,u.EventType.ERROR,t=>{w||(w=!0,t$(lq,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),v.a_(new tX(tJ.UNAVAILABLE,"The operation could not be completed")))}),b(c,u.EventType.MESSAGE,t=>{if(!w){let r=t.data[0];tH(!!r,16349);let i=r?.error||r[0]?.error;if(i){tj(lq,`RPC '${e}' stream ${n} received error:`,i);let t=i.status,r=function(e){let t=m[e];if(void 0!==t)return ae(t)}(t),s=i.message;void 0===r&&(r=tJ.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),w=!0,v.a_(new tX(r,s)),c.close()}else tj(lq,`RPC '${e}' stream ${n} received:`,r),v.u_(r)}}),b(a,f.STAT_EVENT,t=>{t.stat===d.PROXY?tj(lq,`RPC '${e}' stream ${n} detected buffering proxy`):t.stat===d.NOPROXY&&tj(lq,`RPC '${e}' stream ${n} detected no buffering proxy`)}),setTimeout(()=>{v.__()},0),v}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function lz(){return"undefined"!=typeof window?window:null}function l$(){return"undefined"!=typeof document?document:null}function lG(e){return new ab(e,!0)}class lK{constructor(e,t,r=1e3,n=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=n,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),n=Math.max(0,t-r);n>0&&tj("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,n,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}let lQ="PersistentStream";class lH{constructor(e,t,r,n,i,s,a,o){this.Mi=e,this.S_=r,this.b_=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new lK(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===tJ.RESOURCE_EXHAUSTED?(tz(t.toString()),tz("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===tJ.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.D_===t&&this.G_(e,r)},t=>{e(()=>{let e=new tX(tJ.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{r(()=>this.z_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return tj(lQ,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(tj(lQ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class lW extends lH{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let r;if("targetChange"in t){var n,i;t.targetChange;let s="NO_CHANGE"===(n=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===n?1:"REMOVE"===n?2:"CURRENT"===n?3:"RESET"===n?4:tK(39313,{state:n}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(tH(void 0===i||"string"==typeof i,58123),n4.fromBase64String(i||"")):(tH(void 0===i||i instanceof _.Buffer||i instanceof Uint8Array,16193),n4.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;r=new ad(s,a,o,l&&new tX(void 0===l.code?tJ.UNKNOWN:ae(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=aD(e,n.document.name),s=aT(n.document.updateTime),a=n.document.createTime?aT(n.document.createTime):rb.min(),o=new iV({mapValue:{fields:n.document.fields}}),l=iB.newFoundDocument(i,s,a,o);r=new ah(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=aD(e,n.document),s=n.readTime?aT(n.readTime):rb.min(),a=iB.newNoDocument(i,s);r=new ah([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=aD(e,n.document);r=new ah([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return tK(11601,{Rt:t});{t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,s=new s7(n,i);r=new ac(e.targetId,s)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return rb.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?rb.min():t.readTime?aT(t.readTime):rb.min()}(e);return this.listener.H_(t,r)}Y_(e){let t,r={};r.database=aR(this.serializer),r.addTarget=function(e,t){let r,n=t.target;if((r=se(n)?{documents:aV(e,n)}:{query:aB(e,n).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=aE(e,t.resumeToken);let n=a_(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(rb.min())>0){r.readTime=aI(e,t.snapshotVersion.toTimestamp());let n=a_(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let n=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return tK(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});n&&(r.labels=n),this.q_(r)}Z_(e){let t={};t.database=aR(this.serializer),t.removeTarget=e,this.q_(t)}}class lJ extends lH{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return tH(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,tH(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,r;tH(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let n=(t=e.writeResults,r=e.commitTime,t&&t.length>0?(tH(void 0!==r,14353),t.map(e=>{let t;return(t=e.updateTime?aT(e.updateTime):aT(r)).isEqual(rb.min())&&(t=aT(r)),new s$(t,e.transformResults||[])})):[]),i=aT(e.commitTime);return this.listener.na(i,n)}ra(){let e={};e.database=aR(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>aL(this.serializer,e))};this.q_(t)}}class lX{}class lY extends lX{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ia=!1}sa(){if(this.ia)throw new tX(tJ.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Go(e,ax(t,r),n,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tJ.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tX(tJ.UNKNOWN,e.toString())})}Ho(e,t,r,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Ho(e,ax(t,r),n,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tJ.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tX(tJ.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class lZ{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(tz(t),this.aa=!1):tj("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let l0="RemoteStore";class l1{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(e=>{r.enqueueAndForget(async()=>{ue(this)&&(tj(l0,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await l6(e),e.Ra.set("Unknown"),e.Ea.delete(4),await l2(e)}(this))})}),this.Ra=new lZ(r,n)}}async function l2(e){if(ue(e))for(let t of e.da)await t(!0)}async function l6(e){for(let t of e.da)await t(!1)}function l3(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),l9(e)?l7(e):um(e).O_()&&l4(e,t))}function l5(e,t){let r=um(e);e.Ia.delete(t),r.O_()&&l8(e,t),0===e.Ia.size&&(r.O_()?r.L_():ue(e)&&e.Ra.set("Unknown"))}function l4(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(rb.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}um(e).Y_(t)}function l8(e,t){e.Va.Ue(t),um(e).Z_(t)}function l7(e){e.Va=new ap({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),um(e).start(),e.Ra.ua()}function l9(e){return ue(e)&&!um(e).x_()&&e.Ia.size>0}function ue(e){return 0===e.Ea.size}async function ut(e){e.Ra.set("Online")}async function ur(e){e.Ia.forEach((t,r)=>{l4(e,t)})}async function un(e,t){e.Va=void 0,l9(e)?(e.Ra.ha(t),l7(e)):e.Ra.set("Unknown")}async function ui(e,t,r){if(e.Ra.set("Online"),t instanceof ad&&2===t.state&&t.cause)try{await async function(e,t){let r=t.cause;for(let n of t.targetIds)e.Ia.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ia.delete(n),e.Va.removeTarget(n))}(e,t)}catch(r){tj(l0,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await us(e,r)}else if(t instanceof ah?e.Va.Ze(t):t instanceof ac?e.Va.st(t):e.Va.tt(t),!r.isEqual(rb.min()))try{let t,n=await ll(e.localStore);r.compareTo(n)>=0&&await ((t=e.Va.Tt(r)).targetChanges.forEach((t,n)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(n);i&&e.Ia.set(n,i.withResumeToken(t.resumeToken,r))}}),t.targetMismatches.forEach((t,r)=>{let n=e.Ia.get(t);if(!n)return;e.Ia.set(t,n.withResumeToken(n4.EMPTY_BYTE_STRING,n.snapshotVersion)),l8(e,t);let i=new aG(n.target,t,r,n.sequenceNumber);l4(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){tj(l0,"Failed to raise snapshot:",t),await us(e,t)}}async function us(e,t,r){if(!rq(t))throw t;e.Ea.add(1),await l6(e),e.Ra.set("Offline"),r||(r=()=>ll(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{tj(l0,"Retrying IndexedDB access"),await r(),e.Ea.delete(1),await l2(e)})}function ua(e,t){return t().catch(r=>us(e,r,t))}async function uo(e){var t;let r=uy(e),n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;ue(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}(e.localStore,n);if(null===t){0===e.Ta.length&&r.L_();break}n=t.batchId,function(e,t){e.Ta.push(t);let r=uy(e);r.O_()&&r.X_&&r.ea(t.mutations)}(e,t)}catch(t){await us(e,t)}ul(e)&&uu(e)}function ul(e){return ue(e)&&!uy(e).x_()&&e.Ta.length>0}function uu(e){uy(e).start()}async function uh(e){uy(e).ra()}async function uc(e){let t=uy(e);for(let r of e.Ta)t.ea(r.mutations)}async function ud(e,t,r){let n=e.Ta.shift(),i=s5.from(n,t,r);await ua(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await uo(e)}async function uf(e,t){t&&uy(e).X_&&await async function(e,t){var r;if(s9(r=t.code)&&r!==tJ.ABORTED){let r=e.Ta.shift();uy(e).B_(),await ua(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await uo(e)}}(e,t),ul(e)&&uu(e)}async function up(e,t){e.asyncQueue.verifyOperationInProgress(),tj(l0,"RemoteStore received new credentials");let r=ue(e);e.Ea.add(3),await l6(e),r&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await l2(e)}async function ug(e,t){t?(e.Ea.delete(2),await l2(e)):t||(e.Ea.add(2),await l6(e),e.Ra.set("Unknown"))}function um(e){var t,r,n;return e.ma||(t=e.datastore,r=e.asyncQueue,n={Xo:ut.bind(null,e),t_:ur.bind(null,e),r_:un.bind(null,e),H_:ui.bind(null,e)},t.sa(),e.ma=new lW(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.da.push(async t=>{t?(e.ma.B_(),l9(e)?l7(e):e.Ra.set("Unknown")):(await e.ma.stop(),e.Va=void 0)})),e.ma}function uy(e){var t,r,n;return e.fa||(t=e.datastore,r=e.asyncQueue,n={Xo:()=>Promise.resolve(),t_:uh.bind(null,e),r_:uf.bind(null,e),ta:uc.bind(null,e),na:ud.bind(null,e)},t.sa(),e.fa=new lJ(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.da.push(async t=>{t?(e.fa.B_(),await uo(e)):(await e.fa.stop(),e.Ta.length>0&&(tj(l0,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class uw{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new tY,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new uw(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new tX(tJ.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function uv(e,t){if(tz("AsyncQueue",`${t}: ${e}`),rq(e))return new tX(tJ.UNAVAILABLE,`${t}: ${e}`);throw e}class ub{static emptySet(e){return new ub(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||rl.comparator(t.key,r.key):(e,t)=>rl.comparator(e.key,t.key),this.keyedMap=sE(),this.sortedSet=new nX(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ub)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new ub;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class u_{constructor(){this.ga=new nX(rl.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?0!==e.type&&3===r.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==r.type?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.ga=this.ga.remove(t):1===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):tK(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class uI{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new uI(e,t,ub.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&sp(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class uE{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class uT{constructor(){this.queries=uS(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new tX(tJ.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=uS(),t.forEach((t,r)=>{for(let t of r.Sa)t.onError(e)})}}function uS(){return new sb(e=>sg(e),sp)}async function ux(e,t){let r=3,n=t.query,i=e.queries.get(n);i?!i.ba()&&t.Da()&&(r=2):(i=new uE,r=+!t.Da());try{switch(r){case 0:i.wa=await e.onListen(n,!0);break;case 1:i.wa=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(r){let e=uv(r,`Initialization of query '${sm(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.Sa.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&uN(e)}async function uC(e,t){let r=t.query,n=3,i=e.queries.get(r);if(i){let e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?n=+!t.Da():!i.ba()&&t.Da()&&(n=2))}switch(n){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function uA(e,t){let r=!1;for(let n of t){let t=n.query,i=e.queries.get(t);if(i){for(let e of i.Sa)e.Fa(n)&&(r=!0);i.wa=n}}r&&uN(e)}function uD(e,t,r){let n=e.queries.get(t);if(n)for(let e of n.Sa)e.onError(r);e.queries.delete(t)}function uN(e){e.Ca.forEach(e=>{e.next()})}(v=w||(w={})).Ma="default",v.Cache="cache";class uk{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new uI(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.qa||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=uI.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==w.Cache}}class uR{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}class uO{constructor(e){this.serializer=e}$s(e){return aD(this.serializer,e)}Us(e){return e.metadata.exists?aP(this.serializer,e.document,!1):iB.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return aT(e)}}class uM{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=uP(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;let r=rs.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){let t=new Map,r=new uO(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.$s(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||sA()).add(e);t.set(r,n)}}return t}async ja(e){let t=await lm(e,new uO(this.serializer),this.Wa,this.Ua.id),r=this.za(this.documents);for(let t of this.Ka)await ly(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function uP(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class uL{constructor(e){this.key=e}}class uF{constructor(e){this.key=e}}class uV{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=sA(),this.mutatedKeys=sA(),this.eu=sv(e),this.tu=new ub(this.eu)}get nu(){return this.Ya}ru(e,t){let r=t?t.iu:new u_,n=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),h=sy(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(r.track({type:3,doc:h}),f=!0):this.su(u,h)||(r.track({type:2,doc:h}),f=!0,(o&&this.eu(h,o)>0||l&&0>this.eu(h,l))&&(a=!0)):!u&&h?(r.track({type:0,doc:h}),f=!0):u&&!h&&(r.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{tu:s,iu:r,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var r,n;let i;return r=e.type,n=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return tK(20277,{Rt:e})}})(r)-i(n)||this.eu(e.doc,t.doc)}),this.ou(r),n=n??!1;let a=t&&!n?this._u():[],o=0===this.Xa.size&&this.current&&!n?1:0,l=o!==this.Za;return(this.Za=o,0!==s.length||l)?{snapshot:new uI(this.query,e.tu,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new u_,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=sA(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});let t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new uF(e))}),this.Xa.forEach(r=>{e.has(r)||t.push(new uL(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=sA();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return uI.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}let uB="SyncEngine";class uU{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class uq{constructor(e){this.key=e,this.hu=!1}}class uj{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new sb(e=>sg(e),sp),this.Iu=new Map,this.Eu=new Set,this.du=new nX(rl.comparator),this.Au=new Map,this.Ru=new oW,this.Vu={},this.mu=new Map,this.fu=oA.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function uz(e,t,r=!0){let n,i=hh(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.lu()):n=await uG(i,t,r,!0),n}async function u$(e,t){let r=hh(e);await uG(r,t,!0,!1)}async function uG(e,t,r,n){let i,s=await lh(e.localStore,su(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await uK(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&l3(e.remoteStore,s),i}async function uK(e,t,r,n,i){e.pu=(t,r,n)=>(async function(e,t,r,n){let i=t.view.ru(r);i.Cs&&(i=await ld(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return u4(e,t.targetId,o.au),o.snapshot})(e,t,r,n);let s=await ld(e.localStore,t,!0),a=new uV(t,s.Qs),o=a.ru(s.documents),l=au.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);u4(e,r,u.au);let h=new uU(t,r,a);return e.Tu.set(t,h),e.Iu.has(r)?e.Iu.get(r).push(t):e.Iu.set(r,[t]),u.snapshot}async function uQ(e,t,r){let n=e.Tu.get(t),i=e.Iu.get(n.targetId);i.length>1?(e.Iu.set(n.targetId,i.filter(e=>!sp(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await lc(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),r&&l5(e.remoteStore,n.targetId),u3(e,n.targetId)}).catch(rO)):(u3(e,n.targetId),await lc(e.localStore,n.targetId,!0))}async function uH(e,t){let r=e.Tu.get(t),n=e.Iu.get(r.targetId);e.isPrimaryClient&&1===n.length&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),l5(e.remoteStore,r.targetId))}async function uW(e,t,r){let n=hc(e);try{var i,s;let e,a,o,l,u,h=await (i=n.localStore,o=rv.now(),l=t.reduce((e,t)=>e.add(t.key),sA()),i.persistence.runTransaction("Locally write mutations","readwrite",r=>{let n=s_,s=sA();return i.Ns.getEntries(r,l).next(e=>{(n=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(r,n)).next(n=>{e=n;let s=[];for(let r of t){let t=function(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=sM(n.transform,e||null);null!=i&&(null===r&&(r=iV.empty()),r.set(n.field,i))}return r||null}(r,e.get(r.key).overlayedDocument);null!=t&&s.push(new sY(r.key,t,function e(t){let r=[];return nH(t.fields,(t,n)=>{let i=new ro([t]);if(ik(n)){let t=e(n.mapValue).fields;if(0===t.length)r.push(i);else for(let e of t)r.push(i.child(e))}else r.push(i)}),new n6(r)}(t.value.mapValue),sG.exists(!0)))}return i.mutationQueue.addMutationBatch(r,o,s,t)}).next(t=>{a=t;let n=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(r,t.batchId,n)})}).then(()=>({batchId:a.batchId,changes:sT(e)})));n.sharedClientState.addPendingMutation(h.batchId),s=h.batchId,(u=n.Vu[n.currentUser.toKey()])||(u=new nX(t9)),u=u.insert(s,r),n.Vu[n.currentUser.toKey()]=u,await u7(n,h.changes),await uo(n.remoteStore)}catch(t){let e=uv(t,"Failed to persist write");r.reject(e)}}async function uJ(e,t){var r;try{let n,i,s=await (r=e.localStore,n=t.snapshotVersion,i=r.Ms,r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.Ns.newChangeBuffer({trackRemovals:!0});i=r.Ms;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=i.get(o);if(!u)return;a.push(r.Pi.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.Pi.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(n4.EMPTY_BYTE_STRING,rb.min()).withLastLimboFreeSnapshotVersion(rb.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,n)),i=i.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(r.Pi.updateTargetData(e,h))});let o=s_,l=sA();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(lu(e,s,t.documentUpdates).next(e=>{o=e.ks,l=e.qs})),!n.isEqual(rb.min())){let t=r.Pi.getLastRemoteSnapshotVersion(e).next(t=>r.Pi.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return rM.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.Ms=i,e)));t.targetChanges.forEach((t,r)=>{let n=e.Au.get(r);n&&(tH(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?n.hu=!0:t.modifiedDocuments.size>0?tH(n.hu,14607):t.removedDocuments.size>0&&(tH(n.hu,42227),n.hu=!1))}),await u7(e,s,t)}catch(e){await rO(e)}}function uX(e,t,r){var n;if(e.isPrimaryClient&&0===r||!e.isPrimaryClient&&1===r){let r,i=[];e.Tu.forEach((e,r)=>{let n=r.view.va(t);n.snapshot&&i.push(n.snapshot)}),(n=e.eventManager).onlineState=t,r=!1,n.queries.forEach((e,n)=>{for(let e of n.Sa)e.va(t)&&(r=!0)}),r&&uN(n),i.length&&e.Pu.H_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function uY(e,t,r){e.sharedClientState.updateQueryState(t,"rejected",r);let n=e.Au.get(t),i=n&&n.key;if(i){let r=new nX(rl.comparator);r=r.insert(i,iB.newNoDocument(i,rb.min()));let n=sA().add(i),s=new al(rb.min(),new Map,new nX(t9),r,n);await uJ(e,s),e.du=e.du.remove(i),e.Au.delete(t),u8(e)}else await lc(e.localStore,t,!1).then(()=>u3(e,t,r)).catch(rO)}async function uZ(e,t){var r;let n=t.batch.batchId;try{let i=await (r=e.localStore,r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n,i,s,a=t.batch.keys(),o=r.Ns.newChangeBuffer({trackRemovals:!0});return(i=(n=t.batch).keys(),s=rM.resolve(),i.forEach(r=>{s=s.next(()=>o.getEntry(e,r)).next(e=>{let i=t.docVersions.get(r);tH(null!==i,48541),0>e.version.compareTo(i)&&(n.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>r.mutationQueue.removeMutationBatch(e,n))).next(()=>o.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=sA();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}(t))).next(()=>r.localDocuments.getDocuments(e,a))}));u6(e,n,null),u2(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await u7(e,i)}catch(e){await rO(e)}}async function u0(e,t,r){var n;try{let i=await (n=e.localStore,n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(tH(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))}));u6(e,t,r),u2(e,t),e.sharedClientState.updateMutationState(t,"rejected",r),await u7(e,i)}catch(e){await rO(e)}}async function u1(e,t){var r;ue(e.remoteStore)||tj(uB,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=await (r=e.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>r.mutationQueue.getHighestUnacknowledgedBatchId(e));if(-1===n)return void t.resolve();let i=e.mu.get(n)||[];i.push(t),e.mu.set(n,i)}catch(r){let e=uv(r,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}}function u2(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function u6(e,t,r){let n=e.Vu[e.currentUser.toKey()];if(n){let i=n.get(t);i&&(r?i.reject(r):i.resolve(),n=n.remove(t)),e.Vu[e.currentUser.toKey()]=n}}function u3(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(n),r&&e.Pu.yu(n,r);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||u5(e,t)})}function u5(e,t){e.Eu.delete(t.path.canonicalString());let r=e.du.get(t);null!==r&&(l5(e.remoteStore,r),e.du=e.du.remove(t),e.Au.delete(r),u8(e))}function u4(e,t,r){for(let n of r)n instanceof uL?(e.Ru.addReference(n.key,t),function(e,t){let r=t.key,n=r.path.canonicalString();e.du.get(r)||e.Eu.has(n)||(tj(uB,"New document in limbo: "+r),e.Eu.add(n),u8(e))}(e,n)):n instanceof uF?(tj(uB,"Document no longer in limbo: "+n.key),e.Ru.removeReference(n.key,t),e.Ru.containsKey(n.key)||u5(e,n.key)):tK(19791,{wu:n})}function u8(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let r=new rl(rs.fromString(t)),n=e.fu.next();e.Au.set(n,new uq(r)),e.du=e.du.insert(r,n),l3(e.remoteStore,new aG(su(ss(r.path)),n,"TargetPurposeLimboResolution",rW.ce))}}async function u7(e,t,r){let n=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{s.push(e.pu(o,t,r).then(t=>{if((t||r)&&e.isPrimaryClient){let n=t?!t.fromCache:r?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,n?"current":"not-current")}if(t){n.push(t);let e=lr.As(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.H_(n),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>rM.forEach(t,t=>rM.forEach(t.Es,n=>e.persistence.referenceDelegate.addReference(r,t.targetId,n)).next(()=>rM.forEach(t.ds,n=>e.persistence.referenceDelegate.removeReference(r,t.targetId,n)))))}catch(e){if(!rq(e))throw e;tj(ls,"Failed to update sequence numbers: "+e)}for(let r of t){let t=r.targetId;if(!r.fromCache){let r=e.Ms.get(t),n=r.snapshotVersion,i=r.withLastLimboFreeSnapshotVersion(n);e.Ms=e.Ms.insert(t,i)}}}(e.localStore,i))}async function u9(e,t){if(!e.currentUser.isEqual(t)){tj(uB,"User change. New user:",t.toKey());let r=await lo(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new tX(tJ.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await u7(e,r.Ls)}}function he(e,t){let r=e.Au.get(t);if(r&&r.hu)return sA().add(r.key);{let r=sA(),n=e.Iu.get(t);if(!n)return r;for(let t of n){let n=e.Tu.get(t);r=r.unionWith(n.view.nu)}return r}}async function ht(e,t){let r=await ld(e.localStore,t.query,!0),n=t.view.cu(r);return e.isPrimaryClient&&u4(e,t.targetId,n.au),n}async function hr(e,t){return lp(e.localStore,t).then(t=>u7(e,t))}async function hn(e,t,r,n){var i,s;let a,o=await (i=e.localStore,a=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.er(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):rM.resolve(null))));null!==o?("pending"===r?await uo(e.remoteStore):"acknowledged"===r||"rejected"===r?(u6(e,t,n||null),u2(e,t),s=e.localStore,s.mutationQueue.ir(t)):tK(6720,"Unknown batchState",{Su:r}),await u7(e,o)):tj(uB,"Cannot apply mutation batch with id: "+t)}async function hi(e,t){if(hh(e),hc(e),!0===t&&!0!==e.gu){let t=e.sharedClientState.getAllActiveQueryTargets(),r=await hs(e,t.toArray());for(let t of(e.gu=!0,await ug(e.remoteStore,!0),r))l3(e.remoteStore,t)}else if(!1===t&&!1!==e.gu){let t=[],r=Promise.resolve();e.Iu.forEach((n,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):r=r.then(()=>(u3(e,i),lc(e.localStore,i,!0))),l5(e.remoteStore,i)}),await r,await hs(e,t),e.Au.forEach((t,r)=>{l5(e.remoteStore,r)}),e.Ru.Jr(),e.Au=new Map,e.du=new nX(rl.comparator),e.gu=!1,await ug(e.remoteStore,!1)}}async function hs(e,t,r){let n=[],i=[];for(let r of t){let t,s=e.Iu.get(r);if(s&&0!==s.length)for(let r of(t=await lh(e.localStore,su(s[0])),s)){let t=e.Tu.get(r),n=await ht(e,t);n.snapshot&&i.push(n.snapshot)}else{let n=await lf(e.localStore,r);t=await lh(e.localStore,n),await uK(e,ha(n),r,!1,t.resumeToken)}n.push(t)}return e.Pu.H_(i),n}function ha(e){var t,r,n,i,s;return t=e.path,r=e.collectionGroup,n=e.orderBy,i=e.filters,s=e.limit,new si(t,r,n,i,s,"F",e.startAt,e.endAt)}function ho(e){return e.localStore.persistence.Ts()}async function hl(e,t,r,n){if(e.gu)return void tj(uB,"Ignoring unexpected query state notification.");let i=e.Iu.get(t);if(i&&i.length>0)switch(r){case"current":case"not-current":{let n=await lp(e.localStore,sw(i[0])),s=al.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,n4.EMPTY_BYTE_STRING);await u7(e,n,s);break}case"rejected":await lc(e.localStore,t,!0),u3(e,t,n);break;default:tK(64155,r)}}async function hu(e,t,r){let n=hh(e);if(n.gu){for(let e of t){if(n.Iu.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){tj(uB,"Adding an already active target "+e);continue}let t=await lf(n.localStore,e),r=await lh(n.localStore,t);await uK(n,ha(t),r.targetId,!1,r.resumeToken),l3(n.remoteStore,r)}for(let e of r)n.Iu.has(e)&&await lc(n.localStore,e,!1).then(()=>{l5(n.remoteStore,e),u3(n,e)}).catch(rO)}}function hh(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=uJ.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=he.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=uY.bind(null,e),e.Pu.H_=uA.bind(null,e.eventManager),e.Pu.yu=uD.bind(null,e.eventManager),e}function hc(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=uZ.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=u0.bind(null,e),e}class hd{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=lG(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,r;return t=this.persistence,r=new li,new la(t,r,e.initialUser,this.serializer)}Cu(e){return new o1(o6.mi,this.serializer)}Du(e){return new lk}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}hd.provider={build:()=>new hd};class hf extends hd{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return tH(this.persistence.referenceDelegate instanceof o3,46915),new oM(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?oI.withCacheSize(this.cacheSizeBytes):oI.DEFAULT;return new o1(e=>o3.mi(e,t),this.serializer)}}class hp extends hd{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await hc(this.xu.syncEngine),await uo(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,r;return t=this.persistence,r=new li,new la(t,r,e.initialUser,this.serializer)}Fu(e,t){return new oM(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Mu(e,t){let r=new rH(t,this.persistence);return new rQ(e.asyncQueue,r)}Cu(e){let t=lt(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?oI.withCacheSize(this.cacheSizeBytes):oI.DEFAULT;return new le(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,lz(),l$(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new lk}}class hg extends hp{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.xu.syncEngine;this.sharedClientState instanceof lN&&(this.sharedClientState.syncEngine={Co:hn.bind(null,t),vo:hl.bind(null,t),Fo:hu.bind(null,t),Ts:ho.bind(null,t),Do:hr.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async e=>{await hi(this.xu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Du(e){let t=lz();if(!lN.v(t))throw new tX(tJ.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=lt(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new lN(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class hm{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>uX(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=u9.bind(null,this.syncEngine),await ug(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new uT}createDatastore(e){var t;let r=lG(e.databaseInfo.databaseId),n=new lj(e.databaseInfo);return t=e.authCredentials,new lY(t,e.appCheckCredentials,n,r)}createRemoteStore(e){var t,r;return t=this.localStore,r=this.datastore,new l1(t,r,e.asyncQueue,e=>uX(this.syncEngine,e,0),lM.v()?new lM:new lR)}createSyncEngine(e,t){var r,n,i,s,a,o;let l;return r=this.localStore,n=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new uj(r,n,i,s,a,o),t&&(l.gu=!0),l}async terminate(){await async function(e){tj(l0,"RemoteStore shutting down."),e.Ea.add(5),await l6(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}function hy(e,t=10240){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}hm.provider={build:()=>new hm};class hw{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):tz("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class hv{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new tY,this.buffer=new Uint8Array,this.Lu=new TextDecoder("utf-8"),this.ku().then(e=>{e&&e.$a()?this.metadata.resolve(e.Qa.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.Qa)}`))},e=>this.metadata.reject(e))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){let e=await this.qu();if(null===e)return null;let t=this.Lu.decode(e),r=Number(t);return isNaN(r)&&this.Qu(`length string (${t}) is not valid number`),new uR(JSON.parse(await this.$u(r)),e.length+r)}Uu(){return this.buffer.findIndex(e=>123===e)}async qu(){for(;0>this.Uu()&&!await this.Ku(););if(0===this.buffer.length)return null;let e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");let t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),Error(`Invalid bundle format: ${e}`)}async Ku(){let e=await this.Bu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class hb{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.bu();if(!r||!r.$a())throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.Qa)}`);this.metadata=r;do null!==(r=this.bu())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;let e=this.qu();return new uR(JSON.parse(this.$u(e)),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new tX(tJ.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class h_{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new tX(tJ.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let r={documents:t.map(t=>aA(e.serializer,t))},n=await e.Ho("BatchGetDocuments",e.serializer.databaseId,rs.emptyPath(),r,t.length),i=new Map;n.forEach(t=>{var r;let n,s,a,o,l,u,h=(r=e.serializer,"found"in t?(tH(!!t.found,43571),t.found.name,t.found.updateTime,n=aD(r,t.found.name),s=aT(t.found.updateTime),a=t.found.createTime?aT(t.found.createTime):rb.min(),o=new iV({mapValue:{fields:t.found.fields}}),iB.newFoundDocument(n,s,a,o)):"missing"in t?(tH(!!t.missing,3894),tH(!!t.readTime,22933),l=aD(r,t.missing),u=aT(t.readTime),iB.newNoDocument(l,u)):tK(7234,{result:t}));i.set(h.key.toString(),h)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());tH(!!t,55234,{key:e}),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new s2(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=rl.fromPath(t);this.mutations.push(new s6(r,this.precondition(r)))}),await async function(e,t){let r={writes:t.map(t=>aL(e.serializer,t))};await e.Go("Commit",e.serializer.databaseId,rs.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw tK(50498,{Gu:e.constructor.name});t=rb.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new tX(tJ.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(rb.min())?sG.exists(!1):sG.updateTime(t):sG.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(rb.min()))throw new tX(tJ.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return sG.updateTime(t)}return sG.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class hI{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.zu=r.maxAttempts,this.M_=new lK(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{let e=new h_(this.datastore),t=this.Hu(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Yu(e)}))}).catch(e=>{this.Yu(e)})})}Hu(e){try{let t=this.updateFunction(e);return!rJ(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if("FirebaseError"===e?.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!s9(t)}return!1}}let hE="FirestoreClient";class hT{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=tF.UNAUTHENTICATED,this.clientId=t7.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{tj(hE,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(tj(hE,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new tY;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=uv(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function hS(e,t){e.asyncQueue.verifyOperationInProgress(),tj(hE,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await lo(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function hx(e,t){e.asyncQueue.verifyOperationInProgress();let r=await hC(e);tj(hE,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>up(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>up(t.remoteStore,r)),e._onlineComponents=t}async function hC(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){tj(hE,"Using user provided OfflineComponentProvider");try{await hS(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===tJ.FAILED_PRECONDITION||t.code===tJ.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;t$("Error using user provided cache. Falling back to memory cache: "+t),await hS(e,new hd)}}else tj(hE,"Using default OfflineComponentProvider"),await hS(e,new hf(void 0));return e._offlineComponents}async function hA(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(tj(hE,"Using user provided OnlineComponentProvider"),await hx(e,e._uninitializedComponentsProvider._online)):(tj(hE,"Using default OnlineComponentProvider"),await hx(e,new hm))),e._onlineComponents}function hD(e){return hC(e).then(e=>e.persistence)}function hN(e){return hC(e).then(e=>e.localStore)}function hk(e){return hA(e).then(e=>e.remoteStore)}function hR(e){return hA(e).then(e=>e.syncEngine)}function hO(e){return hA(e).then(e=>e.datastore)}async function hM(e){let t=await hA(e),r=t.eventManager;return r.onListen=uz.bind(null,t.syncEngine),r.onUnlisten=uQ.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=u$.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=uH.bind(null,t.syncEngine),r}function hP(e,t,r={}){let n=new tY;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await hM(e),s=e.asyncQueue,a=new hw({next:e=>{a.Nu(),s.enqueueAndForget(()=>uC(i,o));let l=e.docs.has(t);!l&&e.fromCache?n.reject(new tX(tJ.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&r&&"server"===r.source?n.reject(new tX(tJ.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):n.resolve(e)},error:e=>n.reject(e)}),ux(i,o=new uk(ss(t.path),a,{includeMetadataChanges:!0,qa:!0}))}),n.promise}function hL(e,t,r={}){let n=new tY;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await hM(e),s=e.asyncQueue,o=new uk(t,a=new hw({next:e=>{a.Nu(),s.enqueueAndForget(()=>uC(i,o)),e.fromCache&&"server"===r.source?n.reject(new tX(tJ.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):n.resolve(e)},error:e=>n.reject(e)}),{includeMetadataChanges:!0,qa:!0}),ux(i,o)}),n.promise}function hF(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let hV=new Map,hB="firestore.googleapis.com";class hU{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new tX(tJ.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=hB,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new tX(tJ.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}rh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hF(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new tX(tJ.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new tX(tJ.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new tX(tJ.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,r;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class hq{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hU({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new tX(tJ.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new tX(tJ.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hU(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new t0;switch(e.type){case"firstParty":return new t3(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new tX(tJ.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=hV.get(this))&&(tj("ComponentProvider","Removing Datastore"),hV.delete(this),e.terminate()),Promise.resolve()}}function hj(e,t,r,n={}){e=rg(e,hq);let i=B(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;i&&(U(`https://${o}`),$("Firestore",!0)),s.host!==hB&&s.host!==o&&t$("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:n};if(!ey(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=tF.MOCK_USER;else{t=q(n.mockUserToken,e._app?.options.projectId);let i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new tX(tJ.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new tF(i)}e._authCredentials=new t1(new tZ(t,r))}}class hz{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new hz(this.firestore,e,this._query)}}class h${constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hG(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new h$(this.firestore,e,this._key)}toJSON(){return{type:h$._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(rw(t,h$._jsonSchema))return new h$(e,r||null,new rl(rs.fromString(t.referencePath)))}}h$._jsonSchemaVersion="firestore/documentReference/1.0",h$._jsonSchema={type:ry("string",h$._jsonSchemaVersion),referencePath:ry("string")};class hG extends hz{constructor(e,t,r){super(e,t,ss(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new h$(this.firestore,null,new rl(e))}withConverter(e){return new hG(this.firestore,e,this._path)}}function hK(e,t,...r){if(e=eD(e),ru("collection","path",t),e instanceof hq){let n=rs.fromString(t,...r);return rd(n),new hG(e,null,n)}{if(!(e instanceof h$||e instanceof hG))throw new tX(tJ.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(rs.fromString(t,...r));return rd(n),new hG(e.firestore,null,n)}}function hQ(e,t){if(e=rg(e,hq),ru("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new tX(tJ.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new hz(e,null,new si(rs.emptyPath(),t))}function hH(e,t,...r){if(e=eD(e),1==arguments.length&&(t=t7.newId()),ru("doc","path",t),e instanceof hq){let n=rs.fromString(t,...r);return rc(n),new h$(e,null,new rl(n))}{if(!(e instanceof h$||e instanceof hG))throw new tX(tJ.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(rs.fromString(t,...r));return rc(n),new h$(e.firestore,e instanceof hG?e.converter:null,new rl(n))}}function hW(e,t){return e=eD(e),t=eD(t),(e instanceof h$||e instanceof hG)&&(t instanceof h$||t instanceof hG)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function hJ(e,t){return e=eD(e),t=eD(t),e instanceof hz&&t instanceof hz&&e.firestore===t.firestore&&sp(e._query,t._query)&&e.converter===t.converter}let hX="AsyncQueue";class hY{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new lK(this,"async_queue_retry"),this._c=()=>{let e=l$();e&&tj(hX,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=l$();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=l$();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new tY;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!rq(e))throw e;tj(hX,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,tz("INTERNAL UNHANDLED ERROR: ",hZ(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let n=uw.createAndSchedule(this,e,t,r,e=>this.hc(e));return this.tc.push(n),n}uc(){this.nc&&tK(47125,{Pc:hZ(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function hZ(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function h0(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class h1{constructor(){this._progressObserver={},this._taskCompletionResolver=new tY,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class h2 extends hq{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new hY,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new hY(e),this._firestoreClient=void 0,await e}}}function h6(e,t,r){r||(r=ih);let n=tr(e,"firestore");if(n.isInitialized(r)){let e=n.getImmediate({identifier:r});if(ey(n.getOptions(r),t))return e;throw new tX(tJ.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new tX(tJ.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new tX(tJ.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&B(t.host)&&U(t.host),n.initialize({options:t,instanceIdentifier:r})}function h3(e,t){let r="object"==typeof e?e:tg(),n="string"==typeof e?e:t||ih,i=tr(r,"firestore").getImmediate({identifier:n});if(!i._initialized){let e=P("firestore");e&&hj(i,...e)}return i}function h5(e){if(e._terminated)throw new tX(tJ.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||h4(e),e._firestoreClient}function h4(e){var t,r,n;let i,s=e._freezeSettings(),a=(t=e._databaseId,r=e._app?.options.appId||"",new iu(t,r,e._persistenceKey,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,hF(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator));e._componentsProvider||s.localCache?._offlineComponentProvider&&s.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new hT(e._authCredentials,e._appCheckCredentials,e._queue,a,e._componentsProvider&&(n=e._componentsProvider,i=n?._online.build(),{_offline:n?._offline.build(i),_online:i}))}function h8(e,t){t$("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=e._freezeSettings();return h9(e,hm.provider,{build:e=>new hp(e,r.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}async function h7(e){t$("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();h9(e,hm.provider,{build:e=>new hg(e,t.cacheSizeBytes)})}function h9(e,t,r){if((e=rg(e,h2))._firestoreClient||e._terminated)throw new tX(tJ.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new tX(tJ.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:r},h4(e)}function ce(e){if(e._initialized&&!e._terminated)throw new tX(tJ.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new tY;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!rF.v())return Promise.resolve();await rF.delete(e+o9)}(lt(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}function ct(e){var t;let r;return t=h5(e=rg(e,h2)),r=new tY,t.asyncQueue.enqueueAndForget(async()=>u1(await hR(t),r)),r.promise}function cr(e){var t;return(t=h5(e=rg(e,h2))).asyncQueue.enqueue(async()=>{let e=await hD(t),r=await hk(t);return e.setNetworkEnabled(!0),r.Ea.delete(0),l2(r)})}function cn(e){var t;return(t=h5(e=rg(e,h2))).asyncQueue.enqueue(async()=>{let e=await hD(t),r=await hk(t);return e.setNetworkEnabled(!1),async function(e){e.Ea.add(0),await l6(e),e.Ra.set("Offline")}(r)})}function ci(e){return tn(e.app,"firestore",e._databaseId.database),e._delete()}function cs(e,t){let r=h5(e=rg(e,h2)),n=new h1;return function(e,t,r,n){var i;let s=(i=lG(t),new hv(function(e,t){if(e instanceof Uint8Array)return hy(e,void 0);if(e instanceof ArrayBuffer)return hy(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof r?ar().encode(r):r),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,r){try{var n,i;let s,a=await t.getMetadata();if(await (n=e.localStore,s=aT(a.createTime),n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Ii.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),r._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);r._updateProgress(uP(a));let o=new uM(a,t.serializer),l=await t.bu();for(;l;){let e=await o.Ga(l);e&&r._updateProgress(e),l=await t.bu()}let u=await o.ja(e.localStore);return await u7(e,u.Ha,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.Ii.saveBundleMetadata(e,a))),r._completeWith(u.progress),Promise.resolve(u.Ja)}catch(e){return t$(uB,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}})(t=await hR(e),s,n).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(r,e._databaseId,t,n),n}function ca(e,t){var r;return(r=h5(e=rg(e,h2)),r.asyncQueue.enqueue(async()=>{var e;return e=await hN(r),e.persistence.runTransaction("Get named query","readonly",r=>e.Ii.getNamedQuery(r,t))})).then(t=>t?new hz(e,null,t.query):null)}class co{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class cl{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class cu{constructor(e){this._byteString=e}static fromBase64String(e){try{return new cu(n4.fromBase64String(e))}catch(e){throw new tX(tJ.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new cu(n4.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:cu._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(rw(e,cu._jsonSchema))return cu.fromBase64String(e.bytes)}}cu._jsonSchemaVersion="firestore/bytes/1.0",cu._jsonSchema={type:ry("string",cu._jsonSchemaVersion),bytes:ry("string")};class ch{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new tX(tJ.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ro(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function cc(){return new ch(rn)}class cd{constructor(e){this._methodName=e}}class cf{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new tX(tJ.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new tX(tJ.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return t9(this._lat,e._lat)||t9(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:cf._jsonSchemaVersion}}static fromJSON(e){if(rw(e,cf._jsonSchema))return new cf(e.latitude,e.longitude)}}cf._jsonSchemaVersion="firestore/geoPoint/1.0",cf._jsonSchema={type:ry("string",cf._jsonSchemaVersion),latitude:ry("number"),longitude:ry("number")};class cp{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:cp._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(rw(e,cp._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new cp(e.vectorValues);throw new tX(tJ.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}cp._jsonSchemaVersion="firestore/vectorValue/1.0",cp._jsonSchema={type:ry("string",cp._jsonSchemaVersion),vectorValues:ry("object")};let cg=/^__.*__$/;class cm{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new sY(e,this.data,this.fieldMask,t,this.fieldTransforms):new sX(e,this.data,t,this.fieldTransforms)}}class cy{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new sY(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function cw(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw tK(40011,{Ac:e})}}class cv{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new cv({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return cB(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(cw(this.Ac)&&cg.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class cb{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||lG(e)}Cc(e,t,r,n=!1){return new cv({Ac:e,methodName:t,Dc:r,path:ro.emptyPath(),fc:!1,bc:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function c_(e){let t=e._freezeSettings(),r=lG(e._databaseId);return new cb(e._databaseId,!!t.ignoreUndefinedProperties,r)}function cI(e,t,r,n,i,s={}){let a,o,l=e.Cc(s.merge||s.mergeFields?2:0,t,r,i);cP("Data must be an object, but it was:",l,n);let u=cO(n,l);if(s.merge)a=new n6(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=cL(t,n,r);if(!l.contains(i))throw new tX(tJ.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);cU(e,i)||e.push(i)}a=new n6(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new cm(new iV(u),a,o)}class cE extends cd{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof cE}}function cT(e,t,r){return new cv({Ac:3,Dc:t.settings.Dc,methodName:e._methodName,fc:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class cS extends cd{_toFieldTransform(e){return new sz(e.path,new sP)}isEqual(e){return e instanceof cS}}class cx extends cd{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=cT(this,e,!0),r=new sL(this.vc.map(e=>cR(e,t)));return new sz(e.path,r)}isEqual(e){return e instanceof cx&&ey(this.vc,e.vc)}}class cC extends cd{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=cT(this,e,!0),r=new sV(this.vc.map(e=>cR(e,t)));return new sz(e.path,r)}isEqual(e){return e instanceof cC&&ey(this.vc,e.vc)}}class cA extends cd{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){let t=new sU(e.serializer,sR(e.serializer,this.Fc));return new sz(e.path,t)}isEqual(e){return e instanceof cA&&this.Fc===e.Fc}}function cD(e,t,r,n){let i=e.Cc(1,t,r);cP("Data must be an object, but it was:",i,n);let s=[],a=iV.empty();return nH(n,(e,n)=>{let o=cV(t,e,r);n=eD(n);let l=i.yc(o);if(n instanceof cE)s.push(o);else{let e=cR(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new cy(a,new n6(s),i.fieldTransforms)}function cN(e,t,r,n,i,s){let a=e.Cc(1,t,r),o=[cL(t,n,r)],l=[i];if(s.length%2!=0)throw new tX(tJ.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(cL(t,s[e])),l.push(s[e+1]);let u=[],h=iV.empty();for(let e=o.length-1;e>=0;--e)if(!cU(u,o[e])){let t=o[e],r=l[e];r=eD(r);let n=a.yc(t);if(r instanceof cE)u.push(t);else{let e=cR(r,n);null!=e&&(u.push(t),h.set(t,e))}}return new cy(h,new n6(u),a.fieldTransforms)}function ck(e,t,r,n=!1){return cR(r,e.Cc(n?4:3,t))}function cR(e,t){if(cM(e=eD(e)))return cP("Unsupported field value:",t,e),cO(e,t);if(e instanceof cd)return function(e,t){if(!cw(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");let r=[],n=0;for(let i of e){let e=cR(i,t.wc(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}return function(e,t){if(null===(e=eD(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return sR(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=rv.fromDate(e);return{timestampValue:aI(t.serializer,r)}}if(e instanceof rv){let r=new rv(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:aI(t.serializer,r)}}if(e instanceof cf)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof cu)return{bytesValue:aE(t.serializer,e._byteString)};if(e instanceof h$){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.Sc(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:aS(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof cp)return{mapValue:{fields:{[id]:{stringValue:im},[iy]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return sN(t.serializer,e)})}}}}};throw t.Sc(`Unsupported field value: ${rp(e)}`)}(e,t)}function cO(e,t){let r={};return nJ(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):nH(e,(e,n)=>{let i=cR(n,t.mc(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function cM(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof rv||e instanceof cf||e instanceof cu||e instanceof h$||e instanceof cd||e instanceof cp)}function cP(e,t,r){if(!cM(r)||!rf(r)){let n=rp(r);throw"an object"===n?t.Sc(e+" a custom object"):t.Sc(e+" "+n)}}function cL(e,t,r){if((t=eD(t))instanceof ch)return t._internalPath;if("string"==typeof t)return cV(e,t);throw cB("Field path arguments must be of type string or ",e,!1,void 0,r)}let cF=RegExp("[~\\*/\\[\\]]");function cV(e,t,r){if(t.search(cF)>=0)throw cB(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new ch(...t.split("."))._internalPath}catch(n){throw cB(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function cB(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new tX(tJ.INVALID_ARGUMENT,o+e+l)}function cU(e,t){return e.some(e=>e.isEqual(t))}class cq{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new h$(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new cj(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(cz("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class cj extends cq{data(){return super.data()}}function cz(e,t){return"string"==typeof t?cV(e,t):t instanceof ch?t._internalPath:t._delegate._internalPath}function c$(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new tX(tJ.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class cG{}class cK extends cG{}function cQ(e,t,...r){let n=[];for(let i of(t instanceof cG&&n.push(t),function(e){let t=e.filter(e=>e instanceof cJ).length,r=e.filter(e=>e instanceof cH).length;if(t>1||t>0&&r>0)throw new tX(tJ.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(r)),n))e=i._apply(e);return e}class cH extends cK{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new cH(e,t,r)}_apply(e){let t=this._parse(e);return dn(e._query,t),new hz(e.firestore,e.converter,sd(e._query,t))}_parse(e){let t=c_(e.firestore);return function(e,t,r,n,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new tX(tJ.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){dr(a,s);let t=[];for(let r of a)t.push(dt(n,e,r));o={arrayValue:{values:t}}}else o=dt(n,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||dr(a,s),o=ck(r,t,a,"in"===s||"not-in"===s);return iG.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function cW(e,t,r){let n=cz("where",e);return cH._create(n,t,r)}class cJ extends cG{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new cJ(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:iK.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let r=e;for(let e of t.getFlattenedFilters())dn(r,e),r=sd(r,e)}(e._query,t),new hz(e.firestore,e.converter,sd(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function cX(...e){return e.forEach(e=>di("or",e)),cJ._create("or",e)}function cY(...e){return e.forEach(e=>di("and",e)),cJ._create("and",e)}class cZ extends cK{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new cZ(e,t)}_apply(e){var t;let r,n=function(e,t,r){if(null!==e.startAt)throw new tX(tJ.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new tX(tJ.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new iz(t,r)}(e._query,this._field,this._direction);return new hz(e.firestore,e.converter,(t=e._query,r=t.explicitOrderBy.concat([n]),new si(t.path,t.collectionGroup,r,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function c0(e,t="asc"){let r=cz("orderBy",e);return cZ._create(r,t)}class c1 extends cK{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new c1(e,t,r)}_apply(e){return new hz(e.firestore,e.converter,sf(e._query,this._limit,this._limitType))}}function c2(e){return rm("limit",e),c1._create("limit",e,"F")}function c6(e){return rm("limitToLast",e),c1._create("limitToLast",e,"L")}class c3 extends cK{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new c3(e,t,r)}_apply(e){var t;let r=de(e,this.type,this._docOrFields,this._inclusive);return new hz(e.firestore,e.converter,(t=e._query,new si(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,r,t.endAt)))}}function c5(...e){return c3._create("startAt",e,!0)}function c4(...e){return c3._create("startAfter",e,!1)}class c8 extends cK{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new c8(e,t,r)}_apply(e){var t;let r=de(e,this.type,this._docOrFields,this._inclusive);return new hz(e.firestore,e.converter,(t=e._query,new si(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,r)))}}function c7(...e){return c8._create("endBefore",e,!1)}function c9(...e){return c8._create("endAt",e,!0)}function de(e,t,r,n){if(r[0]=eD(r[0]),r[0]instanceof cq)return function(e,t,r,n,i){if(!n)throw new tX(tJ.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of sl(e))if(r.field.isKeyField())s.push(ix(t,n.key));else{let e=n.data.field(r.field);if(ia(e))throw new tX(tJ.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=r.field.canonicalString();throw new tX(tJ.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new iU(s,i)}(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=c_(e.firestore);return function(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new tX(tJ.INVALID_ARGUMENT,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new tX(tJ.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!so(e)&&-1!==l.indexOf("/"))throw new tX(tJ.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(rs.fromString(l));if(!rl.isDocumentKey(r))throw new tX(tJ.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new rl(r);o.push(ix(t,i))}else{let e=ck(r,n,l);o.push(e)}}return new iU(o,s)}(e._query,e.firestore._databaseId,i,t,r,n)}}function dt(e,t,r){if("string"==typeof(r=eD(r))){if(""===r)throw new tX(tJ.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!so(t)&&-1!==r.indexOf("/"))throw new tX(tJ.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(rs.fromString(r));if(!rl.isDocumentKey(n))throw new tX(tJ.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return ix(e,new rl(n))}if(r instanceof h$)return ix(e,r._key);throw new tX(tJ.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${rp(r)}.`)}function dr(e,t){if(!Array.isArray(e)||0===e.length)throw new tX(tJ.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function dn(e,t){let r=function(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==r)throw r===t.op?new tX(tJ.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new tX(tJ.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function di(e,t){if(!(t instanceof cH||t instanceof cJ))throw new tX(tJ.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class ds{convertValue(e,t="none"){switch(iv(e)){case 0:return null;case 1:return e.booleanValue;case 2:return n9(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ie(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw tK(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return nH(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new cp(e.fields?.[iy].arrayValue?.values?.map(e=>n9(e.doubleValue)))}convertGeoPoint(e){return new cf(n9(e.latitude),n9(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=io(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(il(e));default:return null}}convertTimestamp(e){let t=n7(e);return new rv(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=rs.fromString(e);tH(a$(r),9688,{name:e});let n=new ic(r.get(1),r.get(3)),i=new rl(r.popFirst(5));return n.isEqual(t)||tz(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function da(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class dl extends ds{constructor(e){super(),this.firestore=e}convertBytes(e){return new cu(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new h$(this.firestore,null,t)}}function du(e){return new co("sum",cL("sum",e))}function dh(e){return new co("avg",cL("average",e))}function dc(){return new co("count")}function dd(e,t){return e instanceof co&&t instanceof co&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function df(e,t){return hJ(e.query,t.query)&&ey(e.data(),t.data())}let dp="NOT SUPPORTED";class dg{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class dm extends cq{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new dw(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(cz("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new tX(tJ.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=dm._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}function dy(e,t,r){if(rw(t,dm._jsonSchema)){var n;if(t.bundle===dp)throw new tX(tJ.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=lG(e._databaseId),s=(n=t.bundle,new hb(n,i)),a=s.Wu(),o=new uM(s.getMetadata(),i);for(let e of a)o.Ga(e);let l=o.documents;if(1!==l.length)throw new tX(tJ.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${l.length} documents.`);let u=aP(i,l[0].document),h=new rl(rs.fromString(t.bundleName));return new dm(e,new dl(e),h,u,new dg(!1,!1),r||null)}}dm._jsonSchemaVersion="firestore/documentSnapshot/1.0",dm._jsonSchema={type:ry("string",dm._jsonSchemaVersion),bundleSource:ry("string","DocumentSnapshot"),bundleName:ry("string"),bundle:ry("string")};class dw extends dm{data(e={}){return super.data(e)}}class dv{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new dg(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new dw(this._firestore,this._userDataWriter,r.key,r,new dg(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new tX(tJ.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new dw(e._firestore,e._userDataWriter,r.doc.key,r.doc,new dg(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new dw(e._firestore,e._userDataWriter,t.doc.key,t.doc,new dg(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return tK(61501,{type:e})}}(t.type),doc:n,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new tX(tJ.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=dv._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=t7.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function db(e,t,r){if(rw(t,dv._jsonSchema)){var n;if(t.bundle===dp)throw new tX(tJ.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=lG(e._databaseId),s=(n=t.bundle,new hb(n,i)),a=s.Wu(),o=new uM(s.getMetadata(),i);for(let e of a)o.Ga(e);if(1!==o.queries.length)throw new tX(tJ.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let l=a0(o.queries[0].bundledQuery),u=o.documents,h=new ub;u.map(e=>{let t=aP(i,e.document);h=h.add(t)});let c=uI.fromInitialDocuments(l,h,sA(),!1,!1),d=new hz(e,r||null,l);return new dv(e,new dl(e),d,c)}}function d_(e,t){return e instanceof dm&&t instanceof dm?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof dv&&t instanceof dv&&e._firestore===t._firestore&&hJ(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function dI(e){e=rg(e,h$);let t=rg(e.firestore,h2);return hP(h5(t),e._key).then(r=>dF(t,e,r))}dv._jsonSchemaVersion="firestore/querySnapshot/1.0",dv._jsonSchema={type:ry("string",dv._jsonSchemaVersion),bundleSource:ry("string","QuerySnapshot"),bundleName:ry("string"),bundle:ry("string")};class dE extends ds{constructor(e){super(),this.firestore=e}convertBytes(e){return new cu(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new h$(this.firestore,null,t)}}function dT(e){var t;let r;e=rg(e,h$);let n=rg(e.firestore,h2),i=h5(n),s=new dE(n);return(t=e._key,r=new tY,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await e.persistence.runTransaction("read document","readonly",r=>e.localDocuments.getDocument(r,t));n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new tX(tJ.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=uv(n,`Failed to get document '${t} from cache`);r.reject(e)}})(await hN(i),t,r)),r.promise).then(t=>new dm(n,s,e._key,t,new dg(null!==t&&t.hasLocalMutations,!0),e.converter))}function dS(e){e=rg(e,h$);let t=rg(e.firestore,h2);return hP(h5(t),e._key,{source:"server"}).then(r=>dF(t,e,r))}function dx(e){e=rg(e,hz);let t=rg(e.firestore,h2),r=h5(t),n=new dE(t);return c$(e._query),hL(r,e._query).then(r=>new dv(t,n,e,r))}function dC(e){var t;let r;e=rg(e,hz);let n=rg(e.firestore,h2),i=h5(n),s=new dE(n);return(t=e._query,r=new tY,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await ld(e,t,!0),i=new uV(t,n.Qs),s=i.ru(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(n){let e=uv(n,`Failed to execute query '${t} against cache`);r.reject(e)}})(await hN(i),t,r)),r.promise).then(t=>new dv(n,s,e,t))}function dA(e){e=rg(e,hz);let t=rg(e.firestore,h2),r=h5(t),n=new dE(t);return hL(r,e._query,{source:"server"}).then(r=>new dv(t,n,e,r))}function dD(e,t,r){e=rg(e,h$);let n=rg(e.firestore,h2),i=da(e.converter,t,r);return dL(n,[cI(c_(n),"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,sG.none())])}function dN(e,t,r,...n){e=rg(e,h$);let i=rg(e.firestore,h2),s=c_(i);return dL(i,[("string"==typeof(t=eD(t))||t instanceof ch?cN(s,"updateDoc",e._key,t,r,n):cD(s,"updateDoc",e._key,t)).toMutation(e._key,sG.exists(!0))])}function dk(e){return dL(rg(e.firestore,h2),[new s2(e._key,sG.none())])}function dR(e,t){let r=rg(e.firestore,h2),n=hH(e),i=da(e.converter,t);return dL(r,[cI(c_(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,sG.exists(!1))]).then(()=>n)}function dO(e,...t){var r;let n,i,s,a,o;e=eD(e);let l={includeMetadataChanges:!1,source:"default"},u=0;"object"!=typeof t[0]||h0(t[u])||(l=t[u++]);let h={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(h0(t[u])){let e=t[u];t[u]=e.next?.bind(e),t[u+1]=e.error?.bind(e),t[u+2]=e.complete?.bind(e)}if(e instanceof h$)i=rg(e.firestore,h2),s=ss(e._key.path),n={next:r=>{t[u]&&t[u](dF(i,e,r))},error:t[u+1],complete:t[u+2]};else{let r=rg(e,hz);i=rg(r.firestore,h2),s=r._query;let a=new dE(i);n={next:e=>{t[u]&&t[u](new dv(i,a,r,e))},error:t[u+1],complete:t[u+2]},c$(e._query)}return r=h5(i),o=new uk(s,a=new hw(n),h),r.asyncQueue.enqueueAndForget(async()=>ux(await hM(r),o)),()=>{a.Nu(),r.asyncQueue.enqueueAndForget(async()=>uC(await hM(r),o))}}function dM(e,t,...r){var n,i,s,a,o,l;let u=eD(e),h=function(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let r of["bundle","bundleName","bundleSource"]){if(!(r in e)){t.error=`snapshotJson missing required field: ${r}`;break}let n=e[r];if("string"!=typeof n){t.error=`snapshotJson field '${r}' must be a string.`;break}if(0===n.length){t.error=`snapshotJson field '${r}' cannot be an empty string.`;break}"bundle"===r?t.bundle=n:"bundleName"===r?t.bundleName=n:"bundleSource"===r&&(t.bundleSource=n)}return t}(t);if(h.error)throw new tX(tJ.INVALID_ARGUMENT,h.error);let c,d=0;if("object"!=typeof r[0]||h0(r[d])||(c=r[d++]),"QuerySnapshot"===h.bundleSource){let e,t,a=null;if("object"==typeof r[d]&&h0(r[d])){let e=r[d++];a={next:e.next,error:e.error,complete:e.complete}}else a={next:r[d++],error:r[d++],complete:r[d++]};return n=c,i=a,s=r[d],t=!1,cs(u,h.bundle).then(()=>ca(u,h.bundleName)).then(r=>{r&&!t&&(s&&r.withConverter(s),e=dO(r,n||{},i))}).catch(e=>(i.error&&i.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}if("DocumentSnapshot"===h.bundleSource){let e,t,n=null;if("object"==typeof r[d]&&h0(r[d])){let e=r[d++];n={next:e.next,error:e.error,complete:e.complete}}else n={next:r[d++],error:r[d++],complete:r[d++]};return a=c,o=n,l=r[d],t=!1,cs(u,h.bundle).then(()=>{t||(e=dO(new h$(u,l||null,rl.fromPath(h.bundleName)),a||{},o))}).catch(e=>(o.error&&o.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}throw new tX(tJ.INVALID_ARGUMENT,`unsupported bundle source: ${h.bundleSource}`)}function dP(e,t){var r;let n;return r=h5(e=rg(e,h2)),n=new hw(h0(t)?t:{next:t}),r.asyncQueue.enqueueAndForget(async()=>{var e;return e=await hM(r),void(e.Ca.add(n),n.next())}),()=>{n.Nu(),r.asyncQueue.enqueueAndForget(async()=>{var e;return e=await hM(r),void e.Ca.delete(n)})}}function dL(e,t){var r;let n;return r=h5(e),n=new tY,r.asyncQueue.enqueueAndForget(async()=>uW(await hR(r),t,n)),n.promise}function dF(e,t,r){let n=r.docs.get(t._key),i=new dE(e);return new dm(e,i,t._key,n,new dg(r.hasPendingWrites,r.fromCache),t.converter)}function dV(e){return dB(e,{count:dc()})}function dB(e,t){var r;let n,i=rg(e.firestore,h2),s=h5(i),a=nW(t,(e,t)=>new s8(t,e.aggregateType,e._internalFieldPath));return(r=e._query,n=new tY,s.asyncQueue.enqueueAndForget(async()=>{try{let e=await hO(s);n.resolve(async function(e,t,r){let{request:n,gt:i,parent:s}=aU(e.serializer,sh(t),r);e.connection.$o||delete n.parent;let a=(await e.Ho("RunAggregationQuery",e.serializer.databaseId,s,n,1)).filter(e=>!!e.result);tH(1===a.length,64727);let o=a[0].result?.aggregateFields;return Object.keys(o).reduce((e,t)=>(e[i[t]]=o[t],e),{})}(e,r,a))}catch(e){n.reject(e)}}),n.promise).then(t=>new cl(e,new dE(i),t))}class dU{constructor(e){this.kind="memory",this._onlineComponentProvider=hm.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new hf(void 0)}}toJSON(){return{kind:this.kind}}}class dq{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=dJ(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class dj{constructor(){this.kind="memoryEager",this._offlineComponentProvider=hd.provider}toJSON(){return{kind:this.kind}}}class dz{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new hf(e)}}toJSON(){return{kind:this.kind}}}function d$(){return new dj}function dG(e){return new dz(e?.cacheSizeBytes)}function dK(e){return new dU(e)}function dQ(e){return new dq(e)}class dH{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=hm.provider,this._offlineComponentProvider={build:t=>new hp(t,e?.cacheSizeBytes,this.forceOwnership)}}}class dW{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=hm.provider,this._offlineComponentProvider={build:t=>new hg(t,e?.cacheSizeBytes)}}}function dJ(e){return new dH(e?.forceOwnership)}function dX(){return new dW}let dY={maxAttempts:5};class dZ{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=c_(e)}set(e,t,r){this._verifyNotCommitted();let n=d0(e,this._firestore),i=da(n.converter,t,r),s=cI(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(s.toMutation(n._key,sG.none())),this}update(e,t,r,...n){let i;this._verifyNotCommitted();let s=d0(e,this._firestore);return i="string"==typeof(t=eD(t))||t instanceof ch?cN(this._dataReader,"WriteBatch.update",s._key,t,r,n):cD(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,sG.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=d0(e,this._firestore);return this._mutations=this._mutations.concat(new s2(t._key,sG.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new tX(tJ.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function d0(e,t){if((e=eD(e)).firestore!==t)throw new tX(tJ.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class d1{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=c_(e)}get(e){let t=d0(e,this._firestore),r=new dl(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return tK(24041);let n=e[0];if(n.isFoundDocument())return new cq(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new cq(this._firestore,r,t._key,null,t.converter);throw tK(18433,{doc:n})})}set(e,t,r){let n=d0(e,this._firestore),i=da(n.converter,t,r),s=cI(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,s),this}update(e,t,r,...n){let i,s=d0(e,this._firestore);return i="string"==typeof(t=eD(t))||t instanceof ch?cN(this._dataReader,"Transaction.update",s._key,t,r,n):cD(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=d0(e,this._firestore);return this._transaction.delete(t._key),this}}class d2 extends d1{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=d0(e,this._firestore),r=new dE(this._firestore);return super.get(e).then(e=>new dm(this._firestore,r,t._key,e._document,new dg(!1,!1),t.converter))}}function d6(e,t,r){var n,i;let s;e=rg(e,h2);let a={...dY,...r};if(a.maxAttempts<1)throw new tX(tJ.INVALID_ARGUMENT,"Max attempts must be at least 1");return n=h5(e),i=r=>t(new d2(e,r)),s=new tY,n.asyncQueue.enqueueAndForget(async()=>{let e=await hO(n);new hI(n.asyncQueue,e,a,i,s).ju()}),s.promise}function d3(){return new cE("deleteField")}function d5(){return new cS("serverTimestamp")}function d4(...e){return new cx("arrayUnion",e)}function d8(...e){return new cC("arrayRemove",e)}function d7(e){return new cA("increment",e)}function d9(e){return new cp(e)}function fe(e){return h5(e=rg(e,h2)),new dZ(e,t=>dL(e,t))}function ft(e,t){let r=h5(e=rg(e,h2));if(!r._uninitializedComponentsProvider||"memory"===r._uninitializedComponentsProvider._offline.kind)return t$("Cannot enable indexes when persistence is disabled"),Promise.resolve();let n=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new tX(tJ.INVALID_ARGUMENT,"Failed to parse JSON: "+e?.message)}}(e):e,r=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=fr(e,"collectionGroup"),n=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=cV("setIndexConfiguration",fr(t,"fieldPath"));"CONTAINS"===t.arrayConfig?n.push(new rS(e,2)):"ASCENDING"===t.order?n.push(new rS(e,0)):"DESCENDING"===t.order&&n.push(new rS(e,1))}r.push(new r_(r_.UNKNOWN_ID,t,n,rx.empty()))}return r}(t);return r.asyncQueue.enqueue(async()=>(async function(e,t){let r=e.indexManager,n=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>r.getFieldIndexes(e).next(i=>(function(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])})(i,t,rT,t=>{n.push(r.addFieldIndex(e,t))},t=>{n.push(r.deleteFieldIndex(e,t))})).next(()=>rM.waitFor(n)))})(await hN(r),n))}function fr(e,t){if("string"!=typeof e[t])throw new tX(tJ.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class fn{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function fi(e){e=rg(e,h2);let t=fu.get(e);if(t)return t;let r=h5(e);if("persistent"!==r._uninitializedComponentsProvider?._offline.kind)return null;let n=new fn(e);return fu.set(e,n),n}function fs(e){fl(e,!0)}function fa(e){fl(e,!1)}function fo(e){var t;(t=h5(e._firestore)).asyncQueue.enqueue(async()=>{var e;let r;return r=(e=await hN(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>r.deleteAllFieldIndexes(e))}).then(e=>tj("deleting all persistent cache indexes succeeded")).catch(e=>t$("deleting all persistent cache indexes failed",e))}function fl(e,t){var r;(r=h5(e._firestore),r.asyncQueue.enqueue(async()=>{var e;return e=await hN(r),void(e.Fs.Vs=t)})).then(e=>tj(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>t$(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let fu=new WeakMap;function fh(e){let t=h5(rg(e.firestore,h2)),r=t._onlineComponents?.datastore.serializer;return void 0===r?null:aB(r,su(e._query)).ft}function fc(e,t){let r=nW(t,(e,t)=>new s8(t,e.aggregateType,e._internalFieldPath)),n=h5(rg(e.firestore,h2)),i=n._onlineComponents?.datastore.serializer;return void 0===i?null:aU(i,sh(e._query),r,!0).request}class fd{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return ff.instance.onExistenceFilterMismatch(e)}}class ff{constructor(){this.Mc=new Map}static get instance(){return fp||function(e){if(at)throw Error("a TestingHooksSpi instance is already set");at=e}(fp=new ff),fp}lt(e){this.Mc.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.Mc;return r.set(t,e),()=>r.delete(t)}}let fp=null;!function(e=!0){tV=td,tt(new eN("firestore",(t,{instanceIdentifier:r,options:n})=>{let i=t.getProvider("app").getImmediate(),s=new h2(new t2(t.getProvider("auth-internal")),new t4(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new tX(tJ.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ic(e.options.projectId,t)}(i,r),i);return n={useFetchStreams:e,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),tw(tP,tL,void 0),tw(tP,tL,"esm2020")}(),e.s(["AbstractUserDataWriter",()=>ds,"AggregateField",()=>co,"AggregateQuerySnapshot",()=>cl,"Bytes",()=>cu,"CACHE_SIZE_UNLIMITED",()=>-1,"CollectionReference",()=>hG,"DocumentReference",()=>h$,"DocumentSnapshot",()=>dm,"FieldPath",()=>ch,"FieldValue",()=>cd,"Firestore",()=>h2,"FirestoreError",()=>tX,"GeoPoint",()=>cf,"LoadBundleTask",()=>h1,"PersistentCacheIndexManager",()=>fn,"Query",()=>hz,"QueryCompositeFilterConstraint",()=>cJ,"QueryConstraint",()=>cK,"QueryDocumentSnapshot",()=>dw,"QueryEndAtConstraint",()=>c8,"QueryFieldFilterConstraint",()=>cH,"QueryLimitConstraint",()=>c1,"QueryOrderByConstraint",()=>cZ,"QuerySnapshot",()=>dv,"QueryStartAtConstraint",()=>c3,"SnapshotMetadata",()=>dg,"Timestamp",()=>rv,"Transaction",()=>d2,"VectorValue",()=>cp,"WriteBatch",()=>dZ,"_AutoId",()=>t7,"_ByteString",()=>n4,"_DatabaseId",()=>ic,"_DocumentKey",()=>rl,"_EmptyAppCheckTokenProvider",()=>t8,"_EmptyAuthCredentialsProvider",()=>t0,"_FieldPath",()=>ro,"_TestingHooks",()=>fd,"_cast",()=>rg,"_debugAssert",()=>tW,"_internalAggregationQueryToProtoRunAggregationQueryRequest",()=>fc,"_internalQueryToProtoQueryTarget",()=>fh,"_isBase64Available",()=>n5,"_logWarn",()=>t$,"_validateIsNotUsedTogether",()=>rh,"addDoc",()=>dR,"aggregateFieldEqual",()=>dd,"aggregateQuerySnapshotEqual",()=>df,"and",()=>cY,"arrayRemove",()=>d8,"arrayUnion",()=>d4,"average",()=>dh,"clearIndexedDbPersistence",()=>ce,"collection",()=>hK,"collectionGroup",()=>hQ,"connectFirestoreEmulator",()=>hj,"count",()=>dc,"deleteAllPersistentCacheIndexes",()=>fo,"deleteDoc",()=>dk,"deleteField",()=>d3,"disableNetwork",()=>cn,"disablePersistentCacheIndexAutoCreation",()=>fa,"doc",()=>hH,"documentId",()=>cc,"documentSnapshotFromJSON",()=>dy,"enableIndexedDbPersistence",()=>h8,"enableMultiTabIndexedDbPersistence",()=>h7,"enableNetwork",()=>cr,"enablePersistentCacheIndexAutoCreation",()=>fs,"endAt",()=>c9,"endBefore",()=>c7,"ensureFirestoreConfigured",()=>h5,"executeWrite",()=>dL,"getAggregateFromServer",()=>dB,"getCountFromServer",()=>dV,"getDoc",()=>dI,"getDocFromCache",()=>dT,"getDocFromServer",()=>dS,"getDocs",()=>dx,"getDocsFromCache",()=>dC,"getDocsFromServer",()=>dA,"getFirestore",()=>h3,"getPersistentCacheIndexManager",()=>fi,"increment",()=>d7,"initializeFirestore",()=>h6,"limit",()=>c2,"limitToLast",()=>c6,"loadBundle",()=>cs,"memoryEagerGarbageCollector",()=>d$,"memoryLocalCache",()=>dK,"memoryLruGarbageCollector",()=>dG,"namedQuery",()=>ca,"onSnapshot",()=>dO,"onSnapshotResume",()=>dM,"onSnapshotsInSync",()=>dP,"or",()=>cX,"orderBy",()=>c0,"persistentLocalCache",()=>dQ,"persistentMultipleTabManager",()=>dX,"persistentSingleTabManager",()=>dJ,"query",()=>cQ,"queryEqual",()=>hJ,"querySnapshotFromJSON",()=>db,"refEqual",()=>hW,"runTransaction",()=>d6,"serverTimestamp",()=>d5,"setDoc",()=>dD,"setIndexConfiguration",()=>ft,"setLogLevel",()=>tq,"snapshotEqual",()=>d_,"startAfter",()=>c4,"startAt",()=>c5,"sum",()=>du,"terminate",()=>ci,"updateDoc",()=>dN,"vector",()=>d9,"waitForPendingWrites",()=>ct,"where",()=>cW,"writeBatch",()=>fe],82107),e.s([],73978)}]);